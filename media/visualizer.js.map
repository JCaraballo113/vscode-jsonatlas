{"version":3,"file":"visualizer.js","sources":["../webview/src/visualizer.ts"],"sourcesContent":["(function () {\n  const vscode = acquireVsCodeApi();\n  const container = document.getElementById('visualizer');\n  const status = document.getElementById('status');\n  const viewSelect = document.getElementById('visualizerViewSelect');\n  const layoutPresetSelect = document.getElementById('layoutPresetSelect');\n  const focusModeSelect = document.getElementById('focusModeSelect');\n  const focusModeNotice = document.getElementById('focusModeNotice');\n  const searchInput = document.getElementById('visualizerSearchInput');\n  const chatToggle = document.getElementById('chatToggle');\n  const chatPanel = document.getElementById('chatPanel');\n  const chatClose = document.getElementById('chatClose');\n  const chatReset = document.getElementById('chatReset');\n  const chatMessages = document.getElementById('chatMessages');\n  const chatForm = document.getElementById('chatForm');\n  const chatInput = document.getElementById('chatInput');\n  const chatStatus = document.getElementById('chatStatus');\n  const chatModelSelect = document.getElementById('chatModelSelect');\n  const selectionLineForm = document.getElementById('selectionLineForm');\n  const selectionStartInput = document.getElementById('selectionStartInput');\n  const selectionEndInput = document.getElementById('selectionEndInput');\n  const selectionClearButton = document.getElementById('selectionClearButton');\n  const controlDock = document.getElementById('controlDock');\n  const controlDockPanel = document.getElementById('controlDockPanel');\n  const controlDockToggle = document.getElementById('controlDockToggle');\n\n  if (!container || !status) {\n    vscode.postMessage({ type: 'ready' });\n    return;\n  }\n\n  const graphRoot = document.createElement('section');\n  graphRoot.className = 'visualizer-view visualizer-graph-view';\n  graphRoot.setAttribute('hidden', 'true');\n  container.appendChild(graphRoot);\n\n  const treeRoot = document.createElement('section');\n  treeRoot.className = 'visualizer-view visualizer-tree-view';\n  treeRoot.setAttribute('hidden', 'true');\n  container.appendChild(treeRoot);\n\n  const nodeElements = new Map();\n  const pathDepths = new Map();\n  const collapsedPathStore = new Map();\n  const depthExpandedPathStore = new Map();\n  let collapsedPaths = new Set();\n  let depthExpandedPaths = new Set();\n  let persistedState = typeof vscode.getState === 'function' ? vscode.getState() ?? {} : {};\n  let nodePositionStore = persistedState.nodePositions ?? {};\n  let layoutPresetStore =\n    typeof persistedState.layoutPresets === 'object' && persistedState.layoutPresets\n      ? persistedState.layoutPresets\n      : {};\n  let nodePositions = new Map();\n  let currentDocumentId;\n  let currentEdges = [];\n  let activeNodeDrag;\n\n  let currentPayload;\n  let viewport;\n  let canvas;\n  let nodesLayer;\n  let linksLayer;\n  let isPanning = false;\n  let panPointerId = null;\n  let panStart = { x: 0, y: 0 };\n  let panOrigin = { x: 0, y: 0 };\n  let hasUserMovedView = false;\n  let viewMode = persistedState.viewMode === 'tree' ? 'tree' : 'graph';\n  let hasPersistedViewPreference = typeof persistedState.viewMode === 'string';\n  let preferredDefaultViewMode = hasPersistedViewPreference ? viewMode : 'graph';\n  let graphAutoScale = true;\n  let manualGraphScale = 1;\n  let graphInitialScale = 1;\n  let graphMaxDepth;\n  let searchIndex = new Map();\n  let currentSearchQuery = '';\n  let currentSearchMatch;\n  let pendingSearchFocusId;\n  const chatMessageMap = new Map();\n  let chatPanelVisible = false;\n  let awaitingChatKey = false;\n  let hasAiKey = false;\n  let selectionActive = false;\n  let selectionLabel = '';\n  let selectionLineRange: { start?: number; end?: number } = {};\n  let controlsCollapsed = Boolean(persistedState.controlsCollapsed);\n  let needsInitialGraphFocus = true;\n  let activeModelProvider = 'openai';\n  let currentLayoutPreset: LayoutPreset = 'balanced';\n  let configDefaultLayoutPreset: LayoutPreset = 'balanced';\n  type FocusMode = 'all' | 'required' | 'warnings' | 'arrays';\n  let focusMode: FocusMode = normalizeFocusMode(\n    typeof persistedState.focusMode === 'string' ? persistedState.focusMode : 'all'\n  );\n  let requiredPathSet = new Set<string>();\n  let schemaWarningPaths = new Set<string>();\n  let schemaInsightSeverity = new Map<string, 'error' | 'warning'>();\n  let denseArrayPaths = new Set<string>();\n  const pathSegmentCache = new Map<string, (string | number)[]>();\n\n  const LAYOUT_PRESETS = {\n    compact: { gapX: 210, gapY: 70 },\n    balanced: { gapX: 260, gapY: 90 },\n    relaxed: { gapX: 330, gapY: 110 }\n  } as const;\n  type LayoutPreset = keyof typeof LAYOUT_PRESETS;\n  const CANVAS_PADDING = 96;\n  const MANUAL_MIN_SCALE = 0.4;\n  const AUTO_MIN_SCALE = 0.02;\n  const AUTO_MAX_SCALE = 1.2;\n  const AUTO_FIT_PADDING = 0.9;\n  const AUTO_VISIBLE_MIN_SCALE = 0.35;\n  const MAX_SCALE = 2.5;\n  const ICON_TYPES = {\n    object: 'object',\n    array: 'array',\n    string: 'string',\n    number: 'number',\n    boolean: 'boolean',\n    null: 'null',\n    link: 'link',\n    unknown: 'unknown'\n  };\n  const EDITABLE_VALUE_KINDS = new Set(['string', 'number', 'boolean', 'null', 'link']);\n  const ARRAY_DENSITY_THRESHOLD = 25;\n  const ROOT_PATH = JSON.stringify([]);\n  const ICON_SVGS = {\n    object:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M9 5H7c-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2 1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2h2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M15 5h2c1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2h-2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    array:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M5 7h14M5 12h14M5 17h14\" stroke-width=\"2\" stroke-linecap=\"round\"/></svg>',\n    string:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M9 7H7l-2 5 2 5h2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M15 7h2l2 5-2 5h-2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    number:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M10 4v16M14 4v16M4 10h16M4 14h16\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    boolean:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><rect x=\"3\" y=\"7\" width=\"18\" height=\"10\" rx=\"5\" ry=\"5\" stroke-width=\"2\"/><circle cx=\"9\" cy=\"12\" r=\"3.5\" stroke-width=\"2\"/></svg>',\n    null:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><circle cx=\"12\" cy=\"12\" r=\"6\" stroke-width=\"2\"/><path d=\"M8.5 8.5 15.5 15.5\" stroke-width=\"2\" stroke-linecap=\"round\"/></svg>',\n    link:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M10 13a5 5 0 0 0 7.54.54l1.92-1.92a5 5 0 0 0-7.07-7.07l-1.09 1.09\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M14 11a5 5 0 0 0-7.54-.54l-1.92 1.92a5 5 0 0 0 7.07 7.07l1.09-1.09\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    unknown:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><circle cx=\"12\" cy=\"17\" r=\"1.5\" stroke-width=\"2\"/><path d=\"M12 13v-1.5a3.5 3.5 0 1 0-3.5-3.5\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>'\n  };\n\n  type SchemaPointerInfo = {\n    pointer: string;\n    title?: string;\n    description?: string;\n    required?: boolean;\n    deprecated?: boolean;\n    readOnly?: boolean;\n    writeOnly?: boolean;\n  };\n\n  let schemaPointerIndex = new Map<string, SchemaPointerInfo>();\n\n  const panState = { x: 0, y: 0, scale: 1 };\n  let minScaleLimit = MANUAL_MIN_SCALE;\n\n  if (viewSelect instanceof HTMLSelectElement) {\n    viewSelect.value = viewMode;\n    viewSelect.addEventListener('change', (event) => {\n      const next = event.target.value === 'tree' ? 'tree' : 'graph';\n      setViewMode(next);\n    });\n  }\n\n  if (layoutPresetSelect instanceof HTMLSelectElement) {\n    layoutPresetSelect.value = currentLayoutPreset;\n    layoutPresetSelect.addEventListener('change', (event) => {\n      const value = event.target.value;\n      const next = normalizeLayoutPreset(value);\n      applyLayoutPreset(next);\n    });\n  }\n\n  if (focusModeSelect instanceof HTMLSelectElement) {\n    focusModeSelect.value = focusMode;\n    focusModeSelect.addEventListener('change', (event) => {\n      const next = normalizeFocusMode(event.target.value);\n      setFocusMode(next);\n    });\n  }\n\n  if (searchInput instanceof HTMLInputElement) {\n    searchInput.addEventListener('input', (event) => {\n      const value = event.target.value.trim();\n      performSearch(value);\n    });\n  }\n\n  if (chatToggle instanceof HTMLButtonElement) {\n    chatToggle.addEventListener('click', () => {\n      if (chatPanelVisible) {\n        toggleChatPanel(false);\n        return;\n      }\n\n      toggleChatPanel(true);\n      if (hasAiKey) {\n        showChatStatus('');\n        return;\n      }\n\n      awaitingChatKey = true;\n      showChatStatus(getMissingKeyMessage());\n      vscode.postMessage({ type: 'chat:ensureKey' });\n    });\n  }\n\n  if (chatClose instanceof HTMLButtonElement) {\n    chatClose.addEventListener('click', () => toggleChatPanel(false));\n  }\n\n  if (chatReset instanceof HTMLButtonElement) {\n    chatReset.addEventListener('click', () => {\n      vscode.postMessage({ type: 'chat:reset' });\n      clearChatMessages();\n    });\n  }\n\n  if (chatForm instanceof HTMLFormElement && chatInput instanceof HTMLTextAreaElement) {\n    const submitChatInput = () => {\n      const value = chatInput.value.trim();\n      if (!value) {\n        return;\n      }\n\n      if (!hasAiKey) {\n        awaitingChatKey = true;\n        showChatStatus(getMissingKeyMessage());\n        vscode.postMessage({ type: 'chat:ensureKey' });\n        return;\n      }\n\n      vscode.postMessage({ type: 'chat:send', payload: { text: value } });\n      chatInput.value = '';\n      showChatStatus('Waiting for response…');\n    };\n\n    chatForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n      submitChatInput();\n    });\n\n    chatInput.addEventListener('keydown', (event) => {\n      if (event.key === 'Enter' && !event.shiftKey) {\n        event.preventDefault();\n        submitChatInput();\n      }\n    });\n  }\n\n  if (chatModelSelect instanceof HTMLSelectElement) {\n    chatModelSelect.addEventListener('change', (event) => {\n      const value = event.target.value;\n      if (!value) {\n        return;\n      }\n      vscode.postMessage({ type: 'chat:setModel', payload: { modelId: value } });\n    });\n  }\n\n  if (\n    selectionLineForm instanceof HTMLFormElement &&\n    selectionStartInput instanceof HTMLInputElement &&\n    selectionEndInput instanceof HTMLInputElement\n  ) {\n    selectionLineForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n      const startValue = parseLineInput(selectionStartInput.value);\n      const endValue = parseLineInput(selectionEndInput.value);\n      if (typeof startValue !== 'number' || typeof endValue !== 'number') {\n        return;\n      }\n      const normalized = normalizeLineRange(startValue, endValue);\n      selectionActive = true;\n      selectionLineRange = normalized;\n      updateSelectionInputs();\n      vscode.postMessage({ type: 'selection:applyLines', payload: { startLine: normalized.start, endLine: normalized.end } });\n    });\n  }\n\n  if (selectionClearButton instanceof HTMLButtonElement) {\n    selectionClearButton.addEventListener('click', () => {\n      if (selectionStartInput instanceof HTMLInputElement) {\n        selectionStartInput.value = '';\n      }\n      if (selectionEndInput instanceof HTMLInputElement) {\n        selectionEndInput.value = '';\n      }\n    selectionLineRange = {};\n    selectionActive = false;\n    updateSelectionInputs();\n    vscode.postMessage({ type: 'selection:clear' });\n  });\n}\n\n  if (controlDockToggle instanceof HTMLButtonElement) {\n    controlDockToggle.addEventListener('click', () => {\n      setControlsCollapsed(!controlsCollapsed);\n    });\n  }\n\n\n  setControlsCollapsed(controlsCollapsed, { persist: false });\n\n  container.addEventListener('click', handleContainerClick);\n  container.addEventListener('keydown', handleKeydown);\n\n  window.addEventListener('message', (event) => {\n    const { type, payload } = event.data || {};\n    if (type === 'render') {\n      renderVisualizer(payload);\n      return;\n    }\n\n    if (type === 'invalid') {\n      renderInvalidState(payload);\n      return;\n    }\n\n    if (type === 'chat:history') {\n      renderChatHistory(payload);\n      return;\n    }\n\n    if (type === 'chat:userMessage') {\n      ensureChatPanel();\n      setChatMessage(payload?.id, 'user', payload?.text ?? '');\n      return;\n    }\n\n    if (type === 'chat:assistantStart') {\n      ensureChatPanel();\n      setChatMessage(payload?.id, 'assistant', '', { pending: true });\n      showChatStatus('AI is thinking...');\n      return;\n    }\n\n    if (type === 'chat:assistantDelta') {\n      appendChatDelta(payload?.id, payload?.text ?? '');\n      return;\n    }\n\n    if (type === 'chat:assistantComplete') {\n      finalizeAssistantMessage(payload?.id, payload?.text ?? '', payload?.snippet);\n      return;\n    }\n\n    if (type === 'chat:error') {\n      showChatStatus(payload ?? 'AI error');\n      return;\n    }\n\n    if (type === 'chat:status') {\n      showChatStatus(payload?.state === 'thinking' ? 'AI is thinking...' : '');\n      return;\n    }\n\n    if (type === 'chat:needsApiKey') {\n      showChatStatus(`${getMissingKeyMessage()} Use the command palette to configure it.`);\n    }\n\n    if (type === 'chat:ensureKeyResult') {\n      hasAiKey = Boolean(payload?.ready);\n      if (hasAiKey) {\n        awaitingChatKey = false;\n        showChatStatus('');\n      } else if (awaitingChatKey) {\n        showChatStatus(`${getMissingKeyMessage()} Run “JSON Atlas: Set AI API Key”.`);\n      }\n      return;\n    }\n\n    if (type === 'chat:aiStatus') {\n      if (typeof payload?.provider === 'string') {\n        activeModelProvider = payload.provider;\n      }\n      hasAiKey = Boolean(payload?.hasKey);\n      if (chatPanelVisible && !hasAiKey) {\n        showChatStatus(getMissingKeyMessage());\n      } else if (chatPanelVisible) {\n        showChatStatus('');\n      }\n      return;\n    }\n\n    if (type === 'chat:modelOptions') {\n      updateModelSelect(payload);\n      return;\n    }\n\n    if (type === 'selection:update') {\n      applySelectionInfo(payload);\n      return;\n    }\n\n    if (type === 'visualizer:focusPath') {\n      const path = typeof payload === 'string' ? payload : undefined;\n      if (!path) {\n        return;\n      }\n      pendingSearchFocusId = path;\n      if (viewMode !== 'graph') {\n        setViewMode('graph');\n        return;\n      }\n      requestAnimationFrame(() => {\n        if (nodeElements.has(path)) {\n          focusGraphNode(path);\n          pendingSearchFocusId = undefined;\n        }\n      });\n      return;\n    }\n\n    if (type === 'schema:pointers') {\n      applySchemaPointers(payload);\n      rerenderFromState();\n      return;\n    }\n\n    if (type === 'schema:insights') {\n      applySchemaInsights(payload);\n      return;\n    }\n  });\n\n  vscode.postMessage({ type: 'ready' });\n\n  function applySchemaPointers(raw: Record<string, SchemaPointerInfo | undefined> | undefined) {\n    schemaPointerIndex = new Map<string, SchemaPointerInfo>();\n    requiredPathSet = new Set<string>();\n    if (!raw || typeof raw !== 'object') {\n      applyFocusMode();\n      return;\n    }\n    Object.entries(raw).forEach(([path, info]) => {\n      if (!info || typeof info.pointer !== 'string') {\n        return;\n      }\n      const normalized: SchemaPointerInfo = {\n        pointer: info.pointer,\n        title: typeof info.title === 'string' ? info.title : undefined,\n        description: typeof info.description === 'string' ? info.description : undefined,\n        required: info.required === true,\n        deprecated: info.deprecated === true,\n        readOnly: info.readOnly === true,\n        writeOnly: info.writeOnly === true\n      };\n      schemaPointerIndex.set(path, normalized);\n      if (normalized.required) {\n        requiredPathSet.add(path);\n      }\n    });\n    applyInsightHighlights();\n    applyFocusMode();\n  }\n\n  function applySchemaInsights(raw: unknown) {\n    schemaInsightSeverity = new Map<string, 'error' | 'warning'>();\n    schemaWarningPaths = new Set<string>();\n    if (!Array.isArray(raw)) {\n      applyInsightHighlights();\n      applyFocusMode();\n      return;\n    }\n\n    raw.forEach((entry) => {\n      if (!entry || typeof entry !== 'object') {\n        return;\n      }\n      const pathKey = typeof (entry as { pathKey?: string }).pathKey === 'string' ? (entry as { pathKey: string }).pathKey : undefined;\n      if (!pathKey) {\n        return;\n      }\n      const severity = (entry as { severity?: string }).severity === 'error' ? 'error' : 'warning';\n      schemaInsightSeverity.set(pathKey, severity);\n      schemaWarningPaths.add(pathKey);\n    });\n\n    applyInsightHighlights();\n    applyFocusMode();\n  }\n\n  function setFocusMode(mode: FocusMode) {\n    const normalized = normalizeFocusMode(mode);\n    if (focusMode === normalized) {\n      return;\n    }\n    focusMode = normalized;\n    if (focusModeSelect instanceof HTMLSelectElement) {\n      focusModeSelect.value = normalized;\n    }\n    persistState({ savePositions: false });\n    applyFocusMode();\n  }\n\n  function normalizeFocusMode(value: unknown): FocusMode {\n    if (value === 'required' || value === 'warnings' || value === 'arrays') {\n      return value;\n    }\n    return 'all';\n  }\n\n  function getFocusSourceSet(): Set<string> | undefined {\n    if (focusMode === 'required') {\n      return requiredPathSet;\n    }\n    if (focusMode === 'warnings') {\n      return schemaWarningPaths;\n    }\n    if (focusMode === 'arrays') {\n      return denseArrayPaths;\n    }\n    return undefined;\n  }\n\n  function applyFocusMode() {\n    if (focusModeSelect instanceof HTMLSelectElement) {\n      focusModeSelect.value = focusMode;\n    }\n\n    const sourceSet = getFocusSourceSet();\n    if (focusMode === 'all') {\n      clearFocusFilters();\n      showFocusModeNotice('');\n      return;\n    }\n\n    const hasSources = sourceSet && sourceSet.size > 0;\n    if (!hasSources) {\n      clearFocusFilters();\n      showFocusModeNotice(getEmptyFocusMessage(focusMode));\n      return;\n    }\n\n    const sourceList = Array.from(sourceSet!);\n    showFocusModeNotice('');\n\n    nodeElements.forEach(({ element }) => {\n      const path = element.dataset.path;\n      const visible = isPathVisibleForSources(path, sourceSet!, sourceList);\n      element.classList.toggle('is-filter-hidden', !visible);\n    });\n\n    treeRoot.querySelectorAll('.tree-branch').forEach((branch) => {\n      const path = branch.getAttribute('data-path');\n      const visible = isPathVisibleForSources(path, sourceSet!, sourceList);\n      branch.classList.toggle('is-filter-hidden', !visible);\n    });\n\n    linksLayer?.querySelectorAll('.visualizer-link').forEach((link) => {\n      const from = link.getAttribute('data-from');\n      const to = link.getAttribute('data-to');\n      const visible =\n        isPathVisibleForSources(from, sourceSet!, sourceList) &&\n        isPathVisibleForSources(to, sourceSet!, sourceList);\n      link.classList.toggle('is-filter-hidden', !visible);\n    });\n  }\n\n  function clearFocusFilters() {\n    nodeElements.forEach(({ element }) => element.classList.remove('is-filter-hidden'));\n    treeRoot.querySelectorAll('.tree-branch').forEach((branch) => branch.classList.remove('is-filter-hidden'));\n    linksLayer?.querySelectorAll('.visualizer-link').forEach((link) => link.classList.remove('is-filter-hidden'));\n  }\n\n  function isPathVisibleForSources(pathKey: string | null | undefined, sourceSet: Set<string>, sourceList: string[]): boolean {\n    if (!pathKey) {\n      return true;\n    }\n    if (sourceSet.has(pathKey)) {\n      return true;\n    }\n    if (hasAncestorInSources(pathKey, sourceSet)) {\n      return true;\n    }\n    return hasDescendantInSources(pathKey, sourceList);\n  }\n\n  function hasAncestorInSources(pathKey: string, sourceSet: Set<string>): boolean {\n    const segments = parsePathSegments(pathKey);\n    while (segments.length) {\n      segments.pop();\n      const ancestorKey = serializePath(segments);\n      if (sourceSet.has(ancestorKey)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  function hasDescendantInSources(pathKey: string, sourceList: string[]): boolean {\n    if (!sourceList.length) {\n      return false;\n    }\n    for (const candidate of sourceList) {\n      if (isAncestorPath(pathKey, candidate)) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  function isAncestorPath(maybeAncestorKey: string, candidateKey: string): boolean {\n    const ancestorSegments = parsePathSegments(maybeAncestorKey);\n    const candidateSegments = parsePathSegments(candidateKey);\n    if (ancestorSegments.length >= candidateSegments.length) {\n      return false;\n    }\n    for (let index = 0; index < ancestorSegments.length; index += 1) {\n      if (ancestorSegments[index] !== candidateSegments[index]) {\n        return false;\n      }\n    }\n    return ancestorSegments.length > 0 || maybeAncestorKey === '[]';\n  }\n\n  function parsePathSegments(pathKey: string | null | undefined): (string | number)[] {\n    if (!pathKey) {\n      return [];\n    }\n    const cached = pathSegmentCache.get(pathKey);\n    if (cached) {\n      return cached.slice();\n    }\n    try {\n      const parsed = JSON.parse(pathKey);\n      if (Array.isArray(parsed)) {\n        pathSegmentCache.set(pathKey, parsed);\n        return parsed.slice();\n      }\n    } catch {\n      // ignore parse errors\n    }\n    return [];\n  }\n\n  function showFocusModeNotice(message?: string) {\n    if (!(focusModeNotice instanceof HTMLElement)) {\n      return;\n    }\n    if (!message) {\n      focusModeNotice.textContent = '';\n      focusModeNotice.setAttribute('hidden', 'true');\n      return;\n    }\n    focusModeNotice.textContent = message;\n    focusModeNotice.removeAttribute('hidden');\n  }\n\n  function getEmptyFocusMessage(mode: FocusMode): string {\n    switch (mode) {\n      case 'required':\n        return 'No required properties detected.';\n      case 'warnings':\n        return 'No schema warnings detected.';\n      case 'arrays':\n        return `No arrays with ≥ ${ARRAY_DENSITY_THRESHOLD} items detected.`;\n      default:\n        return '';\n    }\n  }\n\n  function applyInsightHighlights() {\n    nodeElements.forEach(({ element }) => {\n      const path = element.dataset.path;\n      const severity = path ? schemaInsightSeverity.get(path) : undefined;\n      toggleInsightHighlight(element, severity);\n    });\n\n    treeRoot.querySelectorAll('.tree-node').forEach((node) => {\n      const path = node.getAttribute('data-path');\n      const severity = path ? schemaInsightSeverity.get(path) : undefined;\n      if (severity) {\n        node.classList.add('has-schema-warning');\n        node.setAttribute('data-schema-severity', severity);\n      } else {\n        node.classList.remove('has-schema-warning');\n        node.removeAttribute('data-schema-severity');\n      }\n    });\n  }\n\n  function toggleInsightHighlight(element: HTMLElement | undefined, severity?: 'error' | 'warning') {\n    if (!element) {\n      return;\n    }\n    if (!severity) {\n      element.classList.remove('has-schema-warning');\n      element.removeAttribute('data-schema-severity');\n      return;\n    }\n    element.classList.add('has-schema-warning');\n    element.setAttribute('data-schema-severity', severity);\n  }\n\n\n  function persistState(options = { savePositions: true }) {\n    if (options.savePositions !== false && currentDocumentId) {\n      nodePositionStore[currentDocumentId] = serializePositions(nodePositions);\n    }\n\n    const docKey = currentDocumentId ?? 'default';\n    if (docKey) {\n      layoutPresetStore[docKey] = currentLayoutPreset;\n    }\n\n    persistedState = {\n      ...persistedState,\n      viewMode,\n      nodePositions: nodePositionStore,\n      controlsCollapsed,\n      layoutPresets: layoutPresetStore,\n      focusMode\n    };\n    if (typeof vscode.setState === 'function') {\n      vscode.setState(persistedState);\n    }\n  }\n\n  function applyLayoutPreset(\n    preset: LayoutPreset,\n    options: { persist?: boolean; rerender?: boolean } = {}\n  ) {\n    const normalized = normalizeLayoutPreset(preset);\n    const changed = normalized !== currentLayoutPreset;\n    currentLayoutPreset = normalized;\n\n    if (layoutPresetSelect instanceof HTMLSelectElement) {\n      layoutPresetSelect.value = normalized;\n    }\n\n    const shouldPersist = options.persist !== false;\n    if (shouldPersist) {\n      const docKey = currentDocumentId ?? 'default';\n      if (docKey) {\n        layoutPresetStore[docKey] = normalized;\n      }\n      persistState({ savePositions: false });\n    }\n\n    if (changed && options.rerender !== false) {\n      needsInitialGraphFocus = true;\n      pendingSearchFocusId = ROOT_PATH;\n      hasUserMovedView = false;\n      rerenderFromState(true);\n    }\n  }\n\n  function normalizeLayoutPreset(value: unknown): LayoutPreset {\n    if (value === 'compact' || value === 'relaxed') {\n      return value;\n    }\n    return 'balanced';\n  }\n\n  function getCurrentLayoutSpacing() {\n    return LAYOUT_PRESETS[currentLayoutPreset] ?? LAYOUT_PRESETS.balanced;\n  }\n\n  function syncLayoutPresetWithDocument() {\n    const docKey = currentDocumentId ?? 'default';\n    const stored = typeof docKey === 'string' ? layoutPresetStore[docKey] : undefined;\n    const desired = normalizeLayoutPreset(stored ?? configDefaultLayoutPreset);\n    applyLayoutPreset(desired, { persist: false, rerender: false });\n  }\n\n  function switchDocument(documentId) {\n    if (currentDocumentId === documentId) {\n      return;\n    }\n\n    pathSegmentCache.clear();\n\n    if (currentDocumentId) {\n      persistState();\n      collapsedPathStore.set(currentDocumentId, new Set(collapsedPaths));\n      depthExpandedPathStore.set(currentDocumentId, new Set(depthExpandedPaths));\n    }\n\n    currentDocumentId = documentId;\n    const stored = nodePositionStore[documentId];\n    nodePositions = new Map(stored ? Object.entries(stored) : []);\n    const collapsed = collapsedPathStore.get(documentId);\n    collapsedPaths = new Set(collapsed instanceof Set ? collapsed : []);\n    const expanded = depthExpandedPathStore.get(documentId);\n    depthExpandedPaths = new Set(expanded instanceof Set ? expanded : []);\n    needsInitialGraphFocus = true;\n  }\n\n  function pruneNodePositions(validIds) {\n    let changed = false;\n    for (const id of Array.from(nodePositions.keys())) {\n      if (!validIds.has(id)) {\n        nodePositions.delete(id);\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      persistState();\n    }\n  }\n\n  function handleContainerClick(event) {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) {\n      return;\n    }\n\n    const schemaTarget = target.closest('[data-action=\"open-schema\"]');\n    if (schemaTarget instanceof HTMLElement) {\n      const path = schemaTarget.getAttribute('data-path');\n      if (!path) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      vscode.postMessage({ type: 'schema:open', payload: { path } });\n      return;\n    }\n\n    const editValueTarget = target.closest('[data-action=\"edit-value\"]');\n    if (editValueTarget instanceof HTMLElement) {\n      const path = editValueTarget.getAttribute('data-path');\n      const literal = editValueTarget.getAttribute('data-literal');\n      const kind = editValueTarget.getAttribute('data-kind') ?? 'string';\n      const href = editValueTarget.getAttribute('data-href');\n      if (!path || !literal) {\n        return;\n      }\n\n      if (href && (event.metaKey || event.ctrlKey)) {\n        event.preventDefault();\n        vscode.postMessage({ type: 'openLink', payload: href });\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n      requestEditValue(path, literal, kind);\n      return;\n    }\n\n    const link = target.closest('[data-open-link=\"true\"]');\n    const href = link instanceof HTMLAnchorElement ? link.href : link?.getAttribute('data-href');\n    if (href) {\n      event.preventDefault();\n      vscode.postMessage({ type: 'openLink', payload: href });\n      return;\n    }\n\n    const renameTarget = target.closest('[data-action=\"rename\"]');\n    if (renameTarget instanceof HTMLElement) {\n      const path = renameTarget.getAttribute('data-path');\n      const currentName = renameTarget.getAttribute('data-key') ?? '';\n      if (!path) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      requestRename(path, currentName);\n      return;\n    }\n\n\n    const toggle = target.closest('button[data-action=\"toggle\"]');\n    if (toggle) {\n      const path = toggle.getAttribute('data-path');\n      if (!path) {\n        return;\n      }\n\n      event.preventDefault();\n      togglePath(path);\n    }\n  }\n\n  function handleKeydown(event) {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) {\n      return;\n    }\n\n    if (\n      (event.key === 'Enter' || event.key === ' ') &&\n      target.hasAttribute('data-action') &&\n      target.getAttribute('data-action') === 'rename'\n    ) {\n      const path = target.getAttribute('data-path');\n      const currentName = target.getAttribute('data-key') ?? '';\n      if (!path) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      requestRename(path, currentName);\n      return;\n    }\n\n    if (\n      (event.key === 'Enter' || event.key === ' ') &&\n      target.hasAttribute('data-action') &&\n      target.getAttribute('data-action') === 'edit-value'\n    ) {\n      const path = target.getAttribute('data-path');\n      const literal = target.getAttribute('data-literal');\n      const kind = target.getAttribute('data-kind') ?? 'string';\n      if (!path || !literal) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      requestEditValue(path, literal, kind);\n    }\n  }\n\n  function togglePath(path) {\n    if (!path) {\n      return;\n    }\n\n    if (isAutoCollapsedPath(path)) {\n      depthExpandedPaths.add(path);\n      rerenderFromState(false);\n      focusPath(path);\n      return;\n    }\n\n    if (collapsedPaths.has(path)) {\n      collapsedPaths.delete(path);\n      depthExpandedPaths.add(path);\n    } else {\n      collapsedPaths.add(path);\n      depthExpandedPaths.delete(path);\n    }\n\n    rerenderFromState(false);\n    focusPath(path);\n  }\n\n  function rememberPathDepth(pathKey, depth) {\n    pathDepths.set(pathKey, depth);\n  }\n\n  function getActiveDepthLimit() {\n    if (typeof graphMaxDepth === 'number' && Number.isFinite(graphMaxDepth) && graphMaxDepth > 0) {\n      return graphMaxDepth;\n    }\n    return undefined;\n  }\n\n  function shouldCollapseByDepth(pathKey, depth) {\n    const limit = getActiveDepthLimit();\n    if (typeof limit !== 'number') {\n      return false;\n    }\n    return depth >= limit && !depthExpandedPaths.has(pathKey);\n  }\n\n  function isAutoCollapsedPath(pathKey) {\n    const depth = pathDepths.get(pathKey);\n    if (typeof depth !== 'number') {\n      return false;\n    }\n    return shouldCollapseByDepth(pathKey, depth);\n  }\n\n  function requestRename(pathKey, currentName) {\n    vscode.postMessage({\n      type: 'requestRename',\n      payload: { path: pathKey, currentName }\n    });\n  }\n\n  function requestEditValue(pathKey, literal, kind) {\n    vscode.postMessage({\n      type: 'requestEditValue',\n      payload: { path: pathKey, literal, kind }\n    });\n  }\n\n  function initViewport() {\n    viewport = document.createElement('div');\n    viewport.className = 'visualizer-viewport';\n\n    canvas = document.createElement('div');\n    canvas.className = 'visualizer-canvas';\n\n    linksLayer = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    linksLayer.classList.add('visualizer-links');\n    linksLayer.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n\n    nodesLayer = document.createElement('div');\n    nodesLayer.className = 'visualizer-nodes';\n\n    canvas.appendChild(linksLayer);\n    canvas.appendChild(nodesLayer);\n    viewport.appendChild(canvas);\n    graphRoot.appendChild(viewport);\n\n    setupPanAndZoom();\n  }\n\n  function setupPanAndZoom() {\n    viewport.addEventListener('pointerdown', (event) => {\n      if (event.button !== 0) {\n        return;\n      }\n\n      if (event.target instanceof HTMLElement && event.target.closest('.visualizer-node')) {\n        return;\n      }\n\n      isPanning = true;\n      hasUserMovedView = true;\n      panPointerId = event.pointerId;\n      panStart = { x: event.clientX, y: event.clientY };\n      panOrigin = { x: panState.x, y: panState.y };\n      viewport.setPointerCapture(panPointerId);\n      viewport.classList.add('is-panning');\n    });\n\n    viewport.addEventListener('pointermove', (event) => {\n      if (!isPanning || event.pointerId !== panPointerId) {\n        return;\n      }\n\n      const deltaX = event.clientX - panStart.x;\n      const deltaY = event.clientY - panStart.y;\n      panState.x = panOrigin.x + deltaX;\n      panState.y = panOrigin.y + deltaY;\n      applyPan();\n    });\n\n    const endPan = (event) => {\n      if (!isPanning || (event.pointerId !== undefined && event.pointerId !== panPointerId)) {\n        return;\n      }\n\n      isPanning = false;\n      const pointerToRelease = panPointerId;\n      panPointerId = null;\n      viewport.classList.remove('is-panning');\n      if (typeof pointerToRelease === 'number') {\n        try {\n          viewport.releasePointerCapture(pointerToRelease);\n        } catch {\n          // pointer may already be released; ignore\n        }\n      }\n    };\n\n    viewport.addEventListener('pointerup', endPan);\n    viewport.addEventListener('pointercancel', endPan);\n\n    viewport.addEventListener(\n      'wheel',\n      (event) => {\n        event.preventDefault();\n        const direction = event.deltaY < 0 ? 1 : -1;\n        const factor = direction > 0 ? 1.1 : 0.9;\n        const nextScale = clamp(panState.scale * factor, minScaleLimit, MAX_SCALE);\n        if (nextScale === panState.scale) {\n          return;\n        }\n\n        hasUserMovedView = true;\n        const rect = viewport.getBoundingClientRect();\n        const offsetX = event.clientX - rect.left;\n        const offsetY = event.clientY - rect.top;\n        const scaleRatio = nextScale / panState.scale;\n        panState.x = offsetX - (offsetX - panState.x) * scaleRatio;\n        panState.y = offsetY - (offsetY - panState.y) * scaleRatio;\n        panState.scale = nextScale;\n        applyPan();\n      },\n      { passive: false }\n    );\n\n    viewport.addEventListener('dblclick', () => {\n      resetPan(true);\n    });\n  }\n\n  function applyPan() {\n    if (!canvas) {\n      return;\n    }\n    canvas.style.transform = `translate(${panState.x}px, ${panState.y}px) scale(${panState.scale})`;\n  }\n\n  function resetPan(force, scaleOverride) {\n    if (!canvas || (!force && hasUserMovedView)) {\n      return;\n    }\n\n    const host = graphRoot;\n    const viewportWidth = host.clientWidth || 1;\n    const viewportHeight = host.clientHeight || 1;\n    const canvasRect = canvas.getBoundingClientRect();\n    const canvasWidth = Number.parseFloat(canvas.style.width) || canvasRect.width || viewportWidth;\n    const canvasHeight = Number.parseFloat(canvas.style.height) || canvasRect.height || viewportHeight;\n\n    const targetScale = typeof scaleOverride === 'number' ? scaleOverride : graphInitialScale;\n    const normalizedScale = typeof targetScale === 'number' ? targetScale : 1;\n    panState.scale = clamp(normalizedScale, minScaleLimit, MAX_SCALE);\n    panState.x = (viewportWidth - canvasWidth) / 2;\n    panState.y = Math.min(32, (viewportHeight - canvasHeight) / 2);\n    applyPan();\n  }\n\n  function updateMinScaleLimit(initialScale) {\n    if (graphAutoScale && typeof initialScale === 'number' && initialScale < MANUAL_MIN_SCALE) {\n      minScaleLimit = clamp(initialScale, AUTO_MIN_SCALE, MANUAL_MIN_SCALE);\n      return;\n    }\n    minScaleLimit = MANUAL_MIN_SCALE;\n  }\n\n  function rerenderFromState(force) {\n    if (typeof currentPayload === 'undefined') {\n      return;\n    }\n\n    if (force && viewMode === 'graph') {\n      resetPan(true, graphInitialScale);\n      hasUserMovedView = false;\n    }\n\n    renderData(currentPayload);\n  }\n\n  function setViewMode(mode) {\n    const normalized = mode === 'tree' ? 'tree' : 'graph';\n    if (normalized === viewMode) {\n      return;\n    }\n\n    viewMode = normalized;\n    hasPersistedViewPreference = true;\n    if (viewSelect instanceof HTMLSelectElement) {\n      viewSelect.value = normalized;\n    }\n\n    persistState();\n    if (currentPayload) {\n      renderData(currentPayload);\n    }\n  }\n\n  function renderVisualizer(payload) {\n    const data = payload && typeof payload === 'object' && 'data' in payload ? payload.data : payload;\n    const documentId =\n      payload && typeof payload === 'object' && typeof payload.documentId === 'string'\n        ? payload.documentId\n        : undefined;\n    const defaultViewMode =\n      payload && typeof payload === 'object' && typeof payload.defaultViewMode === 'string'\n        ? payload.defaultViewMode\n        : undefined;\n\n    const initialSelectionInfo =\n      payload && typeof payload === 'object' && 'selectionInfo' in payload ? payload.selectionInfo : undefined;\n    applySelectionInfo(initialSelectionInfo);\n\n    if (payload && typeof payload === 'object' && 'schemaPointers' in payload) {\n      applySchemaPointers(payload.schemaPointers);\n    }\n\n    if (payload && typeof payload === 'object') {\n      if (payload.focusRoot) {\n        if (viewMode !== 'graph') {\n          setViewMode('graph');\n        }\n        pendingSearchFocusId = ROOT_PATH;\n      }\n      if (payload.resetLayout && currentDocumentId) {\n        nodePositions = new Map();\n        nodePositionStore[currentDocumentId] = {};\n      }\n      if (payload.resetView || payload.focusRoot) {\n        needsInitialGraphFocus = true;\n        hasUserMovedView = false;\n        pendingSearchFocusId = undefined;\n        currentSearchMatch = undefined;\n      }\n      if (typeof payload.graphAutoScale === 'boolean') {\n        graphAutoScale = payload.graphAutoScale;\n      }\n      if (typeof payload.graphInitialScale === 'number') {\n        manualGraphScale = clampScale(payload.graphInitialScale);\n      }\n      if (typeof payload.graphMaxDepth === 'number') {\n        graphMaxDepth = Number.isFinite(payload.graphMaxDepth) && payload.graphMaxDepth > 0 ? Math.floor(payload.graphMaxDepth) : undefined;\n      } else if (payload.graphMaxDepth === null) {\n        graphMaxDepth = undefined;\n      }\n      if (typeof payload.graphLayoutPreset === 'string') {\n        configDefaultLayoutPreset = normalizeLayoutPreset(payload.graphLayoutPreset);\n      }\n    }\n\n    if (documentId) {\n      switchDocument(documentId);\n    } else if (!currentDocumentId) {\n      currentDocumentId = 'default';\n      nodePositions = new Map();\n      needsInitialGraphFocus = true;\n    }\n    syncLayoutPresetWithDocument();\n\n    if (defaultViewMode) {\n      const normalized = defaultViewMode === 'tree' ? 'tree' : 'graph';\n      preferredDefaultViewMode = normalized;\n      if (!hasPersistedViewPreference && viewMode !== normalized) {\n        viewMode = normalized;\n        if (viewSelect instanceof HTMLSelectElement) {\n          viewSelect.value = normalized;\n        }\n      }\n    }\n\n    if (typeof data === 'undefined') {\n      return;\n    }\n\n    currentPayload = data;\n    renderData(data);\n  }\n\n  function renderData(data) {\n    hideStatus();\n    pathDepths.clear();\n    denseArrayPaths = new Set<string>();\n    const graphData = buildGraph(data);\n    updateSearchIndex(graphData.nodes);\n\n    if (viewMode === 'tree') {\n      renderTreeView(data);\n    } else {\n      renderGraph(graphData);\n    }\n  }\n\n  function renderGraph(graph) {\n    graphRoot.removeAttribute('hidden');\n    treeRoot.setAttribute('hidden', 'true');\n\n    if (!viewport) {\n      initViewport();\n    }\n\n    nodesLayer.innerHTML = '';\n    linksLayer.innerHTML = '';\n    nodeElements.clear();\n\n    canvas.style.width = `${graph.size.width}px`;\n    canvas.style.height = `${graph.size.height}px`;\n    linksLayer.setAttribute('width', String(graph.size.width));\n    linksLayer.setAttribute('height', String(graph.size.height));\n    linksLayer.setAttribute('viewBox', `0 0 ${graph.size.width} ${graph.size.height}`);\n\n    graph.nodes.forEach((node) => {\n      const element = createGraphNodeElement(node);\n      nodesLayer.appendChild(element);\n      nodeElements.set(node.id, { node, element });\n    });\n\n    currentEdges = graph.edges;\n    pruneNodePositions(new Set(graph.nodes.map((node) => node.id)));\n    drawEdges(currentEdges);\n\n    const targetScale = graphAutoScale ? computeAutoScale(graph.size, graph.nodes.length) : clampScale(manualGraphScale);\n    graphInitialScale = targetScale;\n    updateMinScaleLimit(graphInitialScale);\n\n    if (hasUserMovedView) {\n      resetPan(false);\n    } else {\n      resetPan(true, graphInitialScale);\n      hasUserMovedView = false;\n    }\n\n    applyPan();\n    applySearchHighlight();\n    if (pendingSearchFocusId) {\n      focusGraphNode(pendingSearchFocusId);\n      pendingSearchFocusId = undefined;\n      needsInitialGraphFocus = false;\n    } else if (currentSearchMatch) {\n      highlightGraphNode(currentSearchMatch);\n      needsInitialGraphFocus = false;\n    } else if (needsInitialGraphFocus) {\n      focusGraphNode(ROOT_PATH);\n      needsInitialGraphFocus = false;\n    }\n\n    applyInsightHighlights();\n    applyFocusMode();\n  }\n\n  function renderTreeView(payload) {\n    treeRoot.removeAttribute('hidden');\n    graphRoot.setAttribute('hidden', 'true');\n\n    treeRoot.innerHTML = '';\n    const tree = document.createElement('ul');\n    tree.className = 'visualizer-tree';\n    tree.setAttribute('role', 'tree');\n    tree.appendChild(buildTreeBranch('JSON', payload, [], 0));\n    treeRoot.appendChild(tree);\n\n    applyInsightHighlights();\n    applyFocusMode();\n  }\n\n  function buildTreeBranch(key, value, path, depth) {\n    const pathKey = serializePath(path);\n    const schemaInfo = schemaPointerIndex.get(pathKey);\n    const entries = getChildEntries(value);\n    const hasChildren = entries.length > 0;\n    rememberPathDepth(pathKey, depth);\n    const depthLimited = shouldCollapseByDepth(pathKey, depth);\n    const isCollapsed = hasChildren && (collapsedPaths.has(pathKey) || depthLimited);\n\n    const listItem = document.createElement('li');\n    listItem.className = 'tree-branch';\n    listItem.dataset.path = pathKey;\n    listItem.dataset.depth = String(depth);\n    if (hasChildren) {\n      listItem.setAttribute('aria-expanded', String(!isCollapsed));\n    }\n    if (isCollapsed) {\n      listItem.classList.add('is-collapsed');\n    }\n\n    const control = document.createElement(hasChildren ? 'button' : 'div');\n    control.className = `tree-node ${hasChildren ? 'tree-node--branch' : 'tree-node--leaf'}`;\n    control.dataset.path = pathKey;\n    control.dataset.depth = String(depth);\n\n    if (hasChildren) {\n      control.type = 'button';\n      control.dataset.action = 'toggle';\n      control.setAttribute('aria-expanded', String(!isCollapsed));\n    }\n\n    const chevron = document.createElement('span');\n    chevron.className = 'tree-node__chevron';\n    chevron.setAttribute('aria-hidden', 'true');\n    control.appendChild(chevron);\n\n    const keySpan = document.createElement('span');\n    const canRename = typeof path[path.length - 1] === 'string';\n    keySpan.className = `tree-node__key${canRename ? ' tree-node__key--action' : ''}`;\n    keySpan.textContent = String(key);\n    if (canRename) {\n      keySpan.dataset.action = 'rename';\n      keySpan.dataset.path = pathKey;\n      keySpan.dataset.key = String(key);\n      keySpan.setAttribute('role', 'button');\n      keySpan.setAttribute('tabindex', '0');\n      keySpan.title = 'Rename key';\n    }\n    control.appendChild(keySpan);\n\n    const connector = document.createElement('span');\n    connector.className = 'tree-node__connector';\n    connector.setAttribute('aria-hidden', 'true');\n    control.appendChild(connector);\n\n    const descriptor = describeValue(value);\n    const valueElement = createValueElement(descriptor, 'tree-node__value', {\n      path: pathKey,\n      editable: canEditValueDescriptor(descriptor),\n      schemaPointer: schemaInfo\n    });\n    control.appendChild(valueElement);\n\n    listItem.appendChild(control);\n\n    if (hasChildren && !isCollapsed) {\n      const childList = document.createElement('ul');\n      childList.className = 'visualizer-tree-children';\n      childList.setAttribute('role', 'group');\n      entries.forEach(([childKey, childValue]) => {\n        const childPath = path.concat([childKey]);\n        const childLabel = formatChildKey(key, childKey, value);\n        childList.appendChild(buildTreeBranch(childLabel, childValue, childPath, depth + 1));\n      });\n      listItem.appendChild(childList);\n    }\n\n    return listItem;\n  }\n\n  function renderInvalidState(message) {\n    selectionActive = false;\n    selectionLabel = '';\n    updateSelectionIndicator();\n    graphRoot.setAttribute('hidden', 'true');\n    treeRoot.setAttribute('hidden', 'true');\n    status.textContent = message || 'The document contains syntax errors.';\n    status.removeAttribute('hidden');\n    showFocusModeNotice('');\n  }\n\n  function hideStatus() {\n    status.setAttribute('hidden', 'true');\n  }\n\n  function buildGraph(payload) {\n    const nodes = [];\n    const edges = [];\n    let maxDepth = 0;\n    let nextRow = 0;\n    const layoutSpacing = getCurrentLayoutSpacing();\n    const gapX = layoutSpacing.gapX;\n    const gapY = layoutSpacing.gapY;\n\n    const traverse = (key, value, path, depth, parentId) => {\n      const pathKey = serializePath(path);\n      const schemaInfo = schemaPointerIndex.get(pathKey);\n      rememberPathDepth(pathKey, depth);\n      const children = getChildEntries(value);\n      const hasChildren = children.length > 0;\n      const depthLimited = shouldCollapseByDepth(pathKey, depth);\n      const isCollapsed = hasChildren && (collapsedPaths.has(pathKey) || depthLimited);\n\n      const lastSegment = path[path.length - 1];\n      const node = {\n        id: pathKey,\n        key: String(key),\n        descriptor: describeValue(value),\n        depth,\n        x: depth * gapX,\n        y: 0,\n        hasChildren,\n        isCollapsed,\n        canRename: typeof lastSegment === 'string',\n        schemaPointer: schemaInfo\n      };\n\n      trackArrayDensity(pathKey, value);\n\n      nodes.push(node);\n      maxDepth = Math.max(maxDepth, depth);\n\n      if (parentId) {\n        edges.push({ from: parentId, to: pathKey });\n      }\n\n      if (!hasChildren || isCollapsed) {\n        node.y = nextRow * gapY;\n        nextRow += 1;\n        return node.y;\n      }\n\n      const childPositions = children.map(([childKey, childValue]) =>\n        traverse(formatChildKey(key, childKey, value), childValue, path.concat([childKey]), depth + 1, pathKey)\n      );\n\n      if (childPositions.length) {\n        const top = childPositions[0];\n        const bottom = childPositions[childPositions.length - 1];\n        node.y = top + (bottom - top) / 2;\n      } else {\n        node.y = nextRow * gapY;\n        nextRow += 1;\n      }\n\n      return node.y;\n    };\n\n    traverse('JSON', payload, [], 0, null);\n\n    const width = (maxDepth + 1) * gapX + CANVAS_PADDING * 2;\n    const height = Math.max(nextRow * gapY, gapY) + CANVAS_PADDING * 2;\n\n    nodes.forEach((node) => {\n      node.x += CANVAS_PADDING;\n      node.y += CANVAS_PADDING;\n      const custom = nodePositions.get(node.id);\n      if (custom) {\n        node.x = custom.x;\n        node.y = custom.y;\n      }\n    });\n\n    return {\n      nodes,\n      edges,\n      size: { width, height }\n    };\n  }\n\n  function createGraphNodeElement(node) {\n    const element = document.createElement(node.hasChildren ? 'button' : 'div');\n    element.className = `visualizer-node ${node.hasChildren ? 'visualizer-node--branch' : 'visualizer-node--leaf'}`;\n    element.style.left = `${node.x}px`;\n    element.style.top = `${node.y}px`;\n    element.dataset.path = node.id;\n\n    if (node.hasChildren) {\n      element.type = 'button';\n      element.dataset.action = 'toggle';\n      element.setAttribute('aria-expanded', String(!node.isCollapsed));\n      if (node.isCollapsed) {\n        element.classList.add('is-collapsed');\n      }\n    }\n\n    const chevron = document.createElement('span');\n    chevron.className = 'visualizer-node__chevron';\n    chevron.setAttribute('aria-hidden', 'true');\n    element.appendChild(chevron);\n\n    const key = document.createElement('span');\n    key.className = `visualizer-node__key${node.canRename ? ' visualizer-node__key--action' : ''}`;\n    key.textContent = node.key;\n    if (node.canRename) {\n      key.dataset.action = 'rename';\n      key.dataset.path = node.id;\n      key.dataset.key = node.key;\n      key.setAttribute('role', 'button');\n      key.setAttribute('tabindex', '0');\n      key.title = 'Rename key';\n    }\n    element.appendChild(key);\n\n    const connector = document.createElement('span');\n    connector.className = 'visualizer-node__connector';\n    connector.setAttribute('aria-hidden', 'true');\n    element.appendChild(connector);\n\n      const valueElement = createValueElement(node.descriptor, 'visualizer-node__value', {\n        path: node.id,\n        editable: !node.hasChildren && canEditValueDescriptor(node.descriptor),\n        schemaPointer: node.schemaPointer\n      });\n    element.appendChild(valueElement);\n\n    enableNodeDragging(element, node);\n\n    return element;\n  }\n\n  function enableNodeDragging(element, node) {\n    element.addEventListener('pointerdown', (event) => {\n      if (!shouldStartNodeDrag(event)) {\n        return;\n      }\n\n      activeNodeDrag = {\n        id: node.id,\n        pointerId: event.pointerId,\n        startX: event.clientX,\n        startY: event.clientY,\n        originX: node.x,\n        originY: node.y,\n        moved: false\n      };\n\n      element.setPointerCapture(event.pointerId);\n      event.preventDefault();\n    });\n\n    element.addEventListener('pointermove', (event) => {\n      if (!activeNodeDrag || activeNodeDrag.id !== node.id || event.pointerId !== activeNodeDrag.pointerId) {\n        return;\n      }\n\n      const deltaX = (event.clientX - activeNodeDrag.startX) / panState.scale;\n      const deltaY = (event.clientY - activeNodeDrag.startY) / panState.scale;\n      const newX = activeNodeDrag.originX + deltaX;\n      const newY = activeNodeDrag.originY + deltaY;\n      updateNodePosition(node.id, newX, newY);\n      activeNodeDrag.moved = true;\n      event.preventDefault();\n    });\n\n    const endDrag = (event) => finishNodeDrag(event, node, element);\n    element.addEventListener('pointerup', endDrag);\n    element.addEventListener('pointercancel', endDrag);\n\n    element.addEventListener('click', (event) => {\n      if (element.dataset.dragging === 'true') {\n        event.preventDefault();\n        event.stopPropagation();\n        element.dataset.dragging = '';\n      }\n    });\n  }\n\n  function drawEdges(edges) {\n    linksLayer.innerHTML = '';\n\n    edges.forEach((edge) => {\n      const parent = nodeElements.get(edge.from);\n      const child = nodeElements.get(edge.to);\n\n      if (!parent || !child) {\n        return;\n      }\n\n      const parentWidth = parent.element.offsetWidth;\n      const parentHeight = parent.element.offsetHeight;\n      const childHeight = child.element.offsetHeight;\n\n      const startX = parent.node.x + parentWidth;\n      const startY = parent.node.y + parentHeight / 2;\n      const endX = child.node.x;\n      const endY = child.node.y + childHeight / 2;\n      const controlOffset = Math.max(32, (endX - startX) / 2);\n\n      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n      path.setAttribute(\n        'd',\n        `M ${startX} ${startY} C ${startX + controlOffset} ${startY}, ${endX - controlOffset} ${endY}, ${endX} ${endY}`\n      );\n      path.setAttribute('class', 'visualizer-link');\n      path.dataset.from = edge.from;\n      path.dataset.to = edge.to;\n      linksLayer.appendChild(path);\n    });\n  }\n\n  function updateNodePosition(nodeId, x, y) {\n    const entry = nodeElements.get(nodeId);\n    if (!entry) {\n      return;\n    }\n\n    entry.node.x = x;\n    entry.node.y = y;\n    entry.element.style.left = `${x}px`;\n    entry.element.style.top = `${y}px`;\n    drawEdges(currentEdges);\n  }\n\n  function finishNodeDrag(event, node, element) {\n    if (\n      !activeNodeDrag ||\n      activeNodeDrag.id !== node.id ||\n      (event.pointerId !== undefined && event.pointerId !== activeNodeDrag.pointerId)\n    ) {\n      return;\n    }\n\n    try {\n      element.releasePointerCapture(activeNodeDrag.pointerId);\n    } catch {\n      // no-op\n    }\n\n    const moved = activeNodeDrag.moved;\n    activeNodeDrag = undefined;\n\n    if (moved) {\n      element.dataset.dragging = 'true';\n      nodePositions.set(node.id, { x: node.x, y: node.y });\n      persistState();\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  function getChildEntries(value) {\n    if (Array.isArray(value)) {\n      return value.map((child, index) => [index, child]);\n    }\n\n    if (isObject(value)) {\n      return Object.entries(value);\n    }\n\n    return [];\n  }\n\n  function trackArrayDensity(pathKey, value) {\n    if (Array.isArray(value) && value.length >= ARRAY_DENSITY_THRESHOLD) {\n      denseArrayPaths.add(pathKey);\n    }\n  }\n\n  function describeValue(value) {\n    if (value === null) {\n      return { label: 'null', kind: 'null', icon: ICON_TYPES.null, rawValue: null };\n    }\n\n    if (Array.isArray(value)) {\n      return { label: `[${value.length}]`, kind: 'array', icon: ICON_TYPES.array, rawValue: '[array]' };\n    }\n\n    switch (typeof value) {\n      case 'object':\n        return {\n          label: `{${Object.keys(value || {}).length}}`,\n          kind: 'object',\n          icon: ICON_TYPES.object,\n          rawValue: '[object]'\n        };\n      case 'string': {\n        const trimmed = value.trim();\n        if (isUrl(trimmed)) {\n          return {\n            label: truncate(trimmed, 42),\n            kind: 'link',\n            href: trimmed,\n            title: trimmed,\n            icon: ICON_TYPES.link,\n            rawValue: trimmed\n          };\n        }\n        return {\n          label: `\"${truncate(value)}\"`,\n          kind: 'string',\n          title: value,\n          icon: ICON_TYPES.string,\n          rawValue: value\n        };\n      }\n      case 'number':\n        return { label: String(value), kind: 'number', icon: ICON_TYPES.number, rawValue: value };\n      case 'boolean':\n        return { label: String(value), kind: 'boolean', icon: ICON_TYPES.boolean, rawValue: value };\n      default:\n        return { label: '', kind: 'unknown', icon: ICON_TYPES.unknown, rawValue: '' };\n    }\n  }\n\n  function canEditValueDescriptor(descriptor) {\n    if (!descriptor) {\n      return false;\n    }\n    return EDITABLE_VALUE_KINDS.has(descriptor.kind);\n  }\n\n  function serializeValueLiteral(rawValue) {\n    if (typeof rawValue === 'undefined') {\n      return 'null';\n    }\n\n    try {\n      return JSON.stringify(rawValue);\n    } catch {\n      return 'null';\n    }\n  }\n\n  function shouldStartNodeDrag(event) {\n    if (event.button !== 0) {\n      return false;\n    }\n\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) {\n      return true;\n    }\n\n    if (target.closest('[data-action=\"rename\"]')) {\n      return false;\n    }\n\n    if (target.closest('[data-action=\"edit-value\"]')) {\n      return false;\n    }\n\n    if (target.closest('[data-open-link=\"true\"]')) {\n      return false;\n    }\n\n    return true;\n  }\n\n  function createValueElement(\n    descriptor,\n    className,\n    options: { path?: string; editable?: boolean; schemaPointer?: SchemaPointerInfo } = {}\n  ) {\n    const element = document.createElement('span');\n    element.className = `${className} ${className}--${descriptor.kind}`;\n    const icon = createIconElement(descriptor.icon ?? ICON_TYPES.unknown);\n    element.appendChild(icon);\n\n    const textSpan = document.createElement('span');\n    textSpan.className = `${className}__text`;\n    textSpan.textContent = descriptor.label;\n    element.appendChild(textSpan);\n\n    if (descriptor.href) {\n      element.dataset.openLink = 'true';\n      element.setAttribute('data-href', descriptor.href);\n      if (descriptor.title) {\n        element.title = descriptor.title;\n      } else {\n        element.title = descriptor.href;\n      }\n    } else if (descriptor.title) {\n      element.title = descriptor.title;\n    }\n\n    if (options.editable && options.path) {\n      element.dataset.action = 'edit-value';\n      element.dataset.path = options.path;\n      element.dataset.kind = descriptor.kind === 'link' ? 'string' : descriptor.kind;\n      element.dataset.literal = serializeValueLiteral(descriptor.rawValue);\n      element.classList.add(`${className}--action`);\n      element.setAttribute('role', 'button');\n      element.setAttribute('tabindex', '0');\n      const baseTitle = element.title;\n      const editHint = descriptor.href\n        ? 'Click to edit value. Cmd/Ctrl+Click to open link.'\n        : 'Click to edit value.';\n      element.title = baseTitle ? `${baseTitle}\\n${editHint}` : editHint;\n    }\n\n    if (options.schemaPointer) {\n      applySchemaMetadataClasses(element, options.schemaPointer);\n    }\n\n    if (options.schemaPointer && options.path) {\n      element.appendChild(createSchemaButton(options.schemaPointer, options.path));\n    }\n\n    return element;\n  }\n\n  function createIconElement(type) {\n    const span = document.createElement('span');\n    span.className = 'value-icon';\n    const markup = ICON_SVGS[type] ?? ICON_SVGS.unknown;\n    span.innerHTML = markup;\n    const svg = span.querySelector('svg');\n    if (svg) {\n      svg.setAttribute('aria-hidden', 'true');\n      svg.setAttribute('focusable', 'false');\n    }\n    return span;\n  }\n\n  function createSchemaButton(schemaPointer: SchemaPointerInfo, path: string) {\n    const button = document.createElement('button');\n    button.type = 'button';\n    button.className = 'value-schema-button';\n    button.dataset.action = 'open-schema';\n    button.dataset.path = path;\n    button.textContent = 'Schema';\n    const tooltipLines = [];\n    if (schemaPointer.title) {\n      tooltipLines.push(schemaPointer.title);\n    }\n    if (schemaPointer.description) {\n      tooltipLines.push(schemaPointer.description);\n    }\n    tooltipLines.push(schemaPointer.pointer ? `Pointer: ${schemaPointer.pointer}` : 'Go to schema definition');\n    button.title = tooltipLines.join('\\n');\n    const pointerLabel = schemaPointer.pointer || 'schema';\n    button.setAttribute('aria-label', `Go to schema definition (${pointerLabel})`);\n    return button;\n  }\n\n  function applySchemaMetadataClasses(element, schemaPointer: SchemaPointerInfo) {\n    if (!schemaPointer) {\n      return;\n    }\n    if (schemaPointer.deprecated) {\n      element.classList.add('value--deprecated');\n      element.appendChild(createValueBadge('Deprecated', 'deprecated'));\n    }\n    if (schemaPointer.readOnly) {\n      element.classList.add('value--readonly');\n      element.appendChild(createValueBadge('Read-only', 'readonly'));\n    }\n    if (schemaPointer.writeOnly) {\n      element.classList.add('value--writeonly');\n      element.appendChild(createValueBadge('Write-only', 'writeonly'));\n    }\n  }\n\n  function createValueBadge(label: string, variant: string) {\n    const badge = document.createElement('span');\n    badge.className = `value-badge value-badge--${variant}`;\n    badge.textContent = label;\n    return badge;\n  }\n\n  function truncate(value, limit = 28) {\n    if (value.length <= limit) {\n      return value;\n    }\n\n    return `${value.slice(0, limit - 1)}…`;\n  }\n\n  function isObject(value) {\n    return typeof value === 'object' && value !== null;\n  }\n\n  function isUrl(value) {\n    return /^https?:\\/\\/[^\\s]+$/i.test(value);\n  }\n\n  function serializePath(path) {\n    return JSON.stringify(path);\n  }\n\n  function computeAutoScale(graphSize, nodeCount) {\n    const heuristicScale = clampAutoScale(computeDensityScale(nodeCount));\n    const fitScale = computeFitScale(graphSize);\n    const candidate = typeof fitScale === 'number' ? Math.min(fitScale, heuristicScale) : heuristicScale;\n    return clampAutoScale(Math.max(candidate, AUTO_VISIBLE_MIN_SCALE));\n  }\n\n  function computeFitScale(graphSize) {\n    if (!graphSize) {\n      return undefined;\n    }\n\n    const viewportWidth = viewport?.clientWidth || graphRoot.clientWidth || window.innerWidth || 1;\n    const viewportHeight = viewport?.clientHeight || graphRoot.clientHeight || window.innerHeight || 1;\n    const width = graphSize?.width ?? 0;\n    const height = graphSize?.height ?? 0;\n    if (width <= 0 || height <= 0) {\n      return undefined;\n    }\n\n    const ratio = Math.min(viewportWidth / width, viewportHeight / height);\n    const padded = ratio * AUTO_FIT_PADDING;\n    if (!Number.isFinite(padded) || padded <= 0) {\n      return undefined;\n    }\n\n    return padded;\n  }\n\n  function computeDensityScale(nodeCount) {\n    if (nodeCount > 2000) {\n      return 0.35;\n    }\n    if (nodeCount > 1200) {\n      return 0.45;\n    }\n    if (nodeCount > 800) {\n      return 0.55;\n    }\n    if (nodeCount > 500) {\n      return 0.65;\n    }\n    if (nodeCount > 300) {\n      return 0.8;\n    }\n    return 1;\n  }\n\n  function clampAutoScale(value) {\n    const candidate = typeof value === 'number' && Number.isFinite(value) ? value : 1;\n    return clamp(candidate, AUTO_MIN_SCALE, AUTO_MAX_SCALE);\n  }\n\n  function clampScale(value) {\n    const candidate = typeof value === 'number' ? value : 1;\n    return clamp(candidate, MANUAL_MIN_SCALE, AUTO_MAX_SCALE);\n  }\n\n  function clamp(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n  }\n\n  function formatChildKey(parentLabel, childKey, parentValue) {\n    if (!Array.isArray(parentValue)) {\n      return String(childKey);\n    }\n\n    const baseLabel = deriveArrayItemLabel(parentLabel);\n    const numeric = Number(childKey);\n    const suffix = Number.isInteger(numeric) ? numeric + 1 : String(childKey);\n    return `${baseLabel} ${suffix}`;\n  }\n\n  function deriveArrayItemLabel(parentLabel) {\n    if (!parentLabel || parentLabel === 'JSON') {\n      return 'Item';\n    }\n\n    const trimmed = parentLabel.trim();\n    if (!trimmed) {\n      return 'Item';\n    }\n\n    const lower = trimmed.toLowerCase();\n    if (lower.endsWith('ies')) {\n      return capitalize(lower.slice(0, -3) + 'y');\n    }\n\n    if (lower.endsWith('ses')) {\n      return capitalize(lower.slice(0, -2));\n    }\n\n    if (lower.endsWith('s')) {\n      return capitalize(lower.slice(0, -1));\n    }\n\n    return capitalize(lower);\n  }\n\n  function parseLineInput(value) {\n    if (typeof value !== 'string') {\n      return undefined;\n    }\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return undefined;\n    }\n    const parsed = Number.parseInt(trimmed, 10);\n    if (!Number.isFinite(parsed) || parsed <= 0) {\n      return undefined;\n    }\n    return parsed;\n  }\n\n  function normalizeLineRange(start, end) {\n    if (start > end) {\n      return { start: end, end: start };\n    }\n    return { start, end };\n  }\n\n  function formatSelectionLabel(start, end) {\n    if (start === end) {\n      return `Line ${start}`;\n    }\n    return `Lines ${start}-${end}`;\n  }\n\n  function capitalize(value) {\n    if (!value) {\n      return '';\n    }\n\n    return value.charAt(0).toUpperCase() + value.slice(1);\n  }\n\n  function formatProviderName(provider) {\n    switch (provider) {\n      case 'openai':\n        return 'OpenAI';\n      case 'anthropic':\n        return 'Anthropic';\n      default:\n        return capitalize(provider);\n    }\n  }\n\n  function getMissingKeyMessage() {\n    return `Set your ${formatProviderName(activeModelProvider)} API key to send messages.`;\n  }\n\n  function serializePositions(map) {\n    const result = {};\n    map.forEach((value, key) => {\n      result[key] = value;\n    });\n    return result;\n  }\n\n  function updateSearchIndex(nodes) {\n    searchIndex = new Map();\n    nodes.forEach((node) => {\n      const descriptorLabel = typeof node.descriptor?.label === 'string' ? node.descriptor.label : '';\n      const rawValue =\n        typeof node.descriptor?.rawValue === 'string'\n          ? node.descriptor.rawValue\n          : typeof node.descriptor?.rawValue !== 'undefined'\n            ? String(node.descriptor.rawValue)\n            : '';\n      const text = [node.key, descriptorLabel, rawValue].filter(Boolean).join(' ').toLowerCase();\n      searchIndex.set(node.id, { text });\n    });\n\n    if (currentSearchQuery) {\n      if (!searchIndex.has(currentSearchMatch ?? '')) {\n        currentSearchMatch = undefined;\n      }\n    }\n  }\n\n  function performSearch(query) {\n    currentSearchQuery = query;\n    if (!query) {\n      pendingSearchFocusId = undefined;\n      currentSearchMatch = undefined;\n      clearSearchHighlight();\n      return;\n    }\n\n    const normalized = query.toLowerCase();\n    let matchId;\n    for (const [id, payload] of searchIndex) {\n      if (payload.text.includes(normalized)) {\n        matchId = id;\n        break;\n      }\n    }\n\n    if (!matchId) {\n      clearSearchHighlight();\n      currentSearchMatch = undefined;\n      return;\n    }\n\n    currentSearchMatch = matchId;\n    pendingSearchFocusId = matchId;\n\n    if (viewMode !== 'graph') {\n      setViewMode('graph');\n      return;\n    }\n\n    focusGraphNode(matchId);\n  }\n\n  function clearSearchHighlight() {\n    nodeElements.forEach(({ element }) => element.classList.remove('is-search-hit'));\n    treeRoot.querySelectorAll('.tree-node.is-search-hit').forEach((node) => node.classList.remove('is-search-hit'));\n  }\n\n  function applySearchHighlight() {\n    clearSearchHighlight();\n    if (!currentSearchQuery || viewMode !== 'graph') {\n      return;\n    }\n\n    if (currentSearchMatch && nodeElements.has(currentSearchMatch)) {\n      nodeElements.get(currentSearchMatch).element.classList.add('is-search-hit');\n    }\n  }\n\n  function focusGraphNode(nodeId) {\n    const entry = nodeElements.get(nodeId);\n    if (!entry) {\n      return;\n    }\n\n    nodeElements.forEach(({ element }) => element.classList.remove('is-search-hit'));\n    entry.element.classList.add('is-search-hit');\n\n    const viewportWidth = viewport?.clientWidth ?? 0;\n    const viewportHeight = viewport?.clientHeight ?? 0;\n    const nodeWidth = entry.element.offsetWidth || 0;\n    const nodeHeight = entry.element.offsetHeight || 0;\n    const scale = panState.scale || 1;\n\n    panState.x = viewportWidth / 2 - (entry.node.x + nodeWidth / 2) * scale;\n    panState.y = viewportHeight / 2 - (entry.node.y + nodeHeight / 2) * scale;\n    applyPan();\n    pendingSearchFocusId = undefined;\n  }\n\n  function focusTreeNode(path) {\n    if (!path) {\n      return;\n    }\n    requestAnimationFrame(() => {\n      const selector = `.tree-node[data-path=\"${escapeCss(path)}\"]`;\n      const node = treeRoot.querySelector(selector);\n      if (!(node instanceof HTMLElement)) {\n        return;\n      }\n      node.scrollIntoView({ block: 'center', behavior: 'smooth' });\n      node.classList.add('is-search-hit');\n      if (typeof node.focus === 'function') {\n        node.focus({ preventScroll: true });\n      }\n      setTimeout(() => node.classList.remove('is-search-hit'), 800);\n    });\n  }\n\n  function focusPath(path) {\n    if (!path) {\n      return;\n    }\n    if (viewMode === 'graph') {\n      requestAnimationFrame(() => focusGraphNode(path));\n    } else {\n      focusTreeNode(path);\n    }\n  }\n\n  function setControlsCollapsed(value, options = { persist: true }) {\n    controlsCollapsed = Boolean(value);\n    if (controlDock instanceof HTMLElement) {\n      controlDock.classList.toggle('is-collapsed', controlsCollapsed);\n    }\n    if (controlDockPanel instanceof HTMLElement) {\n      controlDockPanel.setAttribute('aria-hidden', String(controlsCollapsed));\n    }\n    if (controlDockToggle instanceof HTMLButtonElement) {\n      controlDockToggle.setAttribute('aria-expanded', String(!controlsCollapsed));\n      controlDockToggle.title = controlsCollapsed ? 'Show controls' : 'Hide controls';\n      controlDockToggle.setAttribute('aria-label', controlsCollapsed ? 'Show controls' : 'Hide controls');\n    }\n    if (options.persist !== false) {\n      persistState();\n    }\n  }\n\n  function toggleChatPanel(forceState) {\n    if (!(chatPanel instanceof HTMLElement)) {\n      return;\n    }\n\n    const nextState = typeof forceState === 'boolean' ? forceState : !chatPanelVisible;\n    chatPanelVisible = nextState;\n    if (nextState) {\n      chatPanel.removeAttribute('hidden');\n      if (chatInput instanceof HTMLTextAreaElement) {\n        chatInput.focus();\n      }\n    } else {\n      chatPanel.setAttribute('hidden', 'true');\n    }\n  }\n\n  function applySelectionInfo(info) {\n    if (info && typeof info === 'object') {\n      selectionActive = Boolean(info.active);\n      const startLine = typeof info.startLine === 'number' ? info.startLine + 1 : undefined;\n      const endLine = typeof info.endLine === 'number' ? info.endLine + 1 : undefined;\n      const hasRange = typeof startLine === 'number' && typeof endLine === 'number';\n      selectionLineRange = selectionActive && hasRange ? { start: startLine, end: endLine } : {};\n    } else {\n      selectionActive = false;\n      selectionLineRange = {};\n    }\n    updateSelectionIndicator();\n  }\n\n  function updateSelectionIndicator() {\n    updateSelectionInputs();\n  }\n\n  function updateSelectionInputs() {\n    if (!(selectionStartInput instanceof HTMLInputElement) || !(selectionEndInput instanceof HTMLInputElement)) {\n      return;\n    }\n\n    if (typeof selectionLineRange.start === 'number') {\n      selectionStartInput.value = String(selectionLineRange.start);\n    } else if (!selectionStartInput.matches(':focus')) {\n      selectionStartInput.value = '';\n    }\n\n    if (typeof selectionLineRange.end === 'number') {\n      selectionEndInput.value = String(selectionLineRange.end);\n    } else if (!selectionEndInput.matches(':focus')) {\n      selectionEndInput.value = '';\n    }\n  }\n\n  function updateModelSelect(payload) {\n    if (!(chatModelSelect instanceof HTMLSelectElement)) {\n      return;\n    }\n\n    const options = Array.isArray(payload?.options) ? payload.options : [];\n    const selectedId = typeof payload?.selectedId === 'string' ? payload.selectedId : '';\n    if (typeof payload?.selectedProvider === 'string') {\n      activeModelProvider = payload.selectedProvider;\n    }\n    chatModelSelect.innerHTML = '';\n\n    if (!options.length) {\n      const placeholder = document.createElement('option');\n      placeholder.value = '';\n      placeholder.textContent = 'No models';\n      chatModelSelect.appendChild(placeholder);\n      chatModelSelect.disabled = true;\n      return;\n    }\n\n    options.forEach((option) => {\n      if (!option || typeof option !== 'object') {\n        return;\n      }\n      const element = document.createElement('option');\n      element.value = String(option.id ?? '');\n      element.textContent = option.label ?? option.id ?? 'Model';\n      if (option.description) {\n        element.title = option.description;\n      }\n      chatModelSelect.appendChild(element);\n    });\n\n    chatModelSelect.disabled = false;\n    if (selectedId) {\n      chatModelSelect.value = selectedId;\n    }\n  }\n\n  function ensureChatPanel() {\n    if (!chatPanelVisible) {\n      toggleChatPanel(true);\n    }\n  }\n\n  function clearChatMessages() {\n    chatMessageMap.clear();\n    if (chatMessages) {\n      chatMessages.innerHTML = '';\n    }\n  }\n\n  function renderChatHistory(messages) {\n    clearChatMessages();\n    if (!Array.isArray(messages)) {\n      return;\n    }\n\n    messages.forEach((entry) => setChatMessage(entry?.id, entry?.role ?? 'assistant', entry?.text ?? ''));\n  }\n\n  function setChatMessage(id, role, text, options = {}) {\n    if (!id) {\n      return;\n    }\n    const record = getOrCreateChatRecord(id, role);\n    record.text = options.pending ? '' : text;\n    record.element.classList.toggle('is-pending', Boolean(options.pending));\n    record.content.innerHTML = renderChatHtml(record.text, options.pending);\n    scrollChatToBottom();\n    showChatStatus('');\n  }\n\n  function appendChatDelta(id, delta) {\n    if (!id || !delta) {\n      return;\n    }\n    const record = getOrCreateChatRecord(id, 'assistant');\n    record.element.classList.remove('is-pending');\n    const isThinkingPlaceholder =\n      typeof record.text === 'string' && record.text.trim().startsWith('AI is thinking');\n    const current = isThinkingPlaceholder ? '' : record.text || '';\n    record.text = current + delta;\n    record.content.innerHTML = renderChatHtml(record.text);\n    scrollChatToBottom();\n    showChatStatus('');\n  }\n\n  function finalizeAssistantMessage(id, text, snippet) {\n    if (!id) {\n      return;\n    }\n    const record = getOrCreateChatRecord(id, 'assistant');\n    record.text = text;\n    record.element.classList.remove('is-pending');\n    record.content.innerHTML = renderChatHtml(text);\n\n    const existing = record.element.querySelector('.chat-message__actions');\n    if (existing) {\n      existing.remove();\n    }\n\n    if (snippet) {\n      const actions = document.createElement('div');\n      actions.className = 'chat-message__actions';\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.textContent = 'Apply snippet';\n      button.addEventListener('click', () => {\n        vscode.postMessage({ type: 'chat:applySnippet', payload: { content: snippet } });\n      });\n      actions.appendChild(button);\n      record.element.appendChild(actions);\n    }\n\n    scrollChatToBottom();\n  }\n\n  function getOrCreateChatRecord(id, role) {\n    let record = chatMessageMap.get(id);\n    if (!record) {\n      const wrapper = document.createElement('div');\n      wrapper.className = `chat-message chat-message--${role}`;\n      const content = document.createElement('div');\n      content.className = 'chat-message__content';\n      wrapper.appendChild(content);\n      chatMessages?.appendChild(wrapper);\n      record = { element: wrapper, content, text: '' };\n      chatMessageMap.set(id, record);\n    }\n    return record;\n  }\n\n  function scrollChatToBottom() {\n    if (!chatMessages) {\n      return;\n    }\n    requestAnimationFrame(() => {\n      chatMessages.scrollTop = chatMessages.scrollHeight;\n    });\n  }\n\n  function showChatStatus(text) {\n    if (!(chatStatus instanceof HTMLElement)) {\n      return;\n    }\n\n    const normalized = typeof text === 'string' ? text.trim() : '';\n    const isThinking =\n      normalized === 'Thinking…' ||\n      normalized === 'Thinking...' ||\n      normalized === 'AI is thinking…' ||\n      normalized === 'AI is thinking...';\n\n    if (isThinking) {\n      chatStatus.innerHTML =\n        'AI is thinking<span class=\"chat-status__dots\"><span>.</span><span>.</span><span>.</span></span>';\n      chatStatus.classList.add('is-thinking');\n      return;\n    }\n\n    chatStatus.textContent = text || '';\n    chatStatus.classList.remove('is-thinking');\n  }\n\n  function renderChatHtml(text, pending) {\n    if (pending) {\n      return `<span class=\"chat-pending-dots\"><span></span><span></span><span></span></span>`;\n    }\n\n    const escape = (value) =>\n      value\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n\n    const codeRegex = /```(\\w+)?\\s*([\\s\\S]*?)```/g;\n    let lastIndex = 0;\n    let html = '';\n    let match;\n    while ((match = codeRegex.exec(text)) !== null) {\n      html += escape(text.slice(lastIndex, match.index));\n      const lang = match[1]?.trim() ?? 'json';\n      const code = escape(match[2].trim());\n      html += `<pre class=\"chat-code\"><code class=\"lang-${lang}\">${code}</code></pre>`;\n      lastIndex = codeRegex.lastIndex;\n    }\n    html += escape(text.slice(lastIndex));\n    return html;\n  }\n\n  function escapeCss(value) {\n    if (typeof CSS !== 'undefined' && typeof CSS.escape === 'function') {\n      return CSS.escape(value);\n    }\n    return String(value).replace(/[\"\\\\]/g, '\\\\$&');\n  }\n\n})();\n"],"names":["vscode","container","status","viewSelect","layoutPresetSelect","focusModeSelect","focusModeNotice","searchInput","chatToggle","chatPanel","chatClose","chatReset","chatMessages","chatForm","chatInput","chatStatus","chatModelSelect","selectionLineForm","selectionStartInput","selectionEndInput","selectionClearButton","controlDock","controlDockPanel","controlDockToggle","graphRoot","treeRoot","nodeElements","pathDepths","collapsedPathStore","depthExpandedPathStore","collapsedPaths","depthExpandedPaths","persistedState","_a","nodePositionStore","_b","layoutPresetStore","nodePositions","currentDocumentId","currentEdges","activeNodeDrag","currentPayload","viewport","canvas","nodesLayer","linksLayer","isPanning","panPointerId","panStart","panOrigin","hasUserMovedView","viewMode","hasPersistedViewPreference","graphAutoScale","manualGraphScale","graphInitialScale","graphMaxDepth","searchIndex","currentSearchQuery","currentSearchMatch","pendingSearchFocusId","chatMessageMap","chatPanelVisible","awaitingChatKey","hasAiKey","selectionActive","selectionLineRange","controlsCollapsed","needsInitialGraphFocus","activeModelProvider","currentLayoutPreset","configDefaultLayoutPreset","focusMode","normalizeFocusMode","requiredPathSet","schemaWarningPaths","schemaInsightSeverity","denseArrayPaths","pathSegmentCache","LAYOUT_PRESETS","CANVAS_PADDING","MANUAL_MIN_SCALE","AUTO_MIN_SCALE","AUTO_MAX_SCALE","AUTO_FIT_PADDING","AUTO_VISIBLE_MIN_SCALE","MAX_SCALE","ICON_TYPES","EDITABLE_VALUE_KINDS","ARRAY_DENSITY_THRESHOLD","ROOT_PATH","ICON_SVGS","schemaPointerIndex","panState","minScaleLimit","event","next","setViewMode","value","normalizeLayoutPreset","applyLayoutPreset","setFocusMode","performSearch","toggleChatPanel","showChatStatus","getMissingKeyMessage","clearChatMessages","submitChatInput","startValue","parseLineInput","endValue","normalized","normalizeLineRange","updateSelectionInputs","setControlsCollapsed","handleContainerClick","handleKeydown","type","payload","renderVisualizer","renderInvalidState","renderChatHistory","ensureChatPanel","setChatMessage","appendChatDelta","finalizeAssistantMessage","_c","updateModelSelect","applySelectionInfo","path","focusGraphNode","applySchemaPointers","rerenderFromState","applySchemaInsights","raw","applyFocusMode","info","applyInsightHighlights","entry","pathKey","severity","mode","persistState","getFocusSourceSet","sourceSet","clearFocusFilters","showFocusModeNotice","getEmptyFocusMessage","sourceList","element","visible","isPathVisibleForSources","branch","link","from","to","hasAncestorInSources","hasDescendantInSources","segments","parsePathSegments","ancestorKey","serializePath","candidate","isAncestorPath","maybeAncestorKey","candidateKey","ancestorSegments","candidateSegments","index","cached","parsed","message","toggleInsightHighlight","node","options","serializePositions","docKey","preset","changed","getCurrentLayoutSpacing","syncLayoutPresetWithDocument","stored","desired","switchDocument","documentId","collapsed","expanded","pruneNodePositions","validIds","id","target","schemaTarget","editValueTarget","literal","kind","href","requestEditValue","renameTarget","currentName","requestRename","toggle","togglePath","isAutoCollapsedPath","focusPath","rememberPathDepth","depth","getActiveDepthLimit","shouldCollapseByDepth","limit","initViewport","setupPanAndZoom","deltaX","deltaY","applyPan","endPan","pointerToRelease","factor","nextScale","clamp","rect","offsetX","offsetY","scaleRatio","resetPan","force","scaleOverride","host","viewportWidth","viewportHeight","canvasRect","canvasWidth","canvasHeight","targetScale","normalizedScale","updateMinScaleLimit","initialScale","renderData","data","defaultViewMode","initialSelectionInfo","clampScale","hideStatus","graphData","buildGraph","updateSearchIndex","renderTreeView","renderGraph","graph","createGraphNodeElement","drawEdges","computeAutoScale","applySearchHighlight","tree","buildTreeBranch","key","schemaInfo","entries","getChildEntries","hasChildren","depthLimited","isCollapsed","listItem","control","chevron","keySpan","canRename","connector","descriptor","describeValue","valueElement","createValueElement","canEditValueDescriptor","childList","childKey","childValue","childPath","childLabel","formatChildKey","updateSelectionIndicator","nodes","edges","maxDepth","nextRow","layoutSpacing","gapX","gapY","traverse","parentId","children","lastSegment","trackArrayDensity","childPositions","top","bottom","width","height","custom","enableNodeDragging","shouldStartNodeDrag","newX","newY","updateNodePosition","endDrag","finishNodeDrag","edge","parent","child","parentWidth","parentHeight","childHeight","startX","startY","endX","endY","controlOffset","nodeId","x","y","moved","isObject","trimmed","isUrl","truncate","serializeValueLiteral","rawValue","className","icon","createIconElement","textSpan","baseTitle","editHint","applySchemaMetadataClasses","createSchemaButton","span","markup","svg","schemaPointer","button","tooltipLines","pointerLabel","createValueBadge","label","variant","badge","graphSize","nodeCount","heuristicScale","clampAutoScale","computeDensityScale","fitScale","computeFitScale","padded","min","max","parentLabel","parentValue","baseLabel","deriveArrayItemLabel","numeric","suffix","lower","capitalize","start","end","formatProviderName","provider","map","result","descriptorLabel","text","query","clearSearchHighlight","matchId","nodeWidth","nodeHeight","scale","focusTreeNode","selector","escapeCss","forceState","nextState","startLine","endLine","selectedId","placeholder","option","messages","role","record","getOrCreateChatRecord","renderChatHtml","scrollChatToBottom","delta","current","snippet","existing","actions","wrapper","content","pending","escape","codeRegex","lastIndex","html","match","lang","code"],"mappings":"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"}
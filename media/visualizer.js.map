{"version":3,"file":"visualizer.js","sources":["../webview/src/visualizer.ts"],"sourcesContent":["(function () {\n  const vscode = acquireVsCodeApi();\n  const container = document.getElementById('visualizer');\n  const status = document.getElementById('status');\n  const viewSelect = document.getElementById('visualizerViewSelect');\n  const layoutPresetSelect = document.getElementById('layoutPresetSelect');\n  const searchInput = document.getElementById('visualizerSearchInput');\n  const chatToggle = document.getElementById('chatToggle');\n  const chatPanel = document.getElementById('chatPanel');\n  const chatClose = document.getElementById('chatClose');\n  const chatReset = document.getElementById('chatReset');\n  const chatMessages = document.getElementById('chatMessages');\n  const chatForm = document.getElementById('chatForm');\n  const chatInput = document.getElementById('chatInput');\n  const chatStatus = document.getElementById('chatStatus');\n  const chatModelSelect = document.getElementById('chatModelSelect');\n  const selectionLineForm = document.getElementById('selectionLineForm');\n  const selectionStartInput = document.getElementById('selectionStartInput');\n  const selectionEndInput = document.getElementById('selectionEndInput');\n  const selectionClearButton = document.getElementById('selectionClearButton');\n  const controlDock = document.getElementById('controlDock');\n  const controlDockPanel = document.getElementById('controlDockPanel');\n  const controlDockToggle = document.getElementById('controlDockToggle');\n\n  if (!container || !status) {\n    vscode.postMessage({ type: 'ready' });\n    return;\n  }\n\n  const graphRoot = document.createElement('section');\n  graphRoot.className = 'visualizer-view visualizer-graph-view';\n  graphRoot.setAttribute('hidden', 'true');\n  container.appendChild(graphRoot);\n\n  const treeRoot = document.createElement('section');\n  treeRoot.className = 'visualizer-view visualizer-tree-view';\n  treeRoot.setAttribute('hidden', 'true');\n  container.appendChild(treeRoot);\n\n  const nodeElements = new Map();\n  const pathDepths = new Map();\n  const collapsedPathStore = new Map();\n  const depthExpandedPathStore = new Map();\n  let collapsedPaths = new Set();\n  let depthExpandedPaths = new Set();\n  let persistedState = typeof vscode.getState === 'function' ? vscode.getState() ?? {} : {};\n  let nodePositionStore = persistedState.nodePositions ?? {};\n  let layoutPresetStore =\n    typeof persistedState.layoutPresets === 'object' && persistedState.layoutPresets\n      ? persistedState.layoutPresets\n      : {};\n  let nodePositions = new Map();\n  let currentDocumentId;\n  let currentEdges = [];\n  let activeNodeDrag;\n\n  let currentPayload;\n  let viewport;\n  let canvas;\n  let nodesLayer;\n  let linksLayer;\n  let isPanning = false;\n  let panPointerId = null;\n  let panStart = { x: 0, y: 0 };\n  let panOrigin = { x: 0, y: 0 };\n  let hasUserMovedView = false;\n  let viewMode = persistedState.viewMode === 'tree' ? 'tree' : 'graph';\n  let hasPersistedViewPreference = typeof persistedState.viewMode === 'string';\n  let preferredDefaultViewMode = hasPersistedViewPreference ? viewMode : 'graph';\n  let graphAutoScale = true;\n  let manualGraphScale = 1;\n  let graphInitialScale = 1;\n  let graphMaxDepth;\n  let searchIndex = new Map();\n  let currentSearchQuery = '';\n  let currentSearchMatch;\n  let pendingSearchFocusId;\n  const chatMessageMap = new Map();\n  let chatPanelVisible = false;\n  let awaitingChatKey = false;\n  let hasAiKey = false;\n  let selectionActive = false;\n  let selectionLabel = '';\n  let selectionLineRange: { start?: number; end?: number } = {};\n  let controlsCollapsed = Boolean(persistedState.controlsCollapsed);\n  let needsInitialGraphFocus = true;\n  let activeModelProvider = 'openai';\n  let currentLayoutPreset: LayoutPreset = 'balanced';\n  let configDefaultLayoutPreset: LayoutPreset = 'balanced';\n\n  const LAYOUT_PRESETS = {\n    compact: { gapX: 210, gapY: 70 },\n    balanced: { gapX: 260, gapY: 90 },\n    relaxed: { gapX: 330, gapY: 110 }\n  } as const;\n  type LayoutPreset = keyof typeof LAYOUT_PRESETS;\n  const CANVAS_PADDING = 96;\n  const MANUAL_MIN_SCALE = 0.4;\n  const AUTO_MIN_SCALE = 0.02;\n  const AUTO_MAX_SCALE = 1.2;\n  const AUTO_FIT_PADDING = 0.9;\n  const AUTO_VISIBLE_MIN_SCALE = 0.35;\n  const MAX_SCALE = 2.5;\n  const ICON_TYPES = {\n    object: 'object',\n    array: 'array',\n    string: 'string',\n    number: 'number',\n    boolean: 'boolean',\n    null: 'null',\n    link: 'link',\n    unknown: 'unknown'\n  };\n  const EDITABLE_VALUE_KINDS = new Set(['string', 'number', 'boolean', 'null', 'link']);\n  const ROOT_PATH = JSON.stringify([]);\n  const ICON_SVGS = {\n    object:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M9 5H7c-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2 1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2h2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M15 5h2c1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2h-2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    array:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M5 7h14M5 12h14M5 17h14\" stroke-width=\"2\" stroke-linecap=\"round\"/></svg>',\n    string:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M9 7H7l-2 5 2 5h2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M15 7h2l2 5-2 5h-2\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    number:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M10 4v16M14 4v16M4 10h16M4 14h16\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    boolean:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><rect x=\"3\" y=\"7\" width=\"18\" height=\"10\" rx=\"5\" ry=\"5\" stroke-width=\"2\"/><circle cx=\"9\" cy=\"12\" r=\"3.5\" stroke-width=\"2\"/></svg>',\n    null:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><circle cx=\"12\" cy=\"12\" r=\"6\" stroke-width=\"2\"/><path d=\"M8.5 8.5 15.5 15.5\" stroke-width=\"2\" stroke-linecap=\"round\"/></svg>',\n    link:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><path d=\"M10 13a5 5 0 0 0 7.54.54l1.92-1.92a5 5 0 0 0-7.07-7.07l-1.09 1.09\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M14 11a5 5 0 0 0-7.54-.54l-1.92 1.92a5 5 0 0 0 7.07 7.07l1.09-1.09\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>',\n    unknown:\n      '<svg viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\"><circle cx=\"12\" cy=\"17\" r=\"1.5\" stroke-width=\"2\"/><path d=\"M12 13v-1.5a3.5 3.5 0 1 0-3.5-3.5\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>'\n  };\n\n  type SchemaPointerInfo = {\n    pointer: string;\n    title?: string;\n    description?: string;\n  };\n\n  let schemaPointerIndex = new Map<string, SchemaPointerInfo>();\n\n  const panState = { x: 0, y: 0, scale: 1 };\n  let minScaleLimit = MANUAL_MIN_SCALE;\n\n  if (viewSelect instanceof HTMLSelectElement) {\n    viewSelect.value = viewMode;\n    viewSelect.addEventListener('change', (event) => {\n      const next = event.target.value === 'tree' ? 'tree' : 'graph';\n      setViewMode(next);\n    });\n  }\n\n  if (layoutPresetSelect instanceof HTMLSelectElement) {\n    layoutPresetSelect.value = currentLayoutPreset;\n    layoutPresetSelect.addEventListener('change', (event) => {\n      const value = event.target.value;\n      const next = normalizeLayoutPreset(value);\n      applyLayoutPreset(next);\n    });\n  }\n\n  if (searchInput instanceof HTMLInputElement) {\n    searchInput.addEventListener('input', (event) => {\n      const value = event.target.value.trim();\n      performSearch(value);\n    });\n  }\n\n  if (chatToggle instanceof HTMLButtonElement) {\n    chatToggle.addEventListener('click', () => {\n      if (chatPanelVisible) {\n        toggleChatPanel(false);\n        return;\n      }\n\n      toggleChatPanel(true);\n      if (hasAiKey) {\n        showChatStatus('');\n        return;\n      }\n\n      awaitingChatKey = true;\n      showChatStatus(getMissingKeyMessage());\n      vscode.postMessage({ type: 'chat:ensureKey' });\n    });\n  }\n\n  if (chatClose instanceof HTMLButtonElement) {\n    chatClose.addEventListener('click', () => toggleChatPanel(false));\n  }\n\n  if (chatReset instanceof HTMLButtonElement) {\n    chatReset.addEventListener('click', () => {\n      vscode.postMessage({ type: 'chat:reset' });\n      clearChatMessages();\n    });\n  }\n\n  if (chatForm instanceof HTMLFormElement && chatInput instanceof HTMLTextAreaElement) {\n    const submitChatInput = () => {\n      const value = chatInput.value.trim();\n      if (!value) {\n        return;\n      }\n\n      if (!hasAiKey) {\n        awaitingChatKey = true;\n        showChatStatus(getMissingKeyMessage());\n        vscode.postMessage({ type: 'chat:ensureKey' });\n        return;\n      }\n\n      vscode.postMessage({ type: 'chat:send', payload: { text: value } });\n      chatInput.value = '';\n      showChatStatus('Waiting for response…');\n    };\n\n    chatForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n      submitChatInput();\n    });\n\n    chatInput.addEventListener('keydown', (event) => {\n      if (event.key === 'Enter' && !event.shiftKey) {\n        event.preventDefault();\n        submitChatInput();\n      }\n    });\n  }\n\n  if (chatModelSelect instanceof HTMLSelectElement) {\n    chatModelSelect.addEventListener('change', (event) => {\n      const value = event.target.value;\n      if (!value) {\n        return;\n      }\n      vscode.postMessage({ type: 'chat:setModel', payload: { modelId: value } });\n    });\n  }\n\n  if (\n    selectionLineForm instanceof HTMLFormElement &&\n    selectionStartInput instanceof HTMLInputElement &&\n    selectionEndInput instanceof HTMLInputElement\n  ) {\n    selectionLineForm.addEventListener('submit', (event) => {\n      event.preventDefault();\n      const startValue = parseLineInput(selectionStartInput.value);\n      const endValue = parseLineInput(selectionEndInput.value);\n      if (typeof startValue !== 'number' || typeof endValue !== 'number') {\n        return;\n      }\n      const normalized = normalizeLineRange(startValue, endValue);\n      selectionActive = true;\n      selectionLineRange = normalized;\n      updateSelectionInputs();\n      vscode.postMessage({ type: 'selection:applyLines', payload: { startLine: normalized.start, endLine: normalized.end } });\n    });\n  }\n\n  if (selectionClearButton instanceof HTMLButtonElement) {\n    selectionClearButton.addEventListener('click', () => {\n      if (selectionStartInput instanceof HTMLInputElement) {\n        selectionStartInput.value = '';\n      }\n      if (selectionEndInput instanceof HTMLInputElement) {\n        selectionEndInput.value = '';\n      }\n    selectionLineRange = {};\n    selectionActive = false;\n    updateSelectionInputs();\n    vscode.postMessage({ type: 'selection:clear' });\n  });\n}\n\n  if (controlDockToggle instanceof HTMLButtonElement) {\n    controlDockToggle.addEventListener('click', () => {\n      setControlsCollapsed(!controlsCollapsed);\n    });\n  }\n\n  setControlsCollapsed(controlsCollapsed, { persist: false });\n\n  container.addEventListener('click', handleContainerClick);\n  container.addEventListener('keydown', handleKeydown);\n\n  window.addEventListener('message', (event) => {\n    const { type, payload } = event.data || {};\n    if (type === 'render') {\n      renderVisualizer(payload);\n      return;\n    }\n\n    if (type === 'invalid') {\n      renderInvalidState(payload);\n      return;\n    }\n\n    if (type === 'chat:history') {\n      renderChatHistory(payload);\n      return;\n    }\n\n    if (type === 'chat:userMessage') {\n      ensureChatPanel();\n      setChatMessage(payload?.id, 'user', payload?.text ?? '');\n      return;\n    }\n\n    if (type === 'chat:assistantStart') {\n      ensureChatPanel();\n      setChatMessage(payload?.id, 'assistant', '', { pending: true });\n      showChatStatus('AI is thinking...');\n      return;\n    }\n\n    if (type === 'chat:assistantDelta') {\n      appendChatDelta(payload?.id, payload?.text ?? '');\n      return;\n    }\n\n    if (type === 'chat:assistantComplete') {\n      finalizeAssistantMessage(payload?.id, payload?.text ?? '', payload?.snippet);\n      return;\n    }\n\n    if (type === 'chat:error') {\n      showChatStatus(payload ?? 'AI error');\n      return;\n    }\n\n    if (type === 'chat:status') {\n      showChatStatus(payload?.state === 'thinking' ? 'AI is thinking...' : '');\n      return;\n    }\n\n    if (type === 'chat:needsApiKey') {\n      showChatStatus(`${getMissingKeyMessage()} Use the command palette to configure it.`);\n    }\n\n    if (type === 'chat:ensureKeyResult') {\n      hasAiKey = Boolean(payload?.ready);\n      if (hasAiKey) {\n        awaitingChatKey = false;\n        showChatStatus('');\n      } else if (awaitingChatKey) {\n        showChatStatus(`${getMissingKeyMessage()} Run “JSON Atlas: Set AI API Key”.`);\n      }\n      return;\n    }\n\n    if (type === 'chat:aiStatus') {\n      if (typeof payload?.provider === 'string') {\n        activeModelProvider = payload.provider;\n      }\n      hasAiKey = Boolean(payload?.hasKey);\n      if (chatPanelVisible && !hasAiKey) {\n        showChatStatus(getMissingKeyMessage());\n      } else if (chatPanelVisible) {\n        showChatStatus('');\n      }\n      return;\n    }\n\n    if (type === 'chat:modelOptions') {\n      updateModelSelect(payload);\n      return;\n    }\n\n    if (type === 'selection:update') {\n      applySelectionInfo(payload);\n      return;\n    }\n\n    if (type === 'visualizer:focusPath') {\n      const path = typeof payload === 'string' ? payload : undefined;\n      if (!path) {\n        return;\n      }\n      pendingSearchFocusId = path;\n      if (viewMode !== 'graph') {\n        setViewMode('graph');\n        return;\n      }\n      requestAnimationFrame(() => {\n        if (nodeElements.has(path)) {\n          focusGraphNode(path);\n          pendingSearchFocusId = undefined;\n        }\n      });\n      return;\n    }\n\n    if (type === 'schema:pointers') {\n      applySchemaPointers(payload);\n      rerenderFromState();\n      return;\n    }\n  });\n\n  vscode.postMessage({ type: 'ready' });\n\n  function applySchemaPointers(raw: Record<string, SchemaPointerInfo | undefined> | undefined) {\n    schemaPointerIndex = new Map<string, SchemaPointerInfo>();\n    if (!raw || typeof raw !== 'object') {\n      return;\n    }\n    Object.entries(raw).forEach(([path, info]) => {\n      if (!info || typeof info.pointer !== 'string') {\n        return;\n      }\n      schemaPointerIndex.set(path, {\n        pointer: info.pointer,\n        title: typeof info.title === 'string' ? info.title : undefined,\n        description: typeof info.description === 'string' ? info.description : undefined\n      });\n    });\n  }\n\n  function persistState(options = { savePositions: true }) {\n    if (options.savePositions !== false && currentDocumentId) {\n      nodePositionStore[currentDocumentId] = serializePositions(nodePositions);\n    }\n\n    const docKey = currentDocumentId ?? 'default';\n    if (docKey) {\n      layoutPresetStore[docKey] = currentLayoutPreset;\n    }\n\n    persistedState = {\n      ...persistedState,\n      viewMode,\n      nodePositions: nodePositionStore,\n      controlsCollapsed,\n      layoutPresets: layoutPresetStore\n    };\n    if (typeof vscode.setState === 'function') {\n      vscode.setState(persistedState);\n    }\n  }\n\n  function applyLayoutPreset(\n    preset: LayoutPreset,\n    options: { persist?: boolean; rerender?: boolean } = {}\n  ) {\n    const normalized = normalizeLayoutPreset(preset);\n    const changed = normalized !== currentLayoutPreset;\n    currentLayoutPreset = normalized;\n\n    if (layoutPresetSelect instanceof HTMLSelectElement) {\n      layoutPresetSelect.value = normalized;\n    }\n\n    const shouldPersist = options.persist !== false;\n    if (shouldPersist) {\n      const docKey = currentDocumentId ?? 'default';\n      if (docKey) {\n        layoutPresetStore[docKey] = normalized;\n      }\n      persistState({ savePositions: false });\n    }\n\n    if (changed && options.rerender !== false) {\n      needsInitialGraphFocus = true;\n      pendingSearchFocusId = ROOT_PATH;\n      hasUserMovedView = false;\n      rerenderFromState(true);\n    }\n  }\n\n  function normalizeLayoutPreset(value: unknown): LayoutPreset {\n    if (value === 'compact' || value === 'relaxed') {\n      return value;\n    }\n    return 'balanced';\n  }\n\n  function getCurrentLayoutSpacing() {\n    return LAYOUT_PRESETS[currentLayoutPreset] ?? LAYOUT_PRESETS.balanced;\n  }\n\n  function syncLayoutPresetWithDocument() {\n    const docKey = currentDocumentId ?? 'default';\n    const stored = typeof docKey === 'string' ? layoutPresetStore[docKey] : undefined;\n    const desired = normalizeLayoutPreset(stored ?? configDefaultLayoutPreset);\n    applyLayoutPreset(desired, { persist: false, rerender: false });\n  }\n\n  function switchDocument(documentId) {\n    if (currentDocumentId === documentId) {\n      return;\n    }\n\n    if (currentDocumentId) {\n      persistState();\n      collapsedPathStore.set(currentDocumentId, new Set(collapsedPaths));\n      depthExpandedPathStore.set(currentDocumentId, new Set(depthExpandedPaths));\n    }\n\n    currentDocumentId = documentId;\n    const stored = nodePositionStore[documentId];\n    nodePositions = new Map(stored ? Object.entries(stored) : []);\n    const collapsed = collapsedPathStore.get(documentId);\n    collapsedPaths = new Set(collapsed instanceof Set ? collapsed : []);\n    const expanded = depthExpandedPathStore.get(documentId);\n    depthExpandedPaths = new Set(expanded instanceof Set ? expanded : []);\n    needsInitialGraphFocus = true;\n  }\n\n  function pruneNodePositions(validIds) {\n    let changed = false;\n    for (const id of Array.from(nodePositions.keys())) {\n      if (!validIds.has(id)) {\n        nodePositions.delete(id);\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      persistState();\n    }\n  }\n\n  function handleContainerClick(event) {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) {\n      return;\n    }\n\n    const schemaTarget = target.closest('[data-action=\"open-schema\"]');\n    if (schemaTarget instanceof HTMLElement) {\n      const path = schemaTarget.getAttribute('data-path');\n      if (!path) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      vscode.postMessage({ type: 'schema:open', payload: { path } });\n      return;\n    }\n\n    const editValueTarget = target.closest('[data-action=\"edit-value\"]');\n    if (editValueTarget instanceof HTMLElement) {\n      const path = editValueTarget.getAttribute('data-path');\n      const literal = editValueTarget.getAttribute('data-literal');\n      const kind = editValueTarget.getAttribute('data-kind') ?? 'string';\n      const href = editValueTarget.getAttribute('data-href');\n      if (!path || !literal) {\n        return;\n      }\n\n      if (href && (event.metaKey || event.ctrlKey)) {\n        event.preventDefault();\n        vscode.postMessage({ type: 'openLink', payload: href });\n        return;\n      }\n\n      event.preventDefault();\n      event.stopPropagation();\n      requestEditValue(path, literal, kind);\n      return;\n    }\n\n    const link = target.closest('[data-open-link=\"true\"]');\n    const href = link instanceof HTMLAnchorElement ? link.href : link?.getAttribute('data-href');\n    if (href) {\n      event.preventDefault();\n      vscode.postMessage({ type: 'openLink', payload: href });\n      return;\n    }\n\n    const renameTarget = target.closest('[data-action=\"rename\"]');\n    if (renameTarget instanceof HTMLElement) {\n      const path = renameTarget.getAttribute('data-path');\n      const currentName = renameTarget.getAttribute('data-key') ?? '';\n      if (!path) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      requestRename(path, currentName);\n      return;\n    }\n\n\n    const toggle = target.closest('button[data-action=\"toggle\"]');\n    if (toggle) {\n      const path = toggle.getAttribute('data-path');\n      if (!path) {\n        return;\n      }\n\n      event.preventDefault();\n      togglePath(path);\n    }\n  }\n\n  function handleKeydown(event) {\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) {\n      return;\n    }\n\n    if (\n      (event.key === 'Enter' || event.key === ' ') &&\n      target.hasAttribute('data-action') &&\n      target.getAttribute('data-action') === 'rename'\n    ) {\n      const path = target.getAttribute('data-path');\n      const currentName = target.getAttribute('data-key') ?? '';\n      if (!path) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      requestRename(path, currentName);\n      return;\n    }\n\n    if (\n      (event.key === 'Enter' || event.key === ' ') &&\n      target.hasAttribute('data-action') &&\n      target.getAttribute('data-action') === 'edit-value'\n    ) {\n      const path = target.getAttribute('data-path');\n      const literal = target.getAttribute('data-literal');\n      const kind = target.getAttribute('data-kind') ?? 'string';\n      if (!path || !literal) {\n        return;\n      }\n      event.preventDefault();\n      event.stopPropagation();\n      requestEditValue(path, literal, kind);\n    }\n  }\n\n  function togglePath(path) {\n    if (!path) {\n      return;\n    }\n\n    if (isAutoCollapsedPath(path)) {\n      depthExpandedPaths.add(path);\n      rerenderFromState(false);\n      focusPath(path);\n      return;\n    }\n\n    if (collapsedPaths.has(path)) {\n      collapsedPaths.delete(path);\n      depthExpandedPaths.add(path);\n    } else {\n      collapsedPaths.add(path);\n      depthExpandedPaths.delete(path);\n    }\n\n    rerenderFromState(false);\n    focusPath(path);\n  }\n\n  function rememberPathDepth(pathKey, depth) {\n    pathDepths.set(pathKey, depth);\n  }\n\n  function getActiveDepthLimit() {\n    if (typeof graphMaxDepth === 'number' && Number.isFinite(graphMaxDepth) && graphMaxDepth > 0) {\n      return graphMaxDepth;\n    }\n    return undefined;\n  }\n\n  function shouldCollapseByDepth(pathKey, depth) {\n    const limit = getActiveDepthLimit();\n    if (typeof limit !== 'number') {\n      return false;\n    }\n    return depth >= limit && !depthExpandedPaths.has(pathKey);\n  }\n\n  function isAutoCollapsedPath(pathKey) {\n    const depth = pathDepths.get(pathKey);\n    if (typeof depth !== 'number') {\n      return false;\n    }\n    return shouldCollapseByDepth(pathKey, depth);\n  }\n\n  function requestRename(pathKey, currentName) {\n    vscode.postMessage({\n      type: 'requestRename',\n      payload: { path: pathKey, currentName }\n    });\n  }\n\n  function requestEditValue(pathKey, literal, kind) {\n    vscode.postMessage({\n      type: 'requestEditValue',\n      payload: { path: pathKey, literal, kind }\n    });\n  }\n\n  function initViewport() {\n    viewport = document.createElement('div');\n    viewport.className = 'visualizer-viewport';\n\n    canvas = document.createElement('div');\n    canvas.className = 'visualizer-canvas';\n\n    linksLayer = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    linksLayer.classList.add('visualizer-links');\n    linksLayer.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n\n    nodesLayer = document.createElement('div');\n    nodesLayer.className = 'visualizer-nodes';\n\n    canvas.appendChild(linksLayer);\n    canvas.appendChild(nodesLayer);\n    viewport.appendChild(canvas);\n    graphRoot.appendChild(viewport);\n\n    setupPanAndZoom();\n  }\n\n  function setupPanAndZoom() {\n    viewport.addEventListener('pointerdown', (event) => {\n      if (event.button !== 0) {\n        return;\n      }\n\n      if (event.target instanceof HTMLElement && event.target.closest('.visualizer-node')) {\n        return;\n      }\n\n      isPanning = true;\n      hasUserMovedView = true;\n      panPointerId = event.pointerId;\n      panStart = { x: event.clientX, y: event.clientY };\n      panOrigin = { x: panState.x, y: panState.y };\n      viewport.setPointerCapture(panPointerId);\n      viewport.classList.add('is-panning');\n    });\n\n    viewport.addEventListener('pointermove', (event) => {\n      if (!isPanning || event.pointerId !== panPointerId) {\n        return;\n      }\n\n      const deltaX = event.clientX - panStart.x;\n      const deltaY = event.clientY - panStart.y;\n      panState.x = panOrigin.x + deltaX;\n      panState.y = panOrigin.y + deltaY;\n      applyPan();\n    });\n\n    const endPan = (event) => {\n      if (!isPanning || (event.pointerId !== undefined && event.pointerId !== panPointerId)) {\n        return;\n      }\n\n      isPanning = false;\n      const pointerToRelease = panPointerId;\n      panPointerId = null;\n      viewport.classList.remove('is-panning');\n      if (typeof pointerToRelease === 'number') {\n        try {\n          viewport.releasePointerCapture(pointerToRelease);\n        } catch {\n          // pointer may already be released; ignore\n        }\n      }\n    };\n\n    viewport.addEventListener('pointerup', endPan);\n    viewport.addEventListener('pointercancel', endPan);\n\n    viewport.addEventListener(\n      'wheel',\n      (event) => {\n        event.preventDefault();\n        const direction = event.deltaY < 0 ? 1 : -1;\n        const factor = direction > 0 ? 1.1 : 0.9;\n        const nextScale = clamp(panState.scale * factor, minScaleLimit, MAX_SCALE);\n        if (nextScale === panState.scale) {\n          return;\n        }\n\n        hasUserMovedView = true;\n        const rect = viewport.getBoundingClientRect();\n        const offsetX = event.clientX - rect.left;\n        const offsetY = event.clientY - rect.top;\n        const scaleRatio = nextScale / panState.scale;\n        panState.x = offsetX - (offsetX - panState.x) * scaleRatio;\n        panState.y = offsetY - (offsetY - panState.y) * scaleRatio;\n        panState.scale = nextScale;\n        applyPan();\n      },\n      { passive: false }\n    );\n\n    viewport.addEventListener('dblclick', () => {\n      resetPan(true);\n    });\n  }\n\n  function applyPan() {\n    if (!canvas) {\n      return;\n    }\n    canvas.style.transform = `translate(${panState.x}px, ${panState.y}px) scale(${panState.scale})`;\n  }\n\n  function resetPan(force, scaleOverride) {\n    if (!canvas || (!force && hasUserMovedView)) {\n      return;\n    }\n\n    const host = graphRoot;\n    const viewportWidth = host.clientWidth || 1;\n    const viewportHeight = host.clientHeight || 1;\n    const canvasRect = canvas.getBoundingClientRect();\n    const canvasWidth = Number.parseFloat(canvas.style.width) || canvasRect.width || viewportWidth;\n    const canvasHeight = Number.parseFloat(canvas.style.height) || canvasRect.height || viewportHeight;\n\n    const targetScale = typeof scaleOverride === 'number' ? scaleOverride : graphInitialScale;\n    const normalizedScale = typeof targetScale === 'number' ? targetScale : 1;\n    panState.scale = clamp(normalizedScale, minScaleLimit, MAX_SCALE);\n    panState.x = (viewportWidth - canvasWidth) / 2;\n    panState.y = Math.min(32, (viewportHeight - canvasHeight) / 2);\n    applyPan();\n  }\n\n  function updateMinScaleLimit(initialScale) {\n    if (graphAutoScale && typeof initialScale === 'number' && initialScale < MANUAL_MIN_SCALE) {\n      minScaleLimit = clamp(initialScale, AUTO_MIN_SCALE, MANUAL_MIN_SCALE);\n      return;\n    }\n    minScaleLimit = MANUAL_MIN_SCALE;\n  }\n\n  function rerenderFromState(force) {\n    if (typeof currentPayload === 'undefined') {\n      return;\n    }\n\n    if (force && viewMode === 'graph') {\n      resetPan(true, graphInitialScale);\n      hasUserMovedView = false;\n    }\n\n    renderData(currentPayload);\n  }\n\n  function setViewMode(mode) {\n    const normalized = mode === 'tree' ? 'tree' : 'graph';\n    if (normalized === viewMode) {\n      return;\n    }\n\n    viewMode = normalized;\n    hasPersistedViewPreference = true;\n    if (viewSelect instanceof HTMLSelectElement) {\n      viewSelect.value = normalized;\n    }\n\n    persistState();\n    if (currentPayload) {\n      renderData(currentPayload);\n    }\n  }\n\n  function renderVisualizer(payload) {\n    const data = payload && typeof payload === 'object' && 'data' in payload ? payload.data : payload;\n    const documentId =\n      payload && typeof payload === 'object' && typeof payload.documentId === 'string'\n        ? payload.documentId\n        : undefined;\n    const defaultViewMode =\n      payload && typeof payload === 'object' && typeof payload.defaultViewMode === 'string'\n        ? payload.defaultViewMode\n        : undefined;\n\n    const initialSelectionInfo =\n      payload && typeof payload === 'object' && 'selectionInfo' in payload ? payload.selectionInfo : undefined;\n    applySelectionInfo(initialSelectionInfo);\n\n    if (payload && typeof payload === 'object' && 'schemaPointers' in payload) {\n      applySchemaPointers(payload.schemaPointers);\n    }\n\n    if (payload && typeof payload === 'object') {\n      if (payload.focusRoot) {\n        if (viewMode !== 'graph') {\n          setViewMode('graph');\n        }\n        pendingSearchFocusId = ROOT_PATH;\n      }\n      if (payload.resetLayout && currentDocumentId) {\n        nodePositions = new Map();\n        nodePositionStore[currentDocumentId] = {};\n      }\n      if (payload.resetView || payload.focusRoot) {\n        needsInitialGraphFocus = true;\n        hasUserMovedView = false;\n        pendingSearchFocusId = undefined;\n        currentSearchMatch = undefined;\n      }\n      if (typeof payload.graphAutoScale === 'boolean') {\n        graphAutoScale = payload.graphAutoScale;\n      }\n      if (typeof payload.graphInitialScale === 'number') {\n        manualGraphScale = clampScale(payload.graphInitialScale);\n      }\n      if (typeof payload.graphMaxDepth === 'number') {\n        graphMaxDepth = Number.isFinite(payload.graphMaxDepth) && payload.graphMaxDepth > 0 ? Math.floor(payload.graphMaxDepth) : undefined;\n      } else if (payload.graphMaxDepth === null) {\n        graphMaxDepth = undefined;\n      }\n      if (typeof payload.graphLayoutPreset === 'string') {\n        configDefaultLayoutPreset = normalizeLayoutPreset(payload.graphLayoutPreset);\n      }\n    }\n\n    if (documentId) {\n      switchDocument(documentId);\n    } else if (!currentDocumentId) {\n      currentDocumentId = 'default';\n      nodePositions = new Map();\n      needsInitialGraphFocus = true;\n    }\n    syncLayoutPresetWithDocument();\n\n    if (defaultViewMode) {\n      const normalized = defaultViewMode === 'tree' ? 'tree' : 'graph';\n      preferredDefaultViewMode = normalized;\n      if (!hasPersistedViewPreference && viewMode !== normalized) {\n        viewMode = normalized;\n        if (viewSelect instanceof HTMLSelectElement) {\n          viewSelect.value = normalized;\n        }\n      }\n    }\n\n    if (typeof data === 'undefined') {\n      return;\n    }\n\n    currentPayload = data;\n    renderData(data);\n  }\n\n  function renderData(data) {\n    hideStatus();\n    pathDepths.clear();\n    const graphData = buildGraph(data);\n    updateSearchIndex(graphData.nodes);\n\n    if (viewMode === 'tree') {\n      renderTreeView(data);\n    } else {\n      renderGraph(graphData);\n    }\n  }\n\n  function renderGraph(graph) {\n    graphRoot.removeAttribute('hidden');\n    treeRoot.setAttribute('hidden', 'true');\n\n    if (!viewport) {\n      initViewport();\n    }\n\n    nodesLayer.innerHTML = '';\n    linksLayer.innerHTML = '';\n    nodeElements.clear();\n\n    canvas.style.width = `${graph.size.width}px`;\n    canvas.style.height = `${graph.size.height}px`;\n    linksLayer.setAttribute('width', String(graph.size.width));\n    linksLayer.setAttribute('height', String(graph.size.height));\n    linksLayer.setAttribute('viewBox', `0 0 ${graph.size.width} ${graph.size.height}`);\n\n    graph.nodes.forEach((node) => {\n      const element = createGraphNodeElement(node);\n      nodesLayer.appendChild(element);\n      nodeElements.set(node.id, { node, element });\n    });\n\n    currentEdges = graph.edges;\n    pruneNodePositions(new Set(graph.nodes.map((node) => node.id)));\n    drawEdges(currentEdges);\n\n    const targetScale = graphAutoScale ? computeAutoScale(graph.size, graph.nodes.length) : clampScale(manualGraphScale);\n    graphInitialScale = targetScale;\n    updateMinScaleLimit(graphInitialScale);\n\n    if (hasUserMovedView) {\n      resetPan(false);\n    } else {\n      resetPan(true, graphInitialScale);\n      hasUserMovedView = false;\n    }\n\n    applyPan();\n    applySearchHighlight();\n    if (pendingSearchFocusId) {\n      focusGraphNode(pendingSearchFocusId);\n      pendingSearchFocusId = undefined;\n      needsInitialGraphFocus = false;\n    } else if (currentSearchMatch) {\n      highlightGraphNode(currentSearchMatch);\n      needsInitialGraphFocus = false;\n    } else if (needsInitialGraphFocus) {\n      focusGraphNode(ROOT_PATH);\n      needsInitialGraphFocus = false;\n    }\n  }\n\n  function renderTreeView(payload) {\n    treeRoot.removeAttribute('hidden');\n    graphRoot.setAttribute('hidden', 'true');\n\n    treeRoot.innerHTML = '';\n    const tree = document.createElement('ul');\n    tree.className = 'visualizer-tree';\n    tree.setAttribute('role', 'tree');\n    tree.appendChild(buildTreeBranch('JSON', payload, [], 0));\n    treeRoot.appendChild(tree);\n  }\n\n  function buildTreeBranch(key, value, path, depth) {\n    const pathKey = serializePath(path);\n    const schemaInfo = schemaPointerIndex.get(pathKey);\n    const entries = getChildEntries(value);\n    const hasChildren = entries.length > 0;\n    rememberPathDepth(pathKey, depth);\n    const depthLimited = shouldCollapseByDepth(pathKey, depth);\n    const isCollapsed = hasChildren && (collapsedPaths.has(pathKey) || depthLimited);\n\n    const listItem = document.createElement('li');\n    listItem.className = 'tree-branch';\n    listItem.dataset.depth = String(depth);\n    if (hasChildren) {\n      listItem.setAttribute('aria-expanded', String(!isCollapsed));\n    }\n    if (isCollapsed) {\n      listItem.classList.add('is-collapsed');\n    }\n\n    const control = document.createElement(hasChildren ? 'button' : 'div');\n    control.className = `tree-node ${hasChildren ? 'tree-node--branch' : 'tree-node--leaf'}`;\n    control.dataset.path = pathKey;\n    control.dataset.depth = String(depth);\n\n    if (hasChildren) {\n      control.type = 'button';\n      control.dataset.action = 'toggle';\n      control.setAttribute('aria-expanded', String(!isCollapsed));\n    }\n\n    const chevron = document.createElement('span');\n    chevron.className = 'tree-node__chevron';\n    chevron.setAttribute('aria-hidden', 'true');\n    control.appendChild(chevron);\n\n    const keySpan = document.createElement('span');\n    const canRename = typeof path[path.length - 1] === 'string';\n    keySpan.className = `tree-node__key${canRename ? ' tree-node__key--action' : ''}`;\n    keySpan.textContent = String(key);\n    if (canRename) {\n      keySpan.dataset.action = 'rename';\n      keySpan.dataset.path = pathKey;\n      keySpan.dataset.key = String(key);\n      keySpan.setAttribute('role', 'button');\n      keySpan.setAttribute('tabindex', '0');\n      keySpan.title = 'Rename key';\n    }\n    control.appendChild(keySpan);\n\n    const connector = document.createElement('span');\n    connector.className = 'tree-node__connector';\n    connector.setAttribute('aria-hidden', 'true');\n    control.appendChild(connector);\n\n    const descriptor = describeValue(value);\n    const valueElement = createValueElement(descriptor, 'tree-node__value', {\n      path: pathKey,\n      editable: canEditValueDescriptor(descriptor),\n      schemaPointer: schemaInfo\n    });\n    control.appendChild(valueElement);\n\n    listItem.appendChild(control);\n\n    if (hasChildren && !isCollapsed) {\n      const childList = document.createElement('ul');\n      childList.className = 'visualizer-tree-children';\n      childList.setAttribute('role', 'group');\n      entries.forEach(([childKey, childValue]) => {\n        const childPath = path.concat([childKey]);\n        const childLabel = formatChildKey(key, childKey, value);\n        childList.appendChild(buildTreeBranch(childLabel, childValue, childPath, depth + 1));\n      });\n      listItem.appendChild(childList);\n    }\n\n    return listItem;\n  }\n\n  function renderInvalidState(message) {\n    selectionActive = false;\n    selectionLabel = '';\n    updateSelectionIndicator();\n    graphRoot.setAttribute('hidden', 'true');\n    treeRoot.setAttribute('hidden', 'true');\n    status.textContent = message || 'The document contains syntax errors.';\n    status.removeAttribute('hidden');\n  }\n\n  function hideStatus() {\n    status.setAttribute('hidden', 'true');\n  }\n\n  function buildGraph(payload) {\n    const nodes = [];\n    const edges = [];\n    let maxDepth = 0;\n    let nextRow = 0;\n    const layoutSpacing = getCurrentLayoutSpacing();\n    const gapX = layoutSpacing.gapX;\n    const gapY = layoutSpacing.gapY;\n\n    const traverse = (key, value, path, depth, parentId) => {\n      const pathKey = serializePath(path);\n      const schemaInfo = schemaPointerIndex.get(pathKey);\n      rememberPathDepth(pathKey, depth);\n      const children = getChildEntries(value);\n      const hasChildren = children.length > 0;\n      const depthLimited = shouldCollapseByDepth(pathKey, depth);\n      const isCollapsed = hasChildren && (collapsedPaths.has(pathKey) || depthLimited);\n\n      const lastSegment = path[path.length - 1];\n      const node = {\n        id: pathKey,\n        key: String(key),\n        descriptor: describeValue(value),\n        depth,\n        x: depth * gapX,\n        y: 0,\n        hasChildren,\n        isCollapsed,\n        canRename: typeof lastSegment === 'string',\n        schemaPointer: schemaInfo\n      };\n\n      nodes.push(node);\n      maxDepth = Math.max(maxDepth, depth);\n\n      if (parentId) {\n        edges.push({ from: parentId, to: pathKey });\n      }\n\n      if (!hasChildren || isCollapsed) {\n        node.y = nextRow * gapY;\n        nextRow += 1;\n        return node.y;\n      }\n\n      const childPositions = children.map(([childKey, childValue]) =>\n        traverse(formatChildKey(key, childKey, value), childValue, path.concat([childKey]), depth + 1, pathKey)\n      );\n\n      if (childPositions.length) {\n        const top = childPositions[0];\n        const bottom = childPositions[childPositions.length - 1];\n        node.y = top + (bottom - top) / 2;\n      } else {\n        node.y = nextRow * gapY;\n        nextRow += 1;\n      }\n\n      return node.y;\n    };\n\n    traverse('JSON', payload, [], 0, null);\n\n    const width = (maxDepth + 1) * gapX + CANVAS_PADDING * 2;\n    const height = Math.max(nextRow * gapY, gapY) + CANVAS_PADDING * 2;\n\n    nodes.forEach((node) => {\n      node.x += CANVAS_PADDING;\n      node.y += CANVAS_PADDING;\n      const custom = nodePositions.get(node.id);\n      if (custom) {\n        node.x = custom.x;\n        node.y = custom.y;\n      }\n    });\n\n    return {\n      nodes,\n      edges,\n      size: { width, height }\n    };\n  }\n\n  function createGraphNodeElement(node) {\n    const element = document.createElement(node.hasChildren ? 'button' : 'div');\n    element.className = `visualizer-node ${node.hasChildren ? 'visualizer-node--branch' : 'visualizer-node--leaf'}`;\n    element.style.left = `${node.x}px`;\n    element.style.top = `${node.y}px`;\n    element.dataset.path = node.id;\n\n    if (node.hasChildren) {\n      element.type = 'button';\n      element.dataset.action = 'toggle';\n      element.setAttribute('aria-expanded', String(!node.isCollapsed));\n      if (node.isCollapsed) {\n        element.classList.add('is-collapsed');\n      }\n    }\n\n    const chevron = document.createElement('span');\n    chevron.className = 'visualizer-node__chevron';\n    chevron.setAttribute('aria-hidden', 'true');\n    element.appendChild(chevron);\n\n    const key = document.createElement('span');\n    key.className = `visualizer-node__key${node.canRename ? ' visualizer-node__key--action' : ''}`;\n    key.textContent = node.key;\n    if (node.canRename) {\n      key.dataset.action = 'rename';\n      key.dataset.path = node.id;\n      key.dataset.key = node.key;\n      key.setAttribute('role', 'button');\n      key.setAttribute('tabindex', '0');\n      key.title = 'Rename key';\n    }\n    element.appendChild(key);\n\n    const connector = document.createElement('span');\n    connector.className = 'visualizer-node__connector';\n    connector.setAttribute('aria-hidden', 'true');\n    element.appendChild(connector);\n\n      const valueElement = createValueElement(node.descriptor, 'visualizer-node__value', {\n        path: node.id,\n        editable: !node.hasChildren && canEditValueDescriptor(node.descriptor),\n        schemaPointer: node.schemaPointer\n      });\n    element.appendChild(valueElement);\n\n    enableNodeDragging(element, node);\n\n    return element;\n  }\n\n  function enableNodeDragging(element, node) {\n    element.addEventListener('pointerdown', (event) => {\n      if (!shouldStartNodeDrag(event)) {\n        return;\n      }\n\n      activeNodeDrag = {\n        id: node.id,\n        pointerId: event.pointerId,\n        startX: event.clientX,\n        startY: event.clientY,\n        originX: node.x,\n        originY: node.y,\n        moved: false\n      };\n\n      element.setPointerCapture(event.pointerId);\n      event.preventDefault();\n    });\n\n    element.addEventListener('pointermove', (event) => {\n      if (!activeNodeDrag || activeNodeDrag.id !== node.id || event.pointerId !== activeNodeDrag.pointerId) {\n        return;\n      }\n\n      const deltaX = (event.clientX - activeNodeDrag.startX) / panState.scale;\n      const deltaY = (event.clientY - activeNodeDrag.startY) / panState.scale;\n      const newX = activeNodeDrag.originX + deltaX;\n      const newY = activeNodeDrag.originY + deltaY;\n      updateNodePosition(node.id, newX, newY);\n      activeNodeDrag.moved = true;\n      event.preventDefault();\n    });\n\n    const endDrag = (event) => finishNodeDrag(event, node, element);\n    element.addEventListener('pointerup', endDrag);\n    element.addEventListener('pointercancel', endDrag);\n\n    element.addEventListener('click', (event) => {\n      if (element.dataset.dragging === 'true') {\n        event.preventDefault();\n        event.stopPropagation();\n        element.dataset.dragging = '';\n      }\n    });\n  }\n\n  function drawEdges(edges) {\n    linksLayer.innerHTML = '';\n\n    edges.forEach((edge) => {\n      const parent = nodeElements.get(edge.from);\n      const child = nodeElements.get(edge.to);\n\n      if (!parent || !child) {\n        return;\n      }\n\n      const parentWidth = parent.element.offsetWidth;\n      const parentHeight = parent.element.offsetHeight;\n      const childHeight = child.element.offsetHeight;\n\n      const startX = parent.node.x + parentWidth;\n      const startY = parent.node.y + parentHeight / 2;\n      const endX = child.node.x;\n      const endY = child.node.y + childHeight / 2;\n      const controlOffset = Math.max(32, (endX - startX) / 2);\n\n      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n      path.setAttribute(\n        'd',\n        `M ${startX} ${startY} C ${startX + controlOffset} ${startY}, ${endX - controlOffset} ${endY}, ${endX} ${endY}`\n      );\n      path.setAttribute('class', 'visualizer-link');\n      linksLayer.appendChild(path);\n    });\n  }\n\n  function updateNodePosition(nodeId, x, y) {\n    const entry = nodeElements.get(nodeId);\n    if (!entry) {\n      return;\n    }\n\n    entry.node.x = x;\n    entry.node.y = y;\n    entry.element.style.left = `${x}px`;\n    entry.element.style.top = `${y}px`;\n    drawEdges(currentEdges);\n  }\n\n  function finishNodeDrag(event, node, element) {\n    if (\n      !activeNodeDrag ||\n      activeNodeDrag.id !== node.id ||\n      (event.pointerId !== undefined && event.pointerId !== activeNodeDrag.pointerId)\n    ) {\n      return;\n    }\n\n    try {\n      element.releasePointerCapture(activeNodeDrag.pointerId);\n    } catch {\n      // no-op\n    }\n\n    const moved = activeNodeDrag.moved;\n    activeNodeDrag = undefined;\n\n    if (moved) {\n      element.dataset.dragging = 'true';\n      nodePositions.set(node.id, { x: node.x, y: node.y });\n      persistState();\n      event.preventDefault();\n      event.stopPropagation();\n    }\n  }\n\n  function getChildEntries(value) {\n    if (Array.isArray(value)) {\n      return value.map((child, index) => [index, child]);\n    }\n\n    if (isObject(value)) {\n      return Object.entries(value);\n    }\n\n    return [];\n  }\n\n  function describeValue(value) {\n    if (value === null) {\n      return { label: 'null', kind: 'null', icon: ICON_TYPES.null, rawValue: null };\n    }\n\n    if (Array.isArray(value)) {\n      return { label: `[${value.length}]`, kind: 'array', icon: ICON_TYPES.array, rawValue: '[array]' };\n    }\n\n    switch (typeof value) {\n      case 'object':\n        return {\n          label: `{${Object.keys(value || {}).length}}`,\n          kind: 'object',\n          icon: ICON_TYPES.object,\n          rawValue: '[object]'\n        };\n      case 'string': {\n        const trimmed = value.trim();\n        if (isUrl(trimmed)) {\n          return {\n            label: truncate(trimmed, 42),\n            kind: 'link',\n            href: trimmed,\n            title: trimmed,\n            icon: ICON_TYPES.link,\n            rawValue: trimmed\n          };\n        }\n        return {\n          label: `\"${truncate(value)}\"`,\n          kind: 'string',\n          title: value,\n          icon: ICON_TYPES.string,\n          rawValue: value\n        };\n      }\n      case 'number':\n        return { label: String(value), kind: 'number', icon: ICON_TYPES.number, rawValue: value };\n      case 'boolean':\n        return { label: String(value), kind: 'boolean', icon: ICON_TYPES.boolean, rawValue: value };\n      default:\n        return { label: '', kind: 'unknown', icon: ICON_TYPES.unknown, rawValue: '' };\n    }\n  }\n\n  function canEditValueDescriptor(descriptor) {\n    if (!descriptor) {\n      return false;\n    }\n    return EDITABLE_VALUE_KINDS.has(descriptor.kind);\n  }\n\n  function serializeValueLiteral(rawValue) {\n    if (typeof rawValue === 'undefined') {\n      return 'null';\n    }\n\n    try {\n      return JSON.stringify(rawValue);\n    } catch {\n      return 'null';\n    }\n  }\n\n  function shouldStartNodeDrag(event) {\n    if (event.button !== 0) {\n      return false;\n    }\n\n    const target = event.target;\n    if (!(target instanceof HTMLElement)) {\n      return true;\n    }\n\n    if (target.closest('[data-action=\"rename\"]')) {\n      return false;\n    }\n\n    if (target.closest('[data-action=\"edit-value\"]')) {\n      return false;\n    }\n\n    if (target.closest('[data-open-link=\"true\"]')) {\n      return false;\n    }\n\n    return true;\n  }\n\n  function createValueElement(\n    descriptor,\n    className,\n    options: { path?: string; editable?: boolean; schemaPointer?: SchemaPointerInfo } = {}\n  ) {\n    const element = document.createElement('span');\n    element.className = `${className} ${className}--${descriptor.kind}`;\n    const icon = createIconElement(descriptor.icon ?? ICON_TYPES.unknown);\n    element.appendChild(icon);\n\n    const textSpan = document.createElement('span');\n    textSpan.className = `${className}__text`;\n    textSpan.textContent = descriptor.label;\n    element.appendChild(textSpan);\n\n    if (descriptor.href) {\n      element.dataset.openLink = 'true';\n      element.setAttribute('data-href', descriptor.href);\n      if (descriptor.title) {\n        element.title = descriptor.title;\n      } else {\n        element.title = descriptor.href;\n      }\n    } else if (descriptor.title) {\n      element.title = descriptor.title;\n    }\n\n    if (options.editable && options.path) {\n      element.dataset.action = 'edit-value';\n      element.dataset.path = options.path;\n      element.dataset.kind = descriptor.kind === 'link' ? 'string' : descriptor.kind;\n      element.dataset.literal = serializeValueLiteral(descriptor.rawValue);\n      element.classList.add(`${className}--action`);\n      element.setAttribute('role', 'button');\n      element.setAttribute('tabindex', '0');\n      const baseTitle = element.title;\n      const editHint = descriptor.href\n        ? 'Click to edit value. Cmd/Ctrl+Click to open link.'\n        : 'Click to edit value.';\n      element.title = baseTitle ? `${baseTitle}\\n${editHint}` : editHint;\n    }\n\n    if (options.schemaPointer && options.path) {\n      element.appendChild(createSchemaButton(options.schemaPointer, options.path));\n    }\n\n    return element;\n  }\n\n  function createIconElement(type) {\n    const span = document.createElement('span');\n    span.className = 'value-icon';\n    const markup = ICON_SVGS[type] ?? ICON_SVGS.unknown;\n    span.innerHTML = markup;\n    const svg = span.querySelector('svg');\n    if (svg) {\n      svg.setAttribute('aria-hidden', 'true');\n      svg.setAttribute('focusable', 'false');\n    }\n    return span;\n  }\n\n  function createSchemaButton(schemaPointer: SchemaPointerInfo, path: string) {\n    const button = document.createElement('button');\n    button.type = 'button';\n    button.className = 'value-schema-button';\n    button.dataset.action = 'open-schema';\n    button.dataset.path = path;\n    button.textContent = 'Schema';\n    const tooltipLines = [];\n    if (schemaPointer.title) {\n      tooltipLines.push(schemaPointer.title);\n    }\n    if (schemaPointer.description) {\n      tooltipLines.push(schemaPointer.description);\n    }\n    tooltipLines.push(schemaPointer.pointer ? `Pointer: ${schemaPointer.pointer}` : 'Go to schema definition');\n    button.title = tooltipLines.join('\\n');\n    const pointerLabel = schemaPointer.pointer || 'schema';\n    button.setAttribute('aria-label', `Go to schema definition (${pointerLabel})`);\n    return button;\n  }\n\n  function truncate(value, limit = 28) {\n    if (value.length <= limit) {\n      return value;\n    }\n\n    return `${value.slice(0, limit - 1)}…`;\n  }\n\n  function isObject(value) {\n    return typeof value === 'object' && value !== null;\n  }\n\n  function isUrl(value) {\n    return /^https?:\\/\\/[^\\s]+$/i.test(value);\n  }\n\n  function serializePath(path) {\n    return JSON.stringify(path);\n  }\n\n  function computeAutoScale(graphSize, nodeCount) {\n    const heuristicScale = clampAutoScale(computeDensityScale(nodeCount));\n    const fitScale = computeFitScale(graphSize);\n    const candidate = typeof fitScale === 'number' ? Math.min(fitScale, heuristicScale) : heuristicScale;\n    return clampAutoScale(Math.max(candidate, AUTO_VISIBLE_MIN_SCALE));\n  }\n\n  function computeFitScale(graphSize) {\n    if (!graphSize) {\n      return undefined;\n    }\n\n    const viewportWidth = viewport?.clientWidth || graphRoot.clientWidth || window.innerWidth || 1;\n    const viewportHeight = viewport?.clientHeight || graphRoot.clientHeight || window.innerHeight || 1;\n    const width = graphSize?.width ?? 0;\n    const height = graphSize?.height ?? 0;\n    if (width <= 0 || height <= 0) {\n      return undefined;\n    }\n\n    const ratio = Math.min(viewportWidth / width, viewportHeight / height);\n    const padded = ratio * AUTO_FIT_PADDING;\n    if (!Number.isFinite(padded) || padded <= 0) {\n      return undefined;\n    }\n\n    return padded;\n  }\n\n  function computeDensityScale(nodeCount) {\n    if (nodeCount > 2000) {\n      return 0.35;\n    }\n    if (nodeCount > 1200) {\n      return 0.45;\n    }\n    if (nodeCount > 800) {\n      return 0.55;\n    }\n    if (nodeCount > 500) {\n      return 0.65;\n    }\n    if (nodeCount > 300) {\n      return 0.8;\n    }\n    return 1;\n  }\n\n  function clampAutoScale(value) {\n    const candidate = typeof value === 'number' && Number.isFinite(value) ? value : 1;\n    return clamp(candidate, AUTO_MIN_SCALE, AUTO_MAX_SCALE);\n  }\n\n  function clampScale(value) {\n    const candidate = typeof value === 'number' ? value : 1;\n    return clamp(candidate, MANUAL_MIN_SCALE, AUTO_MAX_SCALE);\n  }\n\n  function clamp(value, min, max) {\n    return Math.min(Math.max(value, min), max);\n  }\n\n  function formatChildKey(parentLabel, childKey, parentValue) {\n    if (!Array.isArray(parentValue)) {\n      return String(childKey);\n    }\n\n    const baseLabel = deriveArrayItemLabel(parentLabel);\n    const numeric = Number(childKey);\n    const suffix = Number.isInteger(numeric) ? numeric + 1 : String(childKey);\n    return `${baseLabel} ${suffix}`;\n  }\n\n  function deriveArrayItemLabel(parentLabel) {\n    if (!parentLabel || parentLabel === 'JSON') {\n      return 'Item';\n    }\n\n    const trimmed = parentLabel.trim();\n    if (!trimmed) {\n      return 'Item';\n    }\n\n    const lower = trimmed.toLowerCase();\n    if (lower.endsWith('ies')) {\n      return capitalize(lower.slice(0, -3) + 'y');\n    }\n\n    if (lower.endsWith('ses')) {\n      return capitalize(lower.slice(0, -2));\n    }\n\n    if (lower.endsWith('s')) {\n      return capitalize(lower.slice(0, -1));\n    }\n\n    return capitalize(lower);\n  }\n\n  function parseLineInput(value) {\n    if (typeof value !== 'string') {\n      return undefined;\n    }\n    const trimmed = value.trim();\n    if (!trimmed) {\n      return undefined;\n    }\n    const parsed = Number.parseInt(trimmed, 10);\n    if (!Number.isFinite(parsed) || parsed <= 0) {\n      return undefined;\n    }\n    return parsed;\n  }\n\n  function normalizeLineRange(start, end) {\n    if (start > end) {\n      return { start: end, end: start };\n    }\n    return { start, end };\n  }\n\n  function formatSelectionLabel(start, end) {\n    if (start === end) {\n      return `Line ${start}`;\n    }\n    return `Lines ${start}-${end}`;\n  }\n\n  function capitalize(value) {\n    if (!value) {\n      return '';\n    }\n\n    return value.charAt(0).toUpperCase() + value.slice(1);\n  }\n\n  function formatProviderName(provider) {\n    switch (provider) {\n      case 'openai':\n        return 'OpenAI';\n      case 'anthropic':\n        return 'Anthropic';\n      default:\n        return capitalize(provider);\n    }\n  }\n\n  function getMissingKeyMessage() {\n    return `Set your ${formatProviderName(activeModelProvider)} API key to send messages.`;\n  }\n\n  function serializePositions(map) {\n    const result = {};\n    map.forEach((value, key) => {\n      result[key] = value;\n    });\n    return result;\n  }\n\n  function updateSearchIndex(nodes) {\n    searchIndex = new Map();\n    nodes.forEach((node) => {\n      const descriptorLabel = typeof node.descriptor?.label === 'string' ? node.descriptor.label : '';\n      const rawValue =\n        typeof node.descriptor?.rawValue === 'string'\n          ? node.descriptor.rawValue\n          : typeof node.descriptor?.rawValue !== 'undefined'\n            ? String(node.descriptor.rawValue)\n            : '';\n      const text = [node.key, descriptorLabel, rawValue].filter(Boolean).join(' ').toLowerCase();\n      searchIndex.set(node.id, { text });\n    });\n\n    if (currentSearchQuery) {\n      if (!searchIndex.has(currentSearchMatch ?? '')) {\n        currentSearchMatch = undefined;\n      }\n    }\n  }\n\n  function performSearch(query) {\n    currentSearchQuery = query;\n    if (!query) {\n      pendingSearchFocusId = undefined;\n      currentSearchMatch = undefined;\n      clearSearchHighlight();\n      return;\n    }\n\n    const normalized = query.toLowerCase();\n    let matchId;\n    for (const [id, payload] of searchIndex) {\n      if (payload.text.includes(normalized)) {\n        matchId = id;\n        break;\n      }\n    }\n\n    if (!matchId) {\n      clearSearchHighlight();\n      currentSearchMatch = undefined;\n      return;\n    }\n\n    currentSearchMatch = matchId;\n    pendingSearchFocusId = matchId;\n\n    if (viewMode !== 'graph') {\n      setViewMode('graph');\n      return;\n    }\n\n    focusGraphNode(matchId);\n  }\n\n  function clearSearchHighlight() {\n    nodeElements.forEach(({ element }) => element.classList.remove('is-search-hit'));\n    treeRoot.querySelectorAll('.tree-node.is-search-hit').forEach((node) => node.classList.remove('is-search-hit'));\n  }\n\n  function applySearchHighlight() {\n    clearSearchHighlight();\n    if (!currentSearchQuery || viewMode !== 'graph') {\n      return;\n    }\n\n    if (currentSearchMatch && nodeElements.has(currentSearchMatch)) {\n      nodeElements.get(currentSearchMatch).element.classList.add('is-search-hit');\n    }\n  }\n\n  function focusGraphNode(nodeId) {\n    const entry = nodeElements.get(nodeId);\n    if (!entry) {\n      return;\n    }\n\n    nodeElements.forEach(({ element }) => element.classList.remove('is-search-hit'));\n    entry.element.classList.add('is-search-hit');\n\n    const viewportWidth = viewport?.clientWidth ?? 0;\n    const viewportHeight = viewport?.clientHeight ?? 0;\n    const nodeWidth = entry.element.offsetWidth || 0;\n    const nodeHeight = entry.element.offsetHeight || 0;\n    const scale = panState.scale || 1;\n\n    panState.x = viewportWidth / 2 - (entry.node.x + nodeWidth / 2) * scale;\n    panState.y = viewportHeight / 2 - (entry.node.y + nodeHeight / 2) * scale;\n    applyPan();\n    pendingSearchFocusId = undefined;\n  }\n\n  function focusTreeNode(path) {\n    if (!path) {\n      return;\n    }\n    requestAnimationFrame(() => {\n      const selector = `.tree-node[data-path=\"${escapeCss(path)}\"]`;\n      const node = treeRoot.querySelector(selector);\n      if (!(node instanceof HTMLElement)) {\n        return;\n      }\n      node.scrollIntoView({ block: 'center', behavior: 'smooth' });\n      node.classList.add('is-search-hit');\n      if (typeof node.focus === 'function') {\n        node.focus({ preventScroll: true });\n      }\n      setTimeout(() => node.classList.remove('is-search-hit'), 800);\n    });\n  }\n\n  function focusPath(path) {\n    if (!path) {\n      return;\n    }\n    if (viewMode === 'graph') {\n      requestAnimationFrame(() => focusGraphNode(path));\n    } else {\n      focusTreeNode(path);\n    }\n  }\n\n  function setControlsCollapsed(value, options = { persist: true }) {\n    controlsCollapsed = Boolean(value);\n    if (controlDock instanceof HTMLElement) {\n      controlDock.classList.toggle('is-collapsed', controlsCollapsed);\n    }\n    if (controlDockPanel instanceof HTMLElement) {\n      controlDockPanel.setAttribute('aria-hidden', String(controlsCollapsed));\n    }\n    if (controlDockToggle instanceof HTMLButtonElement) {\n      controlDockToggle.setAttribute('aria-expanded', String(!controlsCollapsed));\n      controlDockToggle.title = controlsCollapsed ? 'Show controls' : 'Hide controls';\n      controlDockToggle.setAttribute('aria-label', controlsCollapsed ? 'Show controls' : 'Hide controls');\n    }\n    if (options.persist !== false) {\n      persistState();\n    }\n  }\n\n  function toggleChatPanel(forceState) {\n    if (!(chatPanel instanceof HTMLElement)) {\n      return;\n    }\n\n    const nextState = typeof forceState === 'boolean' ? forceState : !chatPanelVisible;\n    chatPanelVisible = nextState;\n    if (nextState) {\n      chatPanel.removeAttribute('hidden');\n      if (chatInput instanceof HTMLTextAreaElement) {\n        chatInput.focus();\n      }\n    } else {\n      chatPanel.setAttribute('hidden', 'true');\n    }\n  }\n\n  function applySelectionInfo(info) {\n    if (info && typeof info === 'object') {\n      selectionActive = Boolean(info.active);\n      const startLine = typeof info.startLine === 'number' ? info.startLine + 1 : undefined;\n      const endLine = typeof info.endLine === 'number' ? info.endLine + 1 : undefined;\n      const hasRange = typeof startLine === 'number' && typeof endLine === 'number';\n      selectionLineRange = selectionActive && hasRange ? { start: startLine, end: endLine } : {};\n    } else {\n      selectionActive = false;\n      selectionLineRange = {};\n    }\n    updateSelectionIndicator();\n  }\n\n  function updateSelectionIndicator() {\n    updateSelectionInputs();\n  }\n\n  function updateSelectionInputs() {\n    if (!(selectionStartInput instanceof HTMLInputElement) || !(selectionEndInput instanceof HTMLInputElement)) {\n      return;\n    }\n\n    if (typeof selectionLineRange.start === 'number') {\n      selectionStartInput.value = String(selectionLineRange.start);\n    } else if (!selectionStartInput.matches(':focus')) {\n      selectionStartInput.value = '';\n    }\n\n    if (typeof selectionLineRange.end === 'number') {\n      selectionEndInput.value = String(selectionLineRange.end);\n    } else if (!selectionEndInput.matches(':focus')) {\n      selectionEndInput.value = '';\n    }\n  }\n\n  function updateModelSelect(payload) {\n    if (!(chatModelSelect instanceof HTMLSelectElement)) {\n      return;\n    }\n\n    const options = Array.isArray(payload?.options) ? payload.options : [];\n    const selectedId = typeof payload?.selectedId === 'string' ? payload.selectedId : '';\n    if (typeof payload?.selectedProvider === 'string') {\n      activeModelProvider = payload.selectedProvider;\n    }\n    chatModelSelect.innerHTML = '';\n\n    if (!options.length) {\n      const placeholder = document.createElement('option');\n      placeholder.value = '';\n      placeholder.textContent = 'No models';\n      chatModelSelect.appendChild(placeholder);\n      chatModelSelect.disabled = true;\n      return;\n    }\n\n    options.forEach((option) => {\n      if (!option || typeof option !== 'object') {\n        return;\n      }\n      const element = document.createElement('option');\n      element.value = String(option.id ?? '');\n      element.textContent = option.label ?? option.id ?? 'Model';\n      if (option.description) {\n        element.title = option.description;\n      }\n      chatModelSelect.appendChild(element);\n    });\n\n    chatModelSelect.disabled = false;\n    if (selectedId) {\n      chatModelSelect.value = selectedId;\n    }\n  }\n\n  function ensureChatPanel() {\n    if (!chatPanelVisible) {\n      toggleChatPanel(true);\n    }\n  }\n\n  function clearChatMessages() {\n    chatMessageMap.clear();\n    if (chatMessages) {\n      chatMessages.innerHTML = '';\n    }\n  }\n\n  function renderChatHistory(messages) {\n    clearChatMessages();\n    if (!Array.isArray(messages)) {\n      return;\n    }\n\n    messages.forEach((entry) => setChatMessage(entry?.id, entry?.role ?? 'assistant', entry?.text ?? ''));\n  }\n\n  function setChatMessage(id, role, text, options = {}) {\n    if (!id) {\n      return;\n    }\n    const record = getOrCreateChatRecord(id, role);\n    record.text = options.pending ? '' : text;\n    record.element.classList.toggle('is-pending', Boolean(options.pending));\n    record.content.innerHTML = renderChatHtml(record.text, options.pending);\n    scrollChatToBottom();\n    showChatStatus('');\n  }\n\n  function appendChatDelta(id, delta) {\n    if (!id || !delta) {\n      return;\n    }\n    const record = getOrCreateChatRecord(id, 'assistant');\n    record.element.classList.remove('is-pending');\n    const isThinkingPlaceholder =\n      typeof record.text === 'string' && record.text.trim().startsWith('AI is thinking');\n    const current = isThinkingPlaceholder ? '' : record.text || '';\n    record.text = current + delta;\n    record.content.innerHTML = renderChatHtml(record.text);\n    scrollChatToBottom();\n    showChatStatus('');\n  }\n\n  function finalizeAssistantMessage(id, text, snippet) {\n    if (!id) {\n      return;\n    }\n    const record = getOrCreateChatRecord(id, 'assistant');\n    record.text = text;\n    record.element.classList.remove('is-pending');\n    record.content.innerHTML = renderChatHtml(text);\n\n    const existing = record.element.querySelector('.chat-message__actions');\n    if (existing) {\n      existing.remove();\n    }\n\n    if (snippet) {\n      const actions = document.createElement('div');\n      actions.className = 'chat-message__actions';\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.textContent = 'Apply snippet';\n      button.addEventListener('click', () => {\n        vscode.postMessage({ type: 'chat:applySnippet', payload: { content: snippet } });\n      });\n      actions.appendChild(button);\n      record.element.appendChild(actions);\n    }\n\n    scrollChatToBottom();\n  }\n\n  function getOrCreateChatRecord(id, role) {\n    let record = chatMessageMap.get(id);\n    if (!record) {\n      const wrapper = document.createElement('div');\n      wrapper.className = `chat-message chat-message--${role}`;\n      const content = document.createElement('div');\n      content.className = 'chat-message__content';\n      wrapper.appendChild(content);\n      chatMessages?.appendChild(wrapper);\n      record = { element: wrapper, content, text: '' };\n      chatMessageMap.set(id, record);\n    }\n    return record;\n  }\n\n  function scrollChatToBottom() {\n    if (!chatMessages) {\n      return;\n    }\n    requestAnimationFrame(() => {\n      chatMessages.scrollTop = chatMessages.scrollHeight;\n    });\n  }\n\n  function showChatStatus(text) {\n    if (!(chatStatus instanceof HTMLElement)) {\n      return;\n    }\n\n    const normalized = typeof text === 'string' ? text.trim() : '';\n    const isThinking =\n      normalized === 'Thinking…' ||\n      normalized === 'Thinking...' ||\n      normalized === 'AI is thinking…' ||\n      normalized === 'AI is thinking...';\n\n    if (isThinking) {\n      chatStatus.innerHTML =\n        'AI is thinking<span class=\"chat-status__dots\"><span>.</span><span>.</span><span>.</span></span>';\n      chatStatus.classList.add('is-thinking');\n      return;\n    }\n\n    chatStatus.textContent = text || '';\n    chatStatus.classList.remove('is-thinking');\n  }\n\n  function renderChatHtml(text, pending) {\n    if (pending) {\n      return `<span class=\"chat-pending-dots\"><span></span><span></span><span></span></span>`;\n    }\n\n    const escape = (value) =>\n      value\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n\n    const codeRegex = /```(\\w+)?\\s*([\\s\\S]*?)```/g;\n    let lastIndex = 0;\n    let html = '';\n    let match;\n    while ((match = codeRegex.exec(text)) !== null) {\n      html += escape(text.slice(lastIndex, match.index));\n      const lang = match[1]?.trim() ?? 'json';\n      const code = escape(match[2].trim());\n      html += `<pre class=\"chat-code\"><code class=\"lang-${lang}\">${code}</code></pre>`;\n      lastIndex = codeRegex.lastIndex;\n    }\n    html += escape(text.slice(lastIndex));\n    return html;\n  }\n\n  function escapeCss(value) {\n    if (typeof CSS !== 'undefined' && typeof CSS.escape === 'function') {\n      return CSS.escape(value);\n    }\n    return String(value).replace(/[\"\\\\]/g, '\\\\$&');\n  }\n\n})();\n"],"names":["vscode","container","status","viewSelect","layoutPresetSelect","searchInput","chatToggle","chatPanel","chatClose","chatReset","chatMessages","chatForm","chatInput","chatStatus","chatModelSelect","selectionLineForm","selectionStartInput","selectionEndInput","selectionClearButton","controlDock","controlDockPanel","controlDockToggle","graphRoot","treeRoot","nodeElements","pathDepths","collapsedPathStore","depthExpandedPathStore","collapsedPaths","depthExpandedPaths","persistedState","_a","nodePositionStore","_b","layoutPresetStore","nodePositions","currentDocumentId","currentEdges","activeNodeDrag","currentPayload","viewport","canvas","nodesLayer","linksLayer","isPanning","panPointerId","panStart","panOrigin","hasUserMovedView","viewMode","hasPersistedViewPreference","graphAutoScale","manualGraphScale","graphInitialScale","graphMaxDepth","searchIndex","currentSearchQuery","currentSearchMatch","pendingSearchFocusId","chatMessageMap","chatPanelVisible","awaitingChatKey","hasAiKey","selectionActive","selectionLineRange","controlsCollapsed","needsInitialGraphFocus","activeModelProvider","currentLayoutPreset","configDefaultLayoutPreset","LAYOUT_PRESETS","CANVAS_PADDING","MANUAL_MIN_SCALE","AUTO_MIN_SCALE","AUTO_MAX_SCALE","AUTO_FIT_PADDING","AUTO_VISIBLE_MIN_SCALE","MAX_SCALE","ICON_TYPES","EDITABLE_VALUE_KINDS","ROOT_PATH","ICON_SVGS","schemaPointerIndex","panState","minScaleLimit","event","next","setViewMode","value","normalizeLayoutPreset","applyLayoutPreset","performSearch","toggleChatPanel","showChatStatus","getMissingKeyMessage","clearChatMessages","submitChatInput","startValue","parseLineInput","endValue","normalized","normalizeLineRange","updateSelectionInputs","setControlsCollapsed","handleContainerClick","handleKeydown","type","payload","renderVisualizer","renderInvalidState","renderChatHistory","ensureChatPanel","setChatMessage","appendChatDelta","finalizeAssistantMessage","_c","updateModelSelect","applySelectionInfo","path","focusGraphNode","applySchemaPointers","rerenderFromState","raw","info","persistState","options","serializePositions","docKey","preset","changed","getCurrentLayoutSpacing","syncLayoutPresetWithDocument","stored","desired","switchDocument","documentId","collapsed","expanded","pruneNodePositions","validIds","id","target","schemaTarget","editValueTarget","literal","kind","href","requestEditValue","link","renameTarget","currentName","requestRename","toggle","togglePath","isAutoCollapsedPath","focusPath","rememberPathDepth","pathKey","depth","getActiveDepthLimit","shouldCollapseByDepth","limit","initViewport","setupPanAndZoom","deltaX","deltaY","applyPan","endPan","pointerToRelease","factor","nextScale","clamp","rect","offsetX","offsetY","scaleRatio","resetPan","force","scaleOverride","host","viewportWidth","viewportHeight","canvasRect","canvasWidth","canvasHeight","targetScale","normalizedScale","updateMinScaleLimit","initialScale","renderData","mode","data","defaultViewMode","initialSelectionInfo","clampScale","hideStatus","graphData","buildGraph","updateSearchIndex","renderTreeView","renderGraph","graph","node","element","createGraphNodeElement","drawEdges","computeAutoScale","applySearchHighlight","tree","buildTreeBranch","key","serializePath","schemaInfo","entries","getChildEntries","hasChildren","depthLimited","isCollapsed","listItem","control","chevron","keySpan","canRename","connector","descriptor","describeValue","valueElement","createValueElement","canEditValueDescriptor","childList","childKey","childValue","childPath","childLabel","formatChildKey","message","updateSelectionIndicator","nodes","edges","maxDepth","nextRow","layoutSpacing","gapX","gapY","traverse","parentId","children","lastSegment","childPositions","top","bottom","width","height","custom","enableNodeDragging","shouldStartNodeDrag","newX","newY","updateNodePosition","endDrag","finishNodeDrag","edge","parent","child","parentWidth","parentHeight","childHeight","startX","startY","endX","endY","controlOffset","nodeId","x","y","entry","moved","index","isObject","trimmed","isUrl","truncate","serializeValueLiteral","rawValue","className","icon","createIconElement","textSpan","baseTitle","editHint","createSchemaButton","span","markup","svg","schemaPointer","button","tooltipLines","pointerLabel","graphSize","nodeCount","heuristicScale","clampAutoScale","computeDensityScale","fitScale","computeFitScale","candidate","padded","min","max","parentLabel","parentValue","baseLabel","deriveArrayItemLabel","numeric","suffix","lower","capitalize","parsed","start","end","formatProviderName","provider","map","result","descriptorLabel","text","query","clearSearchHighlight","matchId","nodeWidth","nodeHeight","scale","focusTreeNode","selector","escapeCss","forceState","nextState","startLine","endLine","selectedId","placeholder","option","messages","role","record","getOrCreateChatRecord","renderChatHtml","scrollChatToBottom","delta","current","snippet","existing","actions","wrapper","content","pending","escape","codeRegex","lastIndex","html","match","lang","code"],"mappings":"0BAAC,UAAY,WACX,MAAMA,EAAS,iBAAA,EACTC,GAAY,SAAS,eAAe,YAAY,EAChDC,GAAS,SAAS,eAAe,QAAQ,EACzCC,EAAa,SAAS,eAAe,sBAAsB,EAC3DC,GAAqB,SAAS,eAAe,oBAAoB,EACjEC,GAAc,SAAS,eAAe,uBAAuB,EAC7DC,GAAa,SAAS,eAAe,YAAY,EACjDC,GAAY,SAAS,eAAe,WAAW,EAC/CC,GAAY,SAAS,eAAe,WAAW,EAC/CC,GAAY,SAAS,eAAe,WAAW,EAC/CC,EAAe,SAAS,eAAe,cAAc,EACrDC,GAAW,SAAS,eAAe,UAAU,EAC7CC,EAAY,SAAS,eAAe,WAAW,EAC/CC,GAAa,SAAS,eAAe,YAAY,EACjDC,EAAkB,SAAS,eAAe,iBAAiB,EAC3DC,GAAoB,SAAS,eAAe,mBAAmB,EAC/DC,EAAsB,SAAS,eAAe,qBAAqB,EACnEC,EAAoB,SAAS,eAAe,mBAAmB,EAC/DC,GAAuB,SAAS,eAAe,sBAAsB,EACrEC,GAAc,SAAS,eAAe,aAAa,EACnDC,GAAmB,SAAS,eAAe,kBAAkB,EAC7DC,EAAoB,SAAS,eAAe,mBAAmB,EAErE,GAAI,CAACpB,IAAa,CAACC,GAAQ,CACzBF,EAAO,YAAY,CAAE,KAAM,OAAA,CAAS,EACpC,MACF,CAEA,MAAMsB,EAAY,SAAS,cAAc,SAAS,EAClDA,EAAU,UAAY,wCACtBA,EAAU,aAAa,SAAU,MAAM,EACvCrB,GAAU,YAAYqB,CAAS,EAE/B,MAAMC,EAAW,SAAS,cAAc,SAAS,EACjDA,EAAS,UAAY,uCACrBA,EAAS,aAAa,SAAU,MAAM,EACtCtB,GAAU,YAAYsB,CAAQ,EAE9B,MAAMC,MAAmB,IACnBC,OAAiB,IACjBC,OAAyB,IACzBC,OAA6B,IACnC,IAAIC,MAAqB,IACrBC,MAAyB,IACzBC,EAAiB,OAAO9B,EAAO,UAAa,YAAa+B,GAAA/B,EAAO,aAAP,KAAA+B,GAAqB,CAAA,EAAK,CAAA,EACnFC,IAAoBC,GAAAH,EAAe,gBAAf,KAAAG,GAAgC,CAAA,EACpDC,GACF,OAAOJ,EAAe,eAAkB,UAAYA,EAAe,cAC/DA,EAAe,cACf,CAAA,EACFK,MAAoB,IACpBC,EACAC,GAAe,CAAA,EACfC,EAEAC,GACAC,EACAC,EACAC,GACAC,EACAC,GAAY,GACZC,EAAe,KACfC,GAAW,CAAE,EAAG,EAAG,EAAG,CAAA,EACtBC,GAAY,CAAE,EAAG,EAAG,EAAG,CAAA,EACvBC,EAAmB,GACnBC,EAAWnB,EAAe,WAAa,OAAS,OAAS,QACzDoB,GAA6B,OAAOpB,EAAe,UAAa,SAEhEqB,GAAiB,GACjBC,GAAmB,EACnBC,GAAoB,EACpBC,EACAC,OAAkB,IAClBC,GAAqB,GACrBC,EACAC,EACJ,MAAMC,OAAqB,IAC3B,IAAIC,EAAmB,GACnBC,GAAkB,GAClBC,EAAW,GACXC,EAAkB,GAElBC,EAAuD,CAAA,EACvDC,EAAoB,EAAQnC,EAAe,kBAC3CoC,EAAyB,GACzBC,GAAsB,SACtBC,GAAoC,WACpCC,GAA0C,WAE9C,MAAMC,GAAiB,CACrB,QAAS,CAAE,KAAM,IAAK,KAAM,EAAA,EAC5B,SAAU,CAAE,KAAM,IAAK,KAAM,EAAA,EAC7B,QAAS,CAAE,KAAM,IAAK,KAAM,GAAA,CAAI,EAG5BC,GAAiB,GACjBC,GAAmB,GACnBC,GAAiB,IACjBC,GAAiB,IACjBC,GAAmB,GACnBC,GAAyB,IACzBC,GAAY,IACZC,EAAa,CACjB,OAAQ,SACR,MAAO,QACP,OAAQ,SACR,OAAQ,SACR,QAAS,UACT,KAAM,OACN,KAAM,OACN,QAAS,SAAA,EAELC,OAA2B,IAAI,CAAC,SAAU,SAAU,UAAW,OAAQ,MAAM,CAAC,EAC9EC,GAAY,KAAK,UAAU,EAAE,EAC7BC,GAAY,CAChB,OACE,gbACF,MACE,kLACF,OACE,kSACF,OACE,mNACF,QACE,iOACF,KACE,6NACF,KACE,kYACF,QACE,qQAAA,EASJ,IAAIC,OAAyB,IAE7B,MAAMC,EAAW,CAAE,EAAG,EAAG,EAAG,EAAG,MAAO,CAAA,EACtC,IAAIC,GAAgBZ,GAwDpB,GAtDIrE,aAAsB,oBACxBA,EAAW,MAAQ8C,EACnB9C,EAAW,iBAAiB,SAAWkF,GAAU,CAC/C,MAAMC,EAAOD,EAAM,OAAO,QAAU,OAAS,OAAS,QACtDE,GAAYD,CAAI,CAClB,CAAC,GAGClF,cAA8B,oBAChCA,GAAmB,MAAQgE,GAC3BhE,GAAmB,iBAAiB,SAAWiF,GAAU,CACvD,MAAMG,EAAQH,EAAM,OAAO,MACrBC,EAAOG,GAAsBD,CAAK,EACxCE,GAAkBJ,CAAI,CACxB,CAAC,GAGCjF,cAAuB,kBACzBA,GAAY,iBAAiB,QAAUgF,GAAU,CAC/C,MAAMG,EAAQH,EAAM,OAAO,MAAM,KAAA,EACjCM,GAAcH,CAAK,CACrB,CAAC,EAGClF,cAAsB,mBACxBA,GAAW,iBAAiB,QAAS,IAAM,CACzC,GAAIsD,EAAkB,CACpBgC,GAAgB,EAAK,EACrB,MACF,CAGA,GADAA,GAAgB,EAAI,EAChB9B,EAAU,CACZ+B,EAAe,EAAE,EACjB,MACF,CAEAhC,GAAkB,GAClBgC,EAAeC,IAAsB,EACrC9F,EAAO,YAAY,CAAE,KAAM,gBAAA,CAAkB,CAC/C,CAAC,EAGCQ,cAAqB,mBACvBA,GAAU,iBAAiB,QAAS,IAAMoF,GAAgB,EAAK,CAAC,EAG9DnF,cAAqB,mBACvBA,GAAU,iBAAiB,QAAS,IAAM,CACxCT,EAAO,YAAY,CAAE,KAAM,YAAA,CAAc,EACzC+F,GAAA,CACF,CAAC,EAGCpF,cAAoB,iBAAmBC,aAAqB,oBAAqB,CACnF,MAAMoF,EAAkB,IAAM,CAC5B,MAAMR,EAAQ5E,EAAU,MAAM,KAAA,EAC9B,GAAK4E,EAIL,IAAI,CAAC1B,EAAU,CACbD,GAAkB,GAClBgC,EAAeC,IAAsB,EACrC9F,EAAO,YAAY,CAAE,KAAM,gBAAA,CAAkB,EAC7C,MACF,CAEAA,EAAO,YAAY,CAAE,KAAM,YAAa,QAAS,CAAE,KAAMwF,CAAA,EAAS,EAClE5E,EAAU,MAAQ,GAClBiF,EAAe,uBAAuB,EACxC,EAEAlF,GAAS,iBAAiB,SAAW0E,GAAU,CAC7CA,EAAM,eAAA,EACNW,EAAA,CACF,CAAC,EAEDpF,EAAU,iBAAiB,UAAYyE,GAAU,CAC3CA,EAAM,MAAQ,SAAW,CAACA,EAAM,WAClCA,EAAM,eAAA,EACNW,EAAA,EAEJ,CAAC,CACH,CAEIlF,aAA2B,mBAC7BA,EAAgB,iBAAiB,SAAWuE,GAAU,CACpD,MAAMG,EAAQH,EAAM,OAAO,MACtBG,GAGLxF,EAAO,YAAY,CAAE,KAAM,gBAAiB,QAAS,CAAE,QAASwF,CAAA,EAAS,CAC3E,CAAC,EAIDzE,cAA6B,iBAC7BC,aAA+B,kBAC/BC,aAA6B,kBAE7BF,GAAkB,iBAAiB,SAAWsE,GAAU,CACtDA,EAAM,eAAA,EACN,MAAMY,EAAaC,GAAelF,EAAoB,KAAK,EACrDmF,EAAWD,GAAejF,EAAkB,KAAK,EACvD,GAAI,OAAOgF,GAAe,UAAY,OAAOE,GAAa,SACxD,OAEF,MAAMC,EAAaC,GAAmBJ,EAAYE,CAAQ,EAC1DpC,EAAkB,GAClBC,EAAqBoC,EACrBE,GAAA,EACAtG,EAAO,YAAY,CAAE,KAAM,uBAAwB,QAAS,CAAE,UAAWoG,EAAW,MAAO,QAASA,EAAW,GAAA,EAAO,CACxH,CAAC,EAGClF,cAAgC,mBAClCA,GAAqB,iBAAiB,QAAS,IAAM,CAC/CF,aAA+B,mBACjCA,EAAoB,MAAQ,IAE1BC,aAA6B,mBAC/BA,EAAkB,MAAQ,IAE9B+C,EAAqB,CAAA,EACrBD,EAAkB,GAClBuC,GAAA,EACAtG,EAAO,YAAY,CAAE,KAAM,iBAAA,CAAmB,CAChD,CAAC,EAGGqB,aAA6B,mBAC/BA,EAAkB,iBAAiB,QAAS,IAAM,CAChDkF,GAAqB,CAACtC,CAAiB,CACzC,CAAC,EAGHsC,GAAqBtC,EAAmB,CAAE,QAAS,EAAA,CAAO,EAE1DhE,GAAU,iBAAiB,QAASuG,EAAoB,EACxDvG,GAAU,iBAAiB,UAAWwG,EAAa,EAEnD,OAAO,iBAAiB,UAAYpB,GAAU,WAC5C,KAAM,CAAE,KAAAqB,EAAM,QAAAC,CAAA,EAAYtB,EAAM,MAAQ,CAAA,EACxC,GAAIqB,IAAS,SAAU,CACrBE,GAAiBD,CAAO,EACxB,MACF,CAEA,GAAID,IAAS,UAAW,CACtBG,GAAmBF,CAAO,EAC1B,MACF,CAEA,GAAID,IAAS,eAAgB,CAC3BI,GAAkBH,CAAO,EACzB,MACF,CAEA,GAAID,IAAS,mBAAoB,CAC/BK,GAAA,EACAC,GAAeL,GAAA,YAAAA,EAAS,GAAI,QAAQ5E,EAAA4E,GAAA,YAAAA,EAAS,OAAT,KAAA5E,EAAiB,EAAE,EACvD,MACF,CAEA,GAAI2E,IAAS,sBAAuB,CAClCK,GAAA,EACAC,GAAeL,GAAA,YAAAA,EAAS,GAAI,YAAa,GAAI,CAAE,QAAS,GAAM,EAC9Dd,EAAe,mBAAmB,EAClC,MACF,CAEA,GAAIa,IAAS,sBAAuB,CAClCO,GAAgBN,GAAA,YAAAA,EAAS,IAAI1E,EAAA0E,GAAA,YAAAA,EAAS,OAAT,KAAA1E,EAAiB,EAAE,EAChD,MACF,CAEA,GAAIyE,IAAS,yBAA0B,CACrCQ,GAAyBP,GAAA,YAAAA,EAAS,IAAIQ,EAAAR,GAAA,YAAAA,EAAS,OAAT,KAAAQ,EAAiB,GAAIR,GAAA,YAAAA,EAAS,OAAO,EAC3E,MACF,CAEA,GAAID,IAAS,aAAc,CACzBb,EAAec,GAAA,KAAAA,EAAW,UAAU,EACpC,MACF,CAEA,GAAID,IAAS,cAAe,CAC1Bb,GAAec,GAAA,YAAAA,EAAS,SAAU,WAAa,oBAAsB,EAAE,EACvE,MACF,CAMA,GAJID,IAAS,oBACXb,EAAe,GAAGC,GAAA,CAAsB,2CAA2C,EAGjFY,IAAS,uBAAwB,CACnC5C,EAAW,GAAQ6C,GAAA,MAAAA,EAAS,OACxB7C,GACFD,GAAkB,GAClBgC,EAAe,EAAE,GACRhC,IACTgC,EAAe,GAAGC,GAAA,CAAsB,oCAAoC,EAE9E,MACF,CAEA,GAAIY,IAAS,gBAAiB,CACxB,OAAOC,GAAA,YAAAA,EAAS,WAAa,WAC/BxC,GAAsBwC,EAAQ,UAEhC7C,EAAW,GAAQ6C,GAAA,MAAAA,EAAS,QACxB/C,GAAoB,CAACE,EACvB+B,EAAeC,IAAsB,EAC5BlC,GACTiC,EAAe,EAAE,EAEnB,MACF,CAEA,GAAIa,IAAS,oBAAqB,CAChCU,GAAkBT,CAAO,EACzB,MACF,CAEA,GAAID,IAAS,mBAAoB,CAC/BW,GAAmBV,CAAO,EAC1B,MACF,CAEA,GAAID,IAAS,uBAAwB,CACnC,MAAMY,EAAO,OAAOX,GAAY,SAAWA,EAAU,OACrD,GAAI,CAACW,EACH,OAGF,GADA5D,EAAuB4D,EACnBrE,IAAa,QAAS,CACxBsC,GAAY,OAAO,EACnB,MACF,CACA,sBAAsB,IAAM,CACtB/D,EAAa,IAAI8F,CAAI,IACvBC,GAAeD,CAAI,EACnB5D,EAAuB,OAE3B,CAAC,EACD,MACF,CAEA,GAAIgD,IAAS,kBAAmB,CAC9Bc,GAAoBb,CAAO,EAC3Bc,GAAA,EACA,MACF,CACF,CAAC,EAEDzH,EAAO,YAAY,CAAE,KAAM,OAAA,CAAS,EAEpC,SAASwH,GAAoBE,EAAgE,CAC3FxC,OAAyB,IACrB,GAACwC,GAAO,OAAOA,GAAQ,WAG3B,OAAO,QAAQA,CAAG,EAAE,QAAQ,CAAC,CAACJ,EAAMK,CAAI,IAAM,CACxC,CAACA,GAAQ,OAAOA,EAAK,SAAY,UAGrCzC,GAAmB,IAAIoC,EAAM,CAC3B,QAASK,EAAK,QACd,MAAO,OAAOA,EAAK,OAAU,SAAWA,EAAK,MAAQ,OACrD,YAAa,OAAOA,EAAK,aAAgB,SAAWA,EAAK,YAAc,MAAA,CACxE,CACH,CAAC,CACH,CAEA,SAASC,EAAaC,EAAU,CAAE,cAAe,IAAQ,CACnDA,EAAQ,gBAAkB,IAASzF,IACrCJ,GAAkBI,CAAiB,EAAI0F,GAAmB3F,CAAa,GAGzE,MAAM4F,EAAS3F,GAAA,KAAAA,EAAqB,UAChC2F,IACF7F,GAAkB6F,CAAM,EAAI3D,IAG9BtC,EAAiB,CACf,GAAGA,EACH,SAAAmB,EACA,cAAejB,GACf,kBAAAiC,EACA,cAAe/B,EAAA,EAEb,OAAOlC,EAAO,UAAa,YAC7BA,EAAO,SAAS8B,CAAc,CAElC,CAEA,SAAS4D,GACPsC,EACAH,EAAqD,GACrD,CACA,MAAMzB,EAAaX,GAAsBuC,CAAM,EACzCC,EAAU7B,IAAehC,GAQ/B,GAPAA,GAAsBgC,EAElBhG,cAA8B,oBAChCA,GAAmB,MAAQgG,GAGPyB,EAAQ,UAAY,GACvB,CACjB,MAAME,EAAS3F,GAAA,KAAAA,EAAqB,UAChC2F,IACF7F,GAAkB6F,CAAM,EAAI3B,GAE9BwB,EAAa,CAAE,cAAe,GAAO,CACvC,CAEIK,GAAWJ,EAAQ,WAAa,KAClC3D,EAAyB,GACzBR,EAAuBsB,GACvBhC,EAAmB,GACnByE,GAAkB,EAAI,EAE1B,CAEA,SAAShC,GAAsBD,EAA8B,CAC3D,OAAIA,IAAU,WAAaA,IAAU,UAC5BA,EAEF,UACT,CAEA,SAAS0C,IAA0B,OACjC,OAAOnG,EAAAuC,GAAeF,EAAmB,IAAlC,KAAArC,EAAuCuC,GAAe,QAC/D,CAEA,SAAS6D,IAA+B,CACtC,MAAMJ,EAAS3F,GAAA,KAAAA,EAAqB,UAC9BgG,EAAS,OAAOL,GAAW,SAAW7F,GAAkB6F,CAAM,EAAI,OAClEM,EAAU5C,GAAsB2C,GAAA,KAAAA,EAAU/D,EAAyB,EACzEqB,GAAkB2C,EAAS,CAAE,QAAS,GAAO,SAAU,GAAO,CAChE,CAEA,SAASC,GAAeC,EAAY,CAClC,GAAInG,IAAsBmG,EACxB,OAGEnG,IACFwF,EAAA,EACAlG,GAAmB,IAAIU,EAAmB,IAAI,IAAIR,CAAc,CAAC,EACjED,GAAuB,IAAIS,EAAmB,IAAI,IAAIP,CAAkB,CAAC,GAG3EO,EAAoBmG,EACpB,MAAMH,EAASpG,GAAkBuG,CAAU,EAC3CpG,EAAgB,IAAI,IAAIiG,EAAS,OAAO,QAAQA,CAAM,EAAI,EAAE,EAC5D,MAAMI,EAAY9G,GAAmB,IAAI6G,CAAU,EACnD3G,EAAiB,IAAI,IAAI4G,aAAqB,IAAMA,EAAY,CAAA,CAAE,EAClE,MAAMC,EAAW9G,GAAuB,IAAI4G,CAAU,EACtD1G,EAAqB,IAAI,IAAI4G,aAAoB,IAAMA,EAAW,CAAA,CAAE,EACpEvE,EAAyB,EAC3B,CAEA,SAASwE,GAAmBC,EAAU,CACpC,IAAIV,EAAU,GACd,UAAWW,KAAM,MAAM,KAAKzG,EAAc,KAAA,CAAM,EACzCwG,EAAS,IAAIC,CAAE,IAClBzG,EAAc,OAAOyG,CAAE,EACvBX,EAAU,IAIVA,GACFL,EAAA,CAEJ,CAEA,SAASpB,GAAqBnB,EAAO,SACnC,MAAMwD,EAASxD,EAAM,OACrB,GAAI,EAAEwD,aAAkB,aACtB,OAGF,MAAMC,EAAeD,EAAO,QAAQ,6BAA6B,EACjE,GAAIC,aAAwB,YAAa,CACvC,MAAMxB,EAAOwB,EAAa,aAAa,WAAW,EAClD,GAAI,CAACxB,EACH,OAEFjC,EAAM,eAAA,EACNA,EAAM,gBAAA,EACNrF,EAAO,YAAY,CAAE,KAAM,cAAe,QAAS,CAAE,KAAAsH,CAAA,EAAQ,EAC7D,MACF,CAEA,MAAMyB,EAAkBF,EAAO,QAAQ,4BAA4B,EACnE,GAAIE,aAA2B,YAAa,CAC1C,MAAMzB,EAAOyB,EAAgB,aAAa,WAAW,EAC/CC,EAAUD,EAAgB,aAAa,cAAc,EACrDE,GAAOlH,EAAAgH,EAAgB,aAAa,WAAW,IAAxC,KAAAhH,EAA6C,SACpDmH,EAAOH,EAAgB,aAAa,WAAW,EACrD,GAAI,CAACzB,GAAQ,CAAC0B,EACZ,OAGF,GAAIE,IAAS7D,EAAM,SAAWA,EAAM,SAAU,CAC5CA,EAAM,eAAA,EACNrF,EAAO,YAAY,CAAE,KAAM,WAAY,QAASkJ,EAAM,EACtD,MACF,CAEA7D,EAAM,eAAA,EACNA,EAAM,gBAAA,EACN8D,GAAiB7B,EAAM0B,EAASC,CAAI,EACpC,MACF,CAEA,MAAMG,EAAOP,EAAO,QAAQ,yBAAyB,EAC/CK,EAAOE,aAAgB,kBAAoBA,EAAK,KAAOA,GAAA,YAAAA,EAAM,aAAa,aAChF,GAAIF,EAAM,CACR7D,EAAM,eAAA,EACNrF,EAAO,YAAY,CAAE,KAAM,WAAY,QAASkJ,EAAM,EACtD,MACF,CAEA,MAAMG,EAAeR,EAAO,QAAQ,wBAAwB,EAC5D,GAAIQ,aAAwB,YAAa,CACvC,MAAM/B,EAAO+B,EAAa,aAAa,WAAW,EAC5CC,GAAcrH,EAAAoH,EAAa,aAAa,UAAU,IAApC,KAAApH,EAAyC,GAC7D,GAAI,CAACqF,EACH,OAEFjC,EAAM,eAAA,EACNA,EAAM,gBAAA,EACNkE,GAAcjC,EAAMgC,CAAW,EAC/B,MACF,CAGA,MAAME,EAASX,EAAO,QAAQ,8BAA8B,EAC5D,GAAIW,EAAQ,CACV,MAAMlC,EAAOkC,EAAO,aAAa,WAAW,EAC5C,GAAI,CAAClC,EACH,OAGFjC,EAAM,eAAA,EACNoE,GAAWnC,CAAI,CACjB,CACF,CAEA,SAASb,GAAcpB,EAAO,SAC5B,MAAMwD,EAASxD,EAAM,OACrB,GAAMwD,aAAkB,YAIxB,KACGxD,EAAM,MAAQ,SAAWA,EAAM,MAAQ,MACxCwD,EAAO,aAAa,aAAa,GACjCA,EAAO,aAAa,aAAa,IAAM,SACvC,CACA,MAAMvB,EAAOuB,EAAO,aAAa,WAAW,EACtCS,GAAcvH,EAAA8G,EAAO,aAAa,UAAU,IAA9B,KAAA9G,EAAmC,GACvD,GAAI,CAACuF,EACH,OAEFjC,EAAM,eAAA,EACNA,EAAM,gBAAA,EACNkE,GAAcjC,EAAMgC,CAAW,EAC/B,MACF,CAEA,IACGjE,EAAM,MAAQ,SAAWA,EAAM,MAAQ,MACxCwD,EAAO,aAAa,aAAa,GACjCA,EAAO,aAAa,aAAa,IAAM,aACvC,CACA,MAAMvB,EAAOuB,EAAO,aAAa,WAAW,EACtCG,EAAUH,EAAO,aAAa,cAAc,EAC5CI,GAAOhH,EAAA4G,EAAO,aAAa,WAAW,IAA/B,KAAA5G,EAAoC,SACjD,GAAI,CAACqF,GAAQ,CAAC0B,EACZ,OAEF3D,EAAM,eAAA,EACNA,EAAM,gBAAA,EACN8D,GAAiB7B,EAAM0B,EAASC,CAAI,CACtC,EACF,CAEA,SAASQ,GAAWnC,EAAM,CACxB,GAAKA,EAIL,IAAIoC,GAAoBpC,CAAI,EAAG,CAC7BzF,EAAmB,IAAIyF,CAAI,EAC3BG,GAAkB,EAAK,EACvBkC,GAAUrC,CAAI,EACd,MACF,CAEI1F,EAAe,IAAI0F,CAAI,GACzB1F,EAAe,OAAO0F,CAAI,EAC1BzF,EAAmB,IAAIyF,CAAI,IAE3B1F,EAAe,IAAI0F,CAAI,EACvBzF,EAAmB,OAAOyF,CAAI,GAGhCG,GAAkB,EAAK,EACvBkC,GAAUrC,CAAI,EAChB,CAEA,SAASsC,GAAkBC,EAASC,EAAO,CACzCrI,GAAW,IAAIoI,EAASC,CAAK,CAC/B,CAEA,SAASC,IAAsB,CAC7B,GAAI,OAAOzG,GAAkB,UAAY,OAAO,SAASA,CAAa,GAAKA,EAAgB,EACzF,OAAOA,CAGX,CAEA,SAAS0G,GAAsBH,EAASC,EAAO,CAC7C,MAAMG,EAAQF,GAAA,EACd,OAAI,OAAOE,GAAU,SACZ,GAEFH,GAASG,GAAS,CAACpI,EAAmB,IAAIgI,CAAO,CAC1D,CAEA,SAASH,GAAoBG,EAAS,CACpC,MAAMC,EAAQrI,GAAW,IAAIoI,CAAO,EACpC,OAAI,OAAOC,GAAU,SACZ,GAEFE,GAAsBH,EAASC,CAAK,CAC7C,CAEA,SAASP,GAAcM,EAASP,EAAa,CAC3CtJ,EAAO,YAAY,CACjB,KAAM,gBACN,QAAS,CAAE,KAAM6J,EAAS,YAAAP,CAAA,CAAY,CACvC,CACH,CAEA,SAASH,GAAiBU,EAASb,EAASC,EAAM,CAChDjJ,EAAO,YAAY,CACjB,KAAM,mBACN,QAAS,CAAE,KAAM6J,EAAS,QAAAb,EAAS,KAAAC,CAAA,CAAK,CACzC,CACH,CAEA,SAASiB,IAAe,CACtB1H,EAAW,SAAS,cAAc,KAAK,EACvCA,EAAS,UAAY,sBAErBC,EAAS,SAAS,cAAc,KAAK,EACrCA,EAAO,UAAY,oBAEnBE,EAAa,SAAS,gBAAgB,6BAA8B,KAAK,EACzEA,EAAW,UAAU,IAAI,kBAAkB,EAC3CA,EAAW,aAAa,QAAS,4BAA4B,EAE7DD,GAAa,SAAS,cAAc,KAAK,EACzCA,GAAW,UAAY,mBAEvBD,EAAO,YAAYE,CAAU,EAC7BF,EAAO,YAAYC,EAAU,EAC7BF,EAAS,YAAYC,CAAM,EAC3BnB,EAAU,YAAYkB,CAAQ,EAE9B2H,GAAA,CACF,CAEA,SAASA,IAAkB,CACzB3H,EAAS,iBAAiB,cAAgB6C,GAAU,CAC9CA,EAAM,SAAW,IAIjBA,EAAM,kBAAkB,aAAeA,EAAM,OAAO,QAAQ,kBAAkB,IAIlFzC,GAAY,GACZI,EAAmB,GACnBH,EAAewC,EAAM,UACrBvC,GAAW,CAAE,EAAGuC,EAAM,QAAS,EAAGA,EAAM,OAAA,EACxCtC,GAAY,CAAE,EAAGoC,EAAS,EAAG,EAAGA,EAAS,CAAA,EACzC3C,EAAS,kBAAkBK,CAAY,EACvCL,EAAS,UAAU,IAAI,YAAY,GACrC,CAAC,EAEDA,EAAS,iBAAiB,cAAgB6C,GAAU,CAClD,GAAI,CAACzC,IAAayC,EAAM,YAAcxC,EACpC,OAGF,MAAMuH,EAAS/E,EAAM,QAAUvC,GAAS,EAClCuH,EAAShF,EAAM,QAAUvC,GAAS,EACxCqC,EAAS,EAAIpC,GAAU,EAAIqH,EAC3BjF,EAAS,EAAIpC,GAAU,EAAIsH,EAC3BC,GAAA,CACF,CAAC,EAED,MAAMC,EAAUlF,GAAU,CACxB,GAAI,CAACzC,IAAcyC,EAAM,YAAc,QAAaA,EAAM,YAAcxC,EACtE,OAGFD,GAAY,GACZ,MAAM4H,EAAmB3H,EAGzB,GAFAA,EAAe,KACfL,EAAS,UAAU,OAAO,YAAY,EAClC,OAAOgI,GAAqB,SAC9B,GAAI,CACFhI,EAAS,sBAAsBgI,CAAgB,CACjD,MAAQ,CAER,CAEJ,EAEAhI,EAAS,iBAAiB,YAAa+H,CAAM,EAC7C/H,EAAS,iBAAiB,gBAAiB+H,CAAM,EAEjD/H,EAAS,iBACP,QACC6C,GAAU,CACTA,EAAM,eAAA,EAEN,MAAMoF,GADYpF,EAAM,OAAS,EAAI,EAAI,IACd,EAAI,IAAM,GAC/BqF,EAAYC,GAAMxF,EAAS,MAAQsF,EAAQrF,GAAeP,EAAS,EACzE,GAAI6F,IAAcvF,EAAS,MACzB,OAGFnC,EAAmB,GACnB,MAAM4H,EAAOpI,EAAS,sBAAA,EAChBqI,EAAUxF,EAAM,QAAUuF,EAAK,KAC/BE,EAAUzF,EAAM,QAAUuF,EAAK,IAC/BG,EAAaL,EAAYvF,EAAS,MACxCA,EAAS,EAAI0F,GAAWA,EAAU1F,EAAS,GAAK4F,EAChD5F,EAAS,EAAI2F,GAAWA,EAAU3F,EAAS,GAAK4F,EAChD5F,EAAS,MAAQuF,EACjBJ,GAAA,CACF,EACA,CAAE,QAAS,EAAA,CAAM,EAGnB9H,EAAS,iBAAiB,WAAY,IAAM,CAC1CwI,GAAS,EAAI,CACf,CAAC,CACH,CAEA,SAASV,IAAW,CACb7H,IAGLA,EAAO,MAAM,UAAY,aAAa0C,EAAS,CAAC,OAAOA,EAAS,CAAC,aAAaA,EAAS,KAAK,IAC9F,CAEA,SAAS6F,GAASC,EAAOC,EAAe,CACtC,GAAI,CAACzI,GAAW,CAACwI,GAASjI,EACxB,OAGF,MAAMmI,EAAO7J,EACP8J,EAAgBD,EAAK,aAAe,EACpCE,EAAiBF,EAAK,cAAgB,EACtCG,EAAa7I,EAAO,sBAAA,EACpB8I,EAAc,OAAO,WAAW9I,EAAO,MAAM,KAAK,GAAK6I,EAAW,OAASF,EAC3EI,EAAe,OAAO,WAAW/I,EAAO,MAAM,MAAM,GAAK6I,EAAW,QAAUD,EAE9EI,EAAc,OAAOP,GAAkB,SAAWA,EAAgB7H,GAClEqI,EAAkB,OAAOD,GAAgB,SAAWA,EAAc,EACxEtG,EAAS,MAAQwF,GAAMe,EAAiBtG,GAAeP,EAAS,EAChEM,EAAS,GAAKiG,EAAgBG,GAAe,EAC7CpG,EAAS,EAAI,KAAK,IAAI,IAAKkG,EAAiBG,GAAgB,CAAC,EAC7DlB,GAAA,CACF,CAEA,SAASqB,GAAoBC,EAAc,CACzC,GAAIzI,IAAkB,OAAOyI,GAAiB,UAAYA,EAAepH,GAAkB,CACzFY,GAAgBuF,GAAMiB,EAAcnH,GAAgBD,EAAgB,EACpE,MACF,CACAY,GAAgBZ,EAClB,CAEA,SAASiD,GAAkBwD,EAAO,CAC5B,OAAO1I,IAAmB,cAI1B0I,GAAShI,IAAa,UACxB+H,GAAS,GAAM3H,EAAiB,EAChCL,EAAmB,IAGrB6I,GAAWtJ,EAAc,EAC3B,CAEA,SAASgD,GAAYuG,EAAM,CACzB,MAAM1F,EAAa0F,IAAS,OAAS,OAAS,QAC1C1F,IAAenD,IAInBA,EAAWmD,EACXlD,GAA6B,GACzB/C,aAAsB,oBACxBA,EAAW,MAAQiG,GAGrBwB,EAAA,EACIrF,IACFsJ,GAAWtJ,EAAc,EAE7B,CAEA,SAASqE,GAAiBD,EAAS,CACjC,MAAMoF,EAAOpF,GAAW,OAAOA,GAAY,UAAY,SAAUA,EAAUA,EAAQ,KAAOA,EACpF4B,EACJ5B,GAAW,OAAOA,GAAY,UAAY,OAAOA,EAAQ,YAAe,SACpEA,EAAQ,WACR,OACAqF,EACJrF,GAAW,OAAOA,GAAY,UAAY,OAAOA,EAAQ,iBAAoB,SACzEA,EAAQ,gBACR,OAEAsF,EACJtF,GAAW,OAAOA,GAAY,UAAY,kBAAmBA,EAAUA,EAAQ,cAAgB,OAiDjG,GAhDAU,GAAmB4E,CAAoB,EAEnCtF,GAAW,OAAOA,GAAY,UAAY,mBAAoBA,GAChEa,GAAoBb,EAAQ,cAAc,EAGxCA,GAAW,OAAOA,GAAY,WAC5BA,EAAQ,YACN1D,IAAa,SACfsC,GAAY,OAAO,EAErB7B,EAAuBsB,IAErB2B,EAAQ,aAAevE,IACzBD,MAAoB,IACpBH,GAAkBI,CAAiB,EAAI,CAAA,IAErCuE,EAAQ,WAAaA,EAAQ,aAC/BzC,EAAyB,GACzBlB,EAAmB,GACnBU,EAAuB,OACvBD,EAAqB,QAEnB,OAAOkD,EAAQ,gBAAmB,YACpCxD,GAAiBwD,EAAQ,gBAEvB,OAAOA,EAAQ,mBAAsB,WACvCvD,GAAmB8I,GAAWvF,EAAQ,iBAAiB,GAErD,OAAOA,EAAQ,eAAkB,SACnCrD,EAAgB,OAAO,SAASqD,EAAQ,aAAa,GAAKA,EAAQ,cAAgB,EAAI,KAAK,MAAMA,EAAQ,aAAa,EAAI,OACjHA,EAAQ,gBAAkB,OACnCrD,EAAgB,QAEd,OAAOqD,EAAQ,mBAAsB,WACvCtC,GAA4BoB,GAAsBkB,EAAQ,iBAAiB,IAI3E4B,EACFD,GAAeC,CAAU,EACfnG,IACVA,EAAoB,UACpBD,MAAoB,IACpB+B,EAAyB,IAE3BiE,GAAA,EAEI6D,EAAiB,CACnB,MAAM5F,EAAa4F,IAAoB,OAAS,OAAS,QAErD,CAAC9I,IAA8BD,IAAamD,IAC9CnD,EAAWmD,EACPjG,aAAsB,oBACxBA,EAAW,MAAQiG,GAGzB,CAEI,OAAO2F,GAAS,cAIpBxJ,GAAiBwJ,EACjBF,GAAWE,CAAI,EACjB,CAEA,SAASF,GAAWE,EAAM,CACxBI,GAAA,EACA1K,GAAW,MAAA,EACX,MAAM2K,EAAYC,GAAWN,CAAI,EACjCO,GAAkBF,EAAU,KAAK,EAE7BnJ,IAAa,OACfsJ,GAAeR,CAAI,EAEnBS,GAAYJ,CAAS,CAEzB,CAEA,SAASI,GAAYC,EAAO,CAC1BnL,EAAU,gBAAgB,QAAQ,EAClCC,EAAS,aAAa,SAAU,MAAM,EAEjCiB,GACH0H,GAAA,EAGFxH,GAAW,UAAY,GACvBC,EAAW,UAAY,GACvBnB,EAAa,MAAA,EAEbiB,EAAO,MAAM,MAAQ,GAAGgK,EAAM,KAAK,KAAK,KACxChK,EAAO,MAAM,OAAS,GAAGgK,EAAM,KAAK,MAAM,KAC1C9J,EAAW,aAAa,QAAS,OAAO8J,EAAM,KAAK,KAAK,CAAC,EACzD9J,EAAW,aAAa,SAAU,OAAO8J,EAAM,KAAK,MAAM,CAAC,EAC3D9J,EAAW,aAAa,UAAW,OAAO8J,EAAM,KAAK,KAAK,IAAIA,EAAM,KAAK,MAAM,EAAE,EAEjFA,EAAM,MAAM,QAASC,GAAS,CAC5B,MAAMC,EAAUC,GAAuBF,CAAI,EAC3ChK,GAAW,YAAYiK,CAAO,EAC9BnL,EAAa,IAAIkL,EAAK,GAAI,CAAE,KAAAA,EAAM,QAAAC,EAAS,CAC7C,CAAC,EAEDtK,GAAeoK,EAAM,MACrB/D,GAAmB,IAAI,IAAI+D,EAAM,MAAM,IAAKC,GAASA,EAAK,EAAE,CAAC,CAAC,EAC9DG,GAAUxK,EAAY,EAGtBgB,GADoBF,GAAiB2J,GAAiBL,EAAM,KAAMA,EAAM,MAAM,MAAM,EAAIP,GAAW9I,EAAgB,EAEnHuI,GAAoBtI,EAAiB,EAEjCL,EACFgI,GAAS,EAAK,GAEdA,GAAS,GAAM3H,EAAiB,EAChCL,EAAmB,IAGrBsH,GAAA,EACAyC,GAAA,EACIrJ,GACF6D,GAAe7D,CAAoB,EACnCA,EAAuB,OACvBQ,EAAyB,IAChBT,GACT,mBAAmBA,CAAkB,EACrCS,EAAyB,IAChBA,IACTqD,GAAevC,EAAS,EACxBd,EAAyB,GAE7B,CAEA,SAASqI,GAAe5F,EAAS,CAC/BpF,EAAS,gBAAgB,QAAQ,EACjCD,EAAU,aAAa,SAAU,MAAM,EAEvCC,EAAS,UAAY,GACrB,MAAMyL,EAAO,SAAS,cAAc,IAAI,EACxCA,EAAK,UAAY,kBACjBA,EAAK,aAAa,OAAQ,MAAM,EAChCA,EAAK,YAAYC,GAAgB,OAAQtG,EAAS,CAAA,EAAI,CAAC,CAAC,EACxDpF,EAAS,YAAYyL,CAAI,CAC3B,CAEA,SAASC,GAAgBC,EAAK1H,EAAO8B,EAAMwC,EAAO,CAChD,MAAMD,EAAUsD,GAAc7F,CAAI,EAC5B8F,EAAalI,GAAmB,IAAI2E,CAAO,EAC3CwD,EAAUC,GAAgB9H,CAAK,EAC/B+H,EAAcF,EAAQ,OAAS,EACrCzD,GAAkBC,EAASC,CAAK,EAChC,MAAM0D,EAAexD,GAAsBH,EAASC,CAAK,EACnD2D,EAAcF,IAAgB3L,EAAe,IAAIiI,CAAO,GAAK2D,GAE7DE,EAAW,SAAS,cAAc,IAAI,EAC5CA,EAAS,UAAY,cACrBA,EAAS,QAAQ,MAAQ,OAAO5D,CAAK,EACjCyD,GACFG,EAAS,aAAa,gBAAiB,OAAO,CAACD,CAAW,CAAC,EAEzDA,GACFC,EAAS,UAAU,IAAI,cAAc,EAGvC,MAAMC,EAAU,SAAS,cAAcJ,EAAc,SAAW,KAAK,EACrEI,EAAQ,UAAY,aAAaJ,EAAc,oBAAsB,iBAAiB,GACtFI,EAAQ,QAAQ,KAAO9D,EACvB8D,EAAQ,QAAQ,MAAQ,OAAO7D,CAAK,EAEhCyD,IACFI,EAAQ,KAAO,SACfA,EAAQ,QAAQ,OAAS,SACzBA,EAAQ,aAAa,gBAAiB,OAAO,CAACF,CAAW,CAAC,GAG5D,MAAMG,EAAU,SAAS,cAAc,MAAM,EAC7CA,EAAQ,UAAY,qBACpBA,EAAQ,aAAa,cAAe,MAAM,EAC1CD,EAAQ,YAAYC,CAAO,EAE3B,MAAMC,EAAU,SAAS,cAAc,MAAM,EACvCC,EAAY,OAAOxG,EAAKA,EAAK,OAAS,CAAC,GAAM,SACnDuG,EAAQ,UAAY,iBAAiBC,EAAY,0BAA4B,EAAE,GAC/ED,EAAQ,YAAc,OAAOX,CAAG,EAC5BY,IACFD,EAAQ,QAAQ,OAAS,SACzBA,EAAQ,QAAQ,KAAOhE,EACvBgE,EAAQ,QAAQ,IAAM,OAAOX,CAAG,EAChCW,EAAQ,aAAa,OAAQ,QAAQ,EACrCA,EAAQ,aAAa,WAAY,GAAG,EACpCA,EAAQ,MAAQ,cAElBF,EAAQ,YAAYE,CAAO,EAE3B,MAAME,EAAY,SAAS,cAAc,MAAM,EAC/CA,EAAU,UAAY,uBACtBA,EAAU,aAAa,cAAe,MAAM,EAC5CJ,EAAQ,YAAYI,CAAS,EAE7B,MAAMC,EAAaC,GAAczI,CAAK,EAChC0I,GAAeC,GAAmBH,EAAY,mBAAoB,CACtE,KAAMnE,EACN,SAAUuE,GAAuBJ,CAAU,EAC3C,cAAeZ,CAAA,CAChB,EAKD,GAJAO,EAAQ,YAAYO,EAAY,EAEhCR,EAAS,YAAYC,CAAO,EAExBJ,GAAe,CAACE,EAAa,CAC/B,MAAMY,EAAY,SAAS,cAAc,IAAI,EAC7CA,EAAU,UAAY,2BACtBA,EAAU,aAAa,OAAQ,OAAO,EACtChB,EAAQ,QAAQ,CAAC,CAACiB,GAAUC,EAAU,IAAM,CAC1C,MAAMC,GAAYlH,EAAK,OAAO,CAACgH,EAAQ,CAAC,EAClCG,GAAaC,GAAexB,EAAKoB,GAAU9I,CAAK,EACtD6I,EAAU,YAAYpB,GAAgBwB,GAAYF,GAAYC,GAAW1E,EAAQ,CAAC,CAAC,CACrF,CAAC,EACD4D,EAAS,YAAYW,CAAS,CAChC,CAEA,OAAOX,CACT,CAEA,SAAS7G,GAAmB8H,EAAS,CACnC5K,EAAkB,GAElB6K,GAAA,EACAtN,EAAU,aAAa,SAAU,MAAM,EACvCC,EAAS,aAAa,SAAU,MAAM,EACtCrB,GAAO,YAAcyO,GAAW,uCAChCzO,GAAO,gBAAgB,QAAQ,CACjC,CAEA,SAASiM,IAAa,CACpBjM,GAAO,aAAa,SAAU,MAAM,CACtC,CAEA,SAASmM,GAAW1F,EAAS,CAC3B,MAAMkI,EAAQ,CAAA,EACRC,EAAQ,CAAA,EACd,IAAIC,EAAW,EACXC,EAAU,EACd,MAAMC,EAAgB/G,GAAA,EAChBgH,EAAOD,EAAc,KACrBE,EAAOF,EAAc,KAErBG,EAAW,CAAClC,EAAK1H,EAAO8B,EAAMwC,EAAOuF,IAAa,CACtD,MAAMxF,EAAUsD,GAAc7F,CAAI,EAC5B8F,GAAalI,GAAmB,IAAI2E,CAAO,EACjDD,GAAkBC,EAASC,CAAK,EAChC,MAAMwF,EAAWhC,GAAgB9H,CAAK,EAChC+H,GAAc+B,EAAS,OAAS,EAChC9B,GAAexD,GAAsBH,EAASC,CAAK,EACnD2D,GAAcF,KAAgB3L,EAAe,IAAIiI,CAAO,GAAK2D,IAE7D+B,GAAcjI,EAAKA,EAAK,OAAS,CAAC,EAClCoF,GAAO,CACX,GAAI7C,EACJ,IAAK,OAAOqD,CAAG,EACf,WAAYe,GAAczI,CAAK,EAC/B,MAAAsE,EACA,EAAGA,EAAQoF,EACX,EAAG,EACH,YAAA3B,GACA,YAAAE,GACA,UAAW,OAAO8B,IAAgB,SAClC,cAAenC,EAAA,EAUjB,GAPAyB,EAAM,KAAKnC,EAAI,EACfqC,EAAW,KAAK,IAAIA,EAAUjF,CAAK,EAE/BuF,GACFP,EAAM,KAAK,CAAE,KAAMO,EAAU,GAAIxF,EAAS,EAGxC,CAAC0D,IAAeE,GAClB,OAAAf,GAAK,EAAIsC,EAAUG,EACnBH,GAAW,EACJtC,GAAK,EAGd,MAAM8C,GAAiBF,EAAS,IAAI,CAAC,CAAChB,GAAUC,EAAU,IACxDa,EAASV,GAAexB,EAAKoB,GAAU9I,CAAK,EAAG+I,GAAYjH,EAAK,OAAO,CAACgH,EAAQ,CAAC,EAAGxE,EAAQ,EAAGD,CAAO,CAAA,EAGxG,GAAI2F,GAAe,OAAQ,CACzB,MAAMC,GAAMD,GAAe,CAAC,EACtBE,GAASF,GAAeA,GAAe,OAAS,CAAC,EACvD9C,GAAK,EAAI+C,IAAOC,GAASD,IAAO,CAClC,MACE/C,GAAK,EAAIsC,EAAUG,EACnBH,GAAW,EAGb,OAAOtC,GAAK,CACd,EAEA0C,EAAS,OAAQzI,EAAS,CAAA,EAAI,EAAG,IAAI,EAErC,MAAMgJ,GAASZ,EAAW,GAAKG,EAAO3K,GAAiB,EACjDqL,EAAS,KAAK,IAAIZ,EAAUG,EAAMA,CAAI,EAAI5K,GAAiB,EAEjE,OAAAsK,EAAM,QAASnC,GAAS,CACtBA,EAAK,GAAKnI,GACVmI,EAAK,GAAKnI,GACV,MAAMsL,EAAS1N,EAAc,IAAIuK,EAAK,EAAE,EACpCmD,IACFnD,EAAK,EAAImD,EAAO,EAChBnD,EAAK,EAAImD,EAAO,EAEpB,CAAC,EAEM,CACL,MAAAhB,EACA,MAAAC,EACA,KAAM,CAAE,MAAAa,EAAO,OAAAC,CAAA,CAAO,CAE1B,CAEA,SAAShD,GAAuBF,EAAM,CACpC,MAAMC,EAAU,SAAS,cAAcD,EAAK,YAAc,SAAW,KAAK,EAC1EC,EAAQ,UAAY,mBAAmBD,EAAK,YAAc,0BAA4B,uBAAuB,GAC7GC,EAAQ,MAAM,KAAO,GAAGD,EAAK,CAAC,KAC9BC,EAAQ,MAAM,IAAM,GAAGD,EAAK,CAAC,KAC7BC,EAAQ,QAAQ,KAAOD,EAAK,GAExBA,EAAK,cACPC,EAAQ,KAAO,SACfA,EAAQ,QAAQ,OAAS,SACzBA,EAAQ,aAAa,gBAAiB,OAAO,CAACD,EAAK,WAAW,CAAC,EAC3DA,EAAK,aACPC,EAAQ,UAAU,IAAI,cAAc,GAIxC,MAAMiB,EAAU,SAAS,cAAc,MAAM,EAC7CA,EAAQ,UAAY,2BACpBA,EAAQ,aAAa,cAAe,MAAM,EAC1CjB,EAAQ,YAAYiB,CAAO,EAE3B,MAAMV,EAAM,SAAS,cAAc,MAAM,EACzCA,EAAI,UAAY,uBAAuBR,EAAK,UAAY,gCAAkC,EAAE,GAC5FQ,EAAI,YAAcR,EAAK,IACnBA,EAAK,YACPQ,EAAI,QAAQ,OAAS,SACrBA,EAAI,QAAQ,KAAOR,EAAK,GACxBQ,EAAI,QAAQ,IAAMR,EAAK,IACvBQ,EAAI,aAAa,OAAQ,QAAQ,EACjCA,EAAI,aAAa,WAAY,GAAG,EAChCA,EAAI,MAAQ,cAEdP,EAAQ,YAAYO,CAAG,EAEvB,MAAMa,EAAY,SAAS,cAAc,MAAM,EAC/CA,EAAU,UAAY,6BACtBA,EAAU,aAAa,cAAe,MAAM,EAC5CpB,EAAQ,YAAYoB,CAAS,EAE3B,MAAMG,EAAeC,GAAmBzB,EAAK,WAAY,yBAA0B,CACjF,KAAMA,EAAK,GACX,SAAU,CAACA,EAAK,aAAe0B,GAAuB1B,EAAK,UAAU,EACrE,cAAeA,EAAK,aAAA,CACrB,EACH,OAAAC,EAAQ,YAAYuB,CAAY,EAEhC4B,GAAmBnD,EAASD,CAAI,EAEzBC,CACT,CAEA,SAASmD,GAAmBnD,EAASD,EAAM,CACzCC,EAAQ,iBAAiB,cAAgBtH,GAAU,CAC5C0K,GAAoB1K,CAAK,IAI9B/C,EAAiB,CACf,GAAIoK,EAAK,GACT,UAAWrH,EAAM,UACjB,OAAQA,EAAM,QACd,OAAQA,EAAM,QACd,QAASqH,EAAK,EACd,QAASA,EAAK,EACd,MAAO,EAAA,EAGTC,EAAQ,kBAAkBtH,EAAM,SAAS,EACzCA,EAAM,eAAA,EACR,CAAC,EAEDsH,EAAQ,iBAAiB,cAAgBtH,GAAU,CACjD,GAAI,CAAC/C,GAAkBA,EAAe,KAAOoK,EAAK,IAAMrH,EAAM,YAAc/C,EAAe,UACzF,OAGF,MAAM8H,GAAU/E,EAAM,QAAU/C,EAAe,QAAU6C,EAAS,MAC5DkF,GAAUhF,EAAM,QAAU/C,EAAe,QAAU6C,EAAS,MAC5D6K,EAAO1N,EAAe,QAAU8H,EAChC6F,EAAO3N,EAAe,QAAU+H,EACtC6F,GAAmBxD,EAAK,GAAIsD,EAAMC,CAAI,EACtC3N,EAAe,MAAQ,GACvB+C,EAAM,eAAA,CACR,CAAC,EAED,MAAM8K,EAAW9K,GAAU+K,GAAe/K,EAAOqH,EAAMC,CAAO,EAC9DA,EAAQ,iBAAiB,YAAawD,CAAO,EAC7CxD,EAAQ,iBAAiB,gBAAiBwD,CAAO,EAEjDxD,EAAQ,iBAAiB,QAAUtH,GAAU,CACvCsH,EAAQ,QAAQ,WAAa,SAC/BtH,EAAM,eAAA,EACNA,EAAM,gBAAA,EACNsH,EAAQ,QAAQ,SAAW,GAE/B,CAAC,CACH,CAEA,SAASE,GAAUiC,EAAO,CACxBnM,EAAW,UAAY,GAEvBmM,EAAM,QAASuB,GAAS,CACtB,MAAMC,EAAS9O,EAAa,IAAI6O,EAAK,IAAI,EACnCE,EAAQ/O,EAAa,IAAI6O,EAAK,EAAE,EAEtC,GAAI,CAACC,GAAU,CAACC,EACd,OAGF,MAAMC,EAAcF,EAAO,QAAQ,YAC7BG,EAAeH,EAAO,QAAQ,aAC9BI,EAAcH,EAAM,QAAQ,aAE5BI,EAASL,EAAO,KAAK,EAAIE,EACzBI,EAASN,EAAO,KAAK,EAAIG,EAAe,EACxCI,EAAON,EAAM,KAAK,EAClBO,EAAOP,EAAM,KAAK,EAAIG,EAAc,EACpCK,EAAgB,KAAK,IAAI,IAAKF,EAAOF,GAAU,CAAC,EAEhDrJ,EAAO,SAAS,gBAAgB,6BAA8B,MAAM,EAC1EA,EAAK,aACH,IACA,KAAKqJ,CAAM,IAAIC,CAAM,MAAMD,EAASI,CAAa,IAAIH,CAAM,KAAKC,EAAOE,CAAa,IAAID,CAAI,KAAKD,CAAI,IAAIC,CAAI,EAAA,EAE/GxJ,EAAK,aAAa,QAAS,iBAAiB,EAC5C3E,EAAW,YAAY2E,CAAI,CAC7B,CAAC,CACH,CAEA,SAAS4I,GAAmBc,EAAQC,EAAGC,EAAG,CACxC,MAAMC,EAAQ3P,EAAa,IAAIwP,CAAM,EAChCG,IAILA,EAAM,KAAK,EAAIF,EACfE,EAAM,KAAK,EAAID,EACfC,EAAM,QAAQ,MAAM,KAAO,GAAGF,CAAC,KAC/BE,EAAM,QAAQ,MAAM,IAAM,GAAGD,CAAC,KAC9BrE,GAAUxK,EAAY,EACxB,CAEA,SAAS+N,GAAe/K,EAAOqH,EAAMC,EAAS,CAC5C,GACE,CAACrK,GACDA,EAAe,KAAOoK,EAAK,IAC1BrH,EAAM,YAAc,QAAaA,EAAM,YAAc/C,EAAe,UAErE,OAGF,GAAI,CACFqK,EAAQ,sBAAsBrK,EAAe,SAAS,CACxD,MAAQ,CAER,CAEA,MAAM8O,EAAQ9O,EAAe,MAC7BA,EAAiB,OAEb8O,IACFzE,EAAQ,QAAQ,SAAW,OAC3BxK,EAAc,IAAIuK,EAAK,GAAI,CAAE,EAAGA,EAAK,EAAG,EAAGA,EAAK,CAAA,CAAG,EACnD9E,EAAA,EACAvC,EAAM,eAAA,EACNA,EAAM,gBAAA,EAEV,CAEA,SAASiI,GAAgB9H,EAAO,CAC9B,OAAI,MAAM,QAAQA,CAAK,EACdA,EAAM,IAAI,CAAC+K,EAAOc,IAAU,CAACA,EAAOd,CAAK,CAAC,EAG/Ce,GAAS9L,CAAK,EACT,OAAO,QAAQA,CAAK,EAGtB,CAAA,CACT,CAEA,SAASyI,GAAczI,EAAO,CAC5B,GAAIA,IAAU,KACZ,MAAO,CAAE,MAAO,OAAQ,KAAM,OAAQ,KAAMV,EAAW,KAAM,SAAU,IAAA,EAGzE,GAAI,MAAM,QAAQU,CAAK,EACrB,MAAO,CAAE,MAAO,IAAIA,EAAM,MAAM,IAAK,KAAM,QAAS,KAAMV,EAAW,MAAO,SAAU,SAAA,EAGxF,OAAQ,OAAOU,EAAA,CACb,IAAK,SACH,MAAO,CACL,MAAO,IAAI,OAAO,KAAKA,GAAS,CAAA,CAAE,EAAE,MAAM,IAC1C,KAAM,SACN,KAAMV,EAAW,OACjB,SAAU,UAAA,EAEd,IAAK,SAAU,CACb,MAAMyM,EAAU/L,EAAM,KAAA,EACtB,OAAIgM,GAAMD,CAAO,EACR,CACL,MAAOE,GAASF,EAAS,EAAE,EAC3B,KAAM,OACN,KAAMA,EACN,MAAOA,EACP,KAAMzM,EAAW,KACjB,SAAUyM,CAAA,EAGP,CACL,MAAO,IAAIE,GAASjM,CAAK,CAAC,IAC1B,KAAM,SACN,MAAOA,EACP,KAAMV,EAAW,OACjB,SAAUU,CAAA,CAEd,CACA,IAAK,SACH,MAAO,CAAE,MAAO,OAAOA,CAAK,EAAG,KAAM,SAAU,KAAMV,EAAW,OAAQ,SAAUU,CAAA,EACpF,IAAK,UACH,MAAO,CAAE,MAAO,OAAOA,CAAK,EAAG,KAAM,UAAW,KAAMV,EAAW,QAAS,SAAUU,CAAA,EACtF,QACE,MAAO,CAAE,MAAO,GAAI,KAAM,UAAW,KAAMV,EAAW,QAAS,SAAU,EAAA,CAAG,CAElF,CAEA,SAASsJ,GAAuBJ,EAAY,CAC1C,OAAKA,EAGEjJ,GAAqB,IAAIiJ,EAAW,IAAI,EAFtC,EAGX,CAEA,SAAS0D,GAAsBC,EAAU,CACvC,GAAI,OAAOA,GAAa,YACtB,MAAO,OAGT,GAAI,CACF,OAAO,KAAK,UAAUA,CAAQ,CAChC,MAAQ,CACN,MAAO,MACT,CACF,CAEA,SAAS5B,GAAoB1K,EAAO,CAClC,GAAIA,EAAM,SAAW,EACnB,MAAO,GAGT,MAAMwD,EAASxD,EAAM,OACrB,OAAMwD,aAAkB,YAIpB,EAAAA,EAAO,QAAQ,wBAAwB,GAIvCA,EAAO,QAAQ,4BAA4B,GAI3CA,EAAO,QAAQ,yBAAyB,GAXnC,EAgBX,CAEA,SAASsF,GACPH,EACA4D,EACA/J,EAAoF,CAAA,EACpF,OACA,MAAM8E,EAAU,SAAS,cAAc,MAAM,EAC7CA,EAAQ,UAAY,GAAGiF,CAAS,IAAIA,CAAS,KAAK5D,EAAW,IAAI,GACjE,MAAM6D,EAAOC,IAAkB/P,EAAAiM,EAAW,OAAX,KAAAjM,EAAmB+C,EAAW,OAAO,EACpE6H,EAAQ,YAAYkF,CAAI,EAExB,MAAME,EAAW,SAAS,cAAc,MAAM,EAiB9C,GAhBAA,EAAS,UAAY,GAAGH,CAAS,SACjCG,EAAS,YAAc/D,EAAW,MAClCrB,EAAQ,YAAYoF,CAAQ,EAExB/D,EAAW,MACbrB,EAAQ,QAAQ,SAAW,OAC3BA,EAAQ,aAAa,YAAaqB,EAAW,IAAI,EAC7CA,EAAW,MACbrB,EAAQ,MAAQqB,EAAW,MAE3BrB,EAAQ,MAAQqB,EAAW,MAEpBA,EAAW,QACpBrB,EAAQ,MAAQqB,EAAW,OAGzBnG,EAAQ,UAAYA,EAAQ,KAAM,CACpC8E,EAAQ,QAAQ,OAAS,aACzBA,EAAQ,QAAQ,KAAO9E,EAAQ,KAC/B8E,EAAQ,QAAQ,KAAOqB,EAAW,OAAS,OAAS,SAAWA,EAAW,KAC1ErB,EAAQ,QAAQ,QAAU+E,GAAsB1D,EAAW,QAAQ,EACnErB,EAAQ,UAAU,IAAI,GAAGiF,CAAS,UAAU,EAC5CjF,EAAQ,aAAa,OAAQ,QAAQ,EACrCA,EAAQ,aAAa,WAAY,GAAG,EACpC,MAAMqF,EAAYrF,EAAQ,MACpBsF,EAAWjE,EAAW,KACxB,oDACA,uBACJrB,EAAQ,MAAQqF,EAAY,GAAGA,CAAS;AAAA,EAAKC,CAAQ,GAAKA,CAC5D,CAEA,OAAIpK,EAAQ,eAAiBA,EAAQ,MACnC8E,EAAQ,YAAYuF,GAAmBrK,EAAQ,cAAeA,EAAQ,IAAI,CAAC,EAGtE8E,CACT,CAEA,SAASmF,GAAkBpL,EAAM,OAC/B,MAAMyL,EAAO,SAAS,cAAc,MAAM,EAC1CA,EAAK,UAAY,aACjB,MAAMC,GAASrQ,EAAAkD,GAAUyB,CAAI,IAAd,KAAA3E,EAAmBkD,GAAU,QAC5CkN,EAAK,UAAYC,EACjB,MAAMC,EAAMF,EAAK,cAAc,KAAK,EACpC,OAAIE,IACFA,EAAI,aAAa,cAAe,MAAM,EACtCA,EAAI,aAAa,YAAa,OAAO,GAEhCF,CACT,CAEA,SAASD,GAAmBI,EAAkChL,EAAc,CAC1E,MAAMiL,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,KAAO,SACdA,EAAO,UAAY,sBACnBA,EAAO,QAAQ,OAAS,cACxBA,EAAO,QAAQ,KAAOjL,EACtBiL,EAAO,YAAc,SACrB,MAAMC,EAAe,CAAA,EACjBF,EAAc,OAChBE,EAAa,KAAKF,EAAc,KAAK,EAEnCA,EAAc,aAChBE,EAAa,KAAKF,EAAc,WAAW,EAE7CE,EAAa,KAAKF,EAAc,QAAU,YAAYA,EAAc,OAAO,GAAK,yBAAyB,EACzGC,EAAO,MAAQC,EAAa,KAAK;AAAA,CAAI,EACrC,MAAMC,EAAeH,EAAc,SAAW,SAC9C,OAAAC,EAAO,aAAa,aAAc,4BAA4BE,CAAY,GAAG,EACtEF,CACT,CAEA,SAASd,GAASjM,EAAOyE,EAAQ,GAAI,CACnC,OAAIzE,EAAM,QAAUyE,EACXzE,EAGF,GAAGA,EAAM,MAAM,EAAGyE,EAAQ,CAAC,CAAC,GACrC,CAEA,SAASqH,GAAS9L,EAAO,CACvB,OAAO,OAAOA,GAAU,UAAYA,IAAU,IAChD,CAEA,SAASgM,GAAMhM,EAAO,CACpB,MAAO,uBAAuB,KAAKA,CAAK,CAC1C,CAEA,SAAS2H,GAAc7F,EAAM,CAC3B,OAAO,KAAK,UAAUA,CAAI,CAC5B,CAEA,SAASwF,GAAiB4F,EAAWC,EAAW,CAC9C,MAAMC,EAAiBC,GAAeC,GAAoBH,CAAS,CAAC,EAC9DI,EAAWC,GAAgBN,CAAS,EACpCO,EAAY,OAAOF,GAAa,SAAW,KAAK,IAAIA,EAAUH,CAAc,EAAIA,EACtF,OAAOC,GAAe,KAAK,IAAII,EAAWrO,EAAsB,CAAC,CACnE,CAEA,SAASoO,GAAgBN,EAAW,SAClC,GAAI,CAACA,EACH,OAGF,MAAMtH,GAAgB5I,GAAA,YAAAA,EAAU,cAAelB,EAAU,aAAe,OAAO,YAAc,EACvF+J,GAAiB7I,GAAA,YAAAA,EAAU,eAAgBlB,EAAU,cAAgB,OAAO,aAAe,EAC3FqO,GAAQ5N,EAAA2Q,GAAA,YAAAA,EAAW,QAAX,KAAA3Q,EAAoB,EAC5B6N,GAAS3N,EAAAyQ,GAAA,YAAAA,EAAW,SAAX,KAAAzQ,EAAqB,EACpC,GAAI0N,GAAS,GAAKC,GAAU,EAC1B,OAIF,MAAMsD,EADQ,KAAK,IAAI9H,EAAgBuE,EAAOtE,EAAiBuE,CAAM,EAC9CjL,GACvB,GAAI,GAAC,OAAO,SAASuO,CAAM,GAAKA,GAAU,GAI1C,OAAOA,CACT,CAEA,SAASJ,GAAoBH,EAAW,CACtC,OAAIA,EAAY,IACP,IAELA,EAAY,KACP,IAELA,EAAY,IACP,IAELA,EAAY,IACP,IAELA,EAAY,IACP,GAEF,CACT,CAEA,SAASE,GAAerN,EAAO,CAC7B,MAAMyN,EAAY,OAAOzN,GAAU,UAAY,OAAO,SAASA,CAAK,EAAIA,EAAQ,EAChF,OAAOmF,GAAMsI,EAAWxO,GAAgBC,EAAc,CACxD,CAEA,SAASwH,GAAW1G,EAAO,CAEzB,OAAOmF,GADW,OAAOnF,GAAU,SAAWA,EAAQ,EAC9BhB,GAAkBE,EAAc,CAC1D,CAEA,SAASiG,GAAMnF,EAAO2N,EAAKC,EAAK,CAC9B,OAAO,KAAK,IAAI,KAAK,IAAI5N,EAAO2N,CAAG,EAAGC,CAAG,CAC3C,CAEA,SAAS1E,GAAe2E,EAAa/E,EAAUgF,EAAa,CAC1D,GAAI,CAAC,MAAM,QAAQA,CAAW,EAC5B,OAAO,OAAOhF,CAAQ,EAGxB,MAAMiF,EAAYC,GAAqBH,CAAW,EAC5CI,EAAU,OAAOnF,CAAQ,EACzBoF,EAAS,OAAO,UAAUD,CAAO,EAAIA,EAAU,EAAI,OAAOnF,CAAQ,EACxE,MAAO,GAAGiF,CAAS,IAAIG,CAAM,EAC/B,CAEA,SAASF,GAAqBH,EAAa,CACzC,GAAI,CAACA,GAAeA,IAAgB,OAClC,MAAO,OAGT,MAAM9B,EAAU8B,EAAY,KAAA,EAC5B,GAAI,CAAC9B,EACH,MAAO,OAGT,MAAMoC,EAAQpC,EAAQ,YAAA,EACtB,OAAIoC,EAAM,SAAS,KAAK,EACfC,GAAWD,EAAM,MAAM,EAAG,EAAE,EAAI,GAAG,EAGxCA,EAAM,SAAS,KAAK,EACfC,GAAWD,EAAM,MAAM,EAAG,EAAE,CAAC,EAGlCA,EAAM,SAAS,GAAG,EACbC,GAAWD,EAAM,MAAM,EAAG,EAAE,CAAC,EAG/BC,GAAWD,CAAK,CACzB,CAEA,SAASzN,GAAeV,EAAO,CAC7B,GAAI,OAAOA,GAAU,SACnB,OAEF,MAAM+L,EAAU/L,EAAM,KAAA,EACtB,GAAI,CAAC+L,EACH,OAEF,MAAMsC,EAAS,OAAO,SAAStC,EAAS,EAAE,EAC1C,GAAI,GAAC,OAAO,SAASsC,CAAM,GAAKA,GAAU,GAG1C,OAAOA,CACT,CAEA,SAASxN,GAAmByN,EAAOC,EAAK,CACtC,OAAID,EAAQC,EACH,CAAE,MAAOA,EAAK,IAAKD,CAAA,EAErB,CAAE,MAAAA,EAAO,IAAAC,CAAA,CAClB,CASA,SAASH,GAAWpO,EAAO,CACzB,OAAKA,EAIEA,EAAM,OAAO,CAAC,EAAE,cAAgBA,EAAM,MAAM,CAAC,EAH3C,EAIX,CAEA,SAASwO,GAAmBC,EAAU,CACpC,OAAQA,EAAA,CACN,IAAK,SACH,MAAO,SACT,IAAK,YACH,MAAO,YACT,QACE,OAAOL,GAAWK,CAAQ,CAAA,CAEhC,CAEA,SAASnO,IAAuB,CAC9B,MAAO,YAAYkO,GAAmB7P,EAAmB,CAAC,4BAC5D,CAEA,SAAS2D,GAAmBoM,EAAK,CAC/B,MAAMC,EAAS,CAAA,EACf,OAAAD,EAAI,QAAQ,CAAC1O,EAAO0H,IAAQ,CAC1BiH,EAAOjH,CAAG,EAAI1H,CAChB,CAAC,EACM2O,CACT,CAEA,SAAS7H,GAAkBuC,EAAO,CAChCtL,OAAkB,IAClBsL,EAAM,QAASnC,GAAS,WACtB,MAAM0H,EAAkB,QAAOrS,EAAA2K,EAAK,aAAL,YAAA3K,EAAiB,QAAU,SAAW2K,EAAK,WAAW,MAAQ,GACvFiF,EACJ,QAAO1P,EAAAyK,EAAK,aAAL,YAAAzK,EAAiB,WAAa,SACjCyK,EAAK,WAAW,SAChB,QAAOvF,EAAAuF,EAAK,aAAL,YAAAvF,EAAiB,WAAa,YACnC,OAAOuF,EAAK,WAAW,QAAQ,EAC/B,GACF2H,EAAO,CAAC3H,EAAK,IAAK0H,EAAiBzC,CAAQ,EAAE,OAAO,OAAO,EAAE,KAAK,GAAG,EAAE,YAAA,EAC7EpO,GAAY,IAAImJ,EAAK,GAAI,CAAE,KAAA2H,EAAM,CACnC,CAAC,EAEG7Q,KACGD,GAAY,IAAIE,GAAA,KAAAA,EAAsB,EAAE,IAC3CA,EAAqB,QAG3B,CAEA,SAASkC,GAAc2O,EAAO,CAE5B,GADA9Q,GAAqB8Q,EACjB,CAACA,EAAO,CACV5Q,EAAuB,OACvBD,EAAqB,OACrB8Q,GAAA,EACA,MACF,CAEA,MAAMnO,EAAakO,EAAM,YAAA,EACzB,IAAIE,EACJ,SAAW,CAAC5L,EAAIjC,CAAO,IAAKpD,GAC1B,GAAIoD,EAAQ,KAAK,SAASP,CAAU,EAAG,CACrCoO,EAAU5L,EACV,KACF,CAGF,GAAI,CAAC4L,EAAS,CACZD,GAAA,EACA9Q,EAAqB,OACrB,MACF,CAKA,GAHAA,EAAqB+Q,EACrB9Q,EAAuB8Q,EAEnBvR,IAAa,QAAS,CACxBsC,GAAY,OAAO,EACnB,MACF,CAEAgC,GAAeiN,CAAO,CACxB,CAEA,SAASD,IAAuB,CAC9B/S,EAAa,QAAQ,CAAC,CAAE,QAAAmL,CAAA,IAAcA,EAAQ,UAAU,OAAO,eAAe,CAAC,EAC/EpL,EAAS,iBAAiB,0BAA0B,EAAE,QAASmL,GAASA,EAAK,UAAU,OAAO,eAAe,CAAC,CAChH,CAEA,SAASK,IAAuB,CAC9BwH,GAAA,EACI,GAAC/Q,IAAsBP,IAAa,UAIpCQ,GAAsBjC,EAAa,IAAIiC,CAAkB,GAC3DjC,EAAa,IAAIiC,CAAkB,EAAE,QAAQ,UAAU,IAAI,eAAe,CAE9E,CAEA,SAAS8D,GAAeyJ,EAAQ,SAC9B,MAAMG,EAAQ3P,EAAa,IAAIwP,CAAM,EACrC,GAAI,CAACG,EACH,OAGF3P,EAAa,QAAQ,CAAC,CAAE,QAAAmL,CAAA,IAAcA,EAAQ,UAAU,OAAO,eAAe,CAAC,EAC/EwE,EAAM,QAAQ,UAAU,IAAI,eAAe,EAE3C,MAAM/F,GAAgBrJ,EAAAS,GAAA,YAAAA,EAAU,cAAV,KAAAT,EAAyB,EACzCsJ,GAAiBpJ,EAAAO,GAAA,YAAAA,EAAU,eAAV,KAAAP,EAA0B,EAC3CwS,EAAYtD,EAAM,QAAQ,aAAe,EACzCuD,EAAavD,EAAM,QAAQ,cAAgB,EAC3CwD,EAAQxP,EAAS,OAAS,EAEhCA,EAAS,EAAIiG,EAAgB,GAAK+F,EAAM,KAAK,EAAIsD,EAAY,GAAKE,EAClExP,EAAS,EAAIkG,EAAiB,GAAK8F,EAAM,KAAK,EAAIuD,EAAa,GAAKC,EACpErK,GAAA,EACA5G,EAAuB,MACzB,CAEA,SAASkR,GAActN,EAAM,CACtBA,GAGL,sBAAsB,IAAM,CAC1B,MAAMuN,EAAW,yBAAyBC,GAAUxN,CAAI,CAAC,KACnDoF,EAAOnL,EAAS,cAAcsT,CAAQ,EACtCnI,aAAgB,cAGtBA,EAAK,eAAe,CAAE,MAAO,SAAU,SAAU,SAAU,EAC3DA,EAAK,UAAU,IAAI,eAAe,EAC9B,OAAOA,EAAK,OAAU,YACxBA,EAAK,MAAM,CAAE,cAAe,EAAA,CAAM,EAEpC,WAAW,IAAMA,EAAK,UAAU,OAAO,eAAe,EAAG,GAAG,EAC9D,CAAC,CACH,CAEA,SAAS/C,GAAUrC,EAAM,CAClBA,IAGDrE,IAAa,QACf,sBAAsB,IAAMsE,GAAeD,CAAI,CAAC,EAEhDsN,GAActN,CAAI,EAEtB,CAEA,SAASf,GAAqBf,EAAOqC,EAAU,CAAE,QAAS,IAAQ,CAChE5D,EAAoB,EAAQuB,EACxBrE,cAAuB,aACzBA,GAAY,UAAU,OAAO,eAAgB8C,CAAiB,EAE5D7C,cAA4B,aAC9BA,GAAiB,aAAa,cAAe,OAAO6C,CAAiB,CAAC,EAEpE5C,aAA6B,oBAC/BA,EAAkB,aAAa,gBAAiB,OAAO,CAAC4C,CAAiB,CAAC,EAC1E5C,EAAkB,MAAQ4C,EAAoB,gBAAkB,gBAChE5C,EAAkB,aAAa,aAAc4C,EAAoB,gBAAkB,eAAe,GAEhG4D,EAAQ,UAAY,IACtBD,EAAA,CAEJ,CAEA,SAAShC,GAAgBmP,EAAY,CACnC,GAAI,EAAExU,cAAqB,aACzB,OAGF,MAAMyU,EAAY,OAAOD,GAAe,UAAYA,EAAa,CAACnR,EAClEA,EAAmBoR,EACfA,GACFzU,GAAU,gBAAgB,QAAQ,EAC9BK,aAAqB,qBACvBA,EAAU,MAAA,GAGZL,GAAU,aAAa,SAAU,MAAM,CAE3C,CAEA,SAAS8G,GAAmBM,EAAM,CAChC,GAAIA,GAAQ,OAAOA,GAAS,SAAU,CACpC5D,EAAkB,EAAQ4D,EAAK,OAC/B,MAAMsN,EAAY,OAAOtN,EAAK,WAAc,SAAWA,EAAK,UAAY,EAAI,OACtEuN,EAAU,OAAOvN,EAAK,SAAY,SAAWA,EAAK,QAAU,EAAI,OAEtE3D,EAAqBD,IADJ,OAAOkR,GAAc,UAAY,OAAOC,GAAY,UAClB,CAAE,MAAOD,EAAW,IAAKC,CAAA,EAAY,CAAA,CAC1F,MACEnR,EAAkB,GAClBC,EAAqB,CAAA,EAEvB4K,GAAA,CACF,CAEA,SAASA,IAA2B,CAClCtI,GAAA,CACF,CAEA,SAASA,IAAwB,CAC3B,EAAEtF,aAA+B,mBAAqB,EAAEC,aAA6B,oBAIrF,OAAO+C,EAAmB,OAAU,SACtChD,EAAoB,MAAQ,OAAOgD,EAAmB,KAAK,EACjDhD,EAAoB,QAAQ,QAAQ,IAC9CA,EAAoB,MAAQ,IAG1B,OAAOgD,EAAmB,KAAQ,SACpC/C,EAAkB,MAAQ,OAAO+C,EAAmB,GAAG,EAC7C/C,EAAkB,QAAQ,QAAQ,IAC5CA,EAAkB,MAAQ,IAE9B,CAEA,SAASmG,GAAkBT,EAAS,CAClC,GAAI,EAAE7F,aAA2B,mBAC/B,OAGF,MAAM+G,EAAU,MAAM,QAAQlB,GAAA,YAAAA,EAAS,OAAO,EAAIA,EAAQ,QAAU,CAAA,EAC9DwO,EAAa,OAAOxO,GAAA,YAAAA,EAAS,aAAe,SAAWA,EAAQ,WAAa,GAMlF,GALI,OAAOA,GAAA,YAAAA,EAAS,mBAAqB,WACvCxC,GAAsBwC,EAAQ,kBAEhC7F,EAAgB,UAAY,GAExB,CAAC+G,EAAQ,OAAQ,CACnB,MAAMuN,EAAc,SAAS,cAAc,QAAQ,EACnDA,EAAY,MAAQ,GACpBA,EAAY,YAAc,YAC1BtU,EAAgB,YAAYsU,CAAW,EACvCtU,EAAgB,SAAW,GAC3B,MACF,CAEA+G,EAAQ,QAASwN,GAAW,WAC1B,GAAI,CAACA,GAAU,OAAOA,GAAW,SAC/B,OAEF,MAAM1I,EAAU,SAAS,cAAc,QAAQ,EAC/CA,EAAQ,MAAQ,QAAO5K,EAAAsT,EAAO,KAAP,KAAAtT,EAAa,EAAE,EACtC4K,EAAQ,aAAcxF,GAAAlF,EAAAoT,EAAO,QAAP,KAAApT,EAAgBoT,EAAO,KAAvB,KAAAlO,EAA6B,QAC/CkO,EAAO,cACT1I,EAAQ,MAAQ0I,EAAO,aAEzBvU,EAAgB,YAAY6L,CAAO,CACrC,CAAC,EAED7L,EAAgB,SAAW,GACvBqU,IACFrU,EAAgB,MAAQqU,EAE5B,CAEA,SAASpO,IAAkB,CACpBnD,GACHgC,GAAgB,EAAI,CAExB,CAEA,SAASG,IAAoB,CAC3BpC,GAAe,MAAA,EACXjD,IACFA,EAAa,UAAY,GAE7B,CAEA,SAASoG,GAAkBwO,EAAU,CACnCvP,GAAA,EACK,MAAM,QAAQuP,CAAQ,GAI3BA,EAAS,QAASnE,GAAA,SAAU,OAAAnK,GAAemK,GAAA,YAAAA,EAAO,IAAIpP,EAAAoP,GAAA,YAAAA,EAAO,OAAP,KAAApP,EAAe,aAAaE,EAAAkP,GAAA,YAAAA,EAAO,OAAP,KAAAlP,EAAe,EAAE,EAAC,CACtG,CAEA,SAAS+E,GAAe4B,EAAI2M,EAAMlB,EAAMxM,EAAU,CAAA,EAAI,CACpD,GAAI,CAACe,EACH,OAEF,MAAM4M,EAASC,GAAsB7M,EAAI2M,CAAI,EAC7CC,EAAO,KAAO3N,EAAQ,QAAU,GAAKwM,EACrCmB,EAAO,QAAQ,UAAU,OAAO,aAAc,EAAQ3N,EAAQ,OAAQ,EACtE2N,EAAO,QAAQ,UAAYE,GAAeF,EAAO,KAAM3N,EAAQ,OAAO,EACtE8N,GAAA,EACA9P,EAAe,EAAE,CACnB,CAEA,SAASoB,GAAgB2B,EAAIgN,EAAO,CAClC,GAAI,CAAChN,GAAM,CAACgN,EACV,OAEF,MAAMJ,EAASC,GAAsB7M,EAAI,WAAW,EACpD4M,EAAO,QAAQ,UAAU,OAAO,YAAY,EAG5C,MAAMK,EADJ,OAAOL,EAAO,MAAS,UAAYA,EAAO,KAAK,KAAA,EAAO,WAAW,gBAAgB,EAC3C,GAAKA,EAAO,MAAQ,GAC5DA,EAAO,KAAOK,EAAUD,EACxBJ,EAAO,QAAQ,UAAYE,GAAeF,EAAO,IAAI,EACrDG,GAAA,EACA9P,EAAe,EAAE,CACnB,CAEA,SAASqB,GAAyB0B,EAAIyL,EAAMyB,EAAS,CACnD,GAAI,CAAClN,EACH,OAEF,MAAM4M,EAASC,GAAsB7M,EAAI,WAAW,EACpD4M,EAAO,KAAOnB,EACdmB,EAAO,QAAQ,UAAU,OAAO,YAAY,EAC5CA,EAAO,QAAQ,UAAYE,GAAerB,CAAI,EAE9C,MAAM0B,EAAWP,EAAO,QAAQ,cAAc,wBAAwB,EAKtE,GAJIO,GACFA,EAAS,OAAA,EAGPD,EAAS,CACX,MAAME,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,wBACpB,MAAMzD,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,KAAO,SACdA,EAAO,YAAc,gBACrBA,EAAO,iBAAiB,QAAS,IAAM,CACrCvS,EAAO,YAAY,CAAE,KAAM,oBAAqB,QAAS,CAAE,QAAS8V,CAAA,EAAW,CACjF,CAAC,EACDE,EAAQ,YAAYzD,CAAM,EAC1BiD,EAAO,QAAQ,YAAYQ,CAAO,CACpC,CAEAL,GAAA,CACF,CAEA,SAASF,GAAsB7M,EAAI2M,EAAM,CACvC,IAAIC,EAAS7R,GAAe,IAAIiF,CAAE,EAClC,GAAI,CAAC4M,EAAQ,CACX,MAAMS,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,8BAA8BV,CAAI,GACtD,MAAMW,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,wBACpBD,EAAQ,YAAYC,CAAO,EAC3BxV,GAAA,MAAAA,EAAc,YAAYuV,GAC1BT,EAAS,CAAE,QAASS,EAAS,QAAAC,EAAS,KAAM,EAAA,EAC5CvS,GAAe,IAAIiF,EAAI4M,CAAM,CAC/B,CACA,OAAOA,CACT,CAEA,SAASG,IAAqB,CACvBjV,GAGL,sBAAsB,IAAM,CAC1BA,EAAa,UAAYA,EAAa,YACxC,CAAC,CACH,CAEA,SAASmF,EAAewO,EAAM,CAC5B,GAAI,EAAExT,cAAsB,aAC1B,OAGF,MAAMuF,EAAa,OAAOiO,GAAS,SAAWA,EAAK,OAAS,GAO5D,GALEjO,IAAe,aACfA,IAAe,eACfA,IAAe,mBACfA,IAAe,oBAED,CACdvF,GAAW,UACT,kGACFA,GAAW,UAAU,IAAI,aAAa,EACtC,MACF,CAEAA,GAAW,YAAcwT,GAAQ,GACjCxT,GAAW,UAAU,OAAO,aAAa,CAC3C,CAEA,SAAS6U,GAAerB,EAAM8B,EAAS,SACrC,GAAIA,EACF,MAAO,iFAGT,MAAMC,EAAU5Q,GACdA,EACG,QAAQ,KAAM,OAAO,EACrB,QAAQ,KAAM,MAAM,EACpB,QAAQ,KAAM,MAAM,EAEnB6Q,EAAY,6BAClB,IAAIC,EAAY,EACZC,EAAO,GACPC,EACJ,MAAQA,EAAQH,EAAU,KAAKhC,CAAI,KAAO,MAAM,CAC9CkC,GAAQH,EAAO/B,EAAK,MAAMiC,EAAWE,EAAM,KAAK,CAAC,EACjD,MAAMC,GAAOxU,GAAAF,EAAAyU,EAAM,CAAC,IAAP,YAAAzU,EAAU,SAAV,KAAAE,EAAoB,OAC3ByU,EAAON,EAAOI,EAAM,CAAC,EAAE,MAAM,EACnCD,GAAQ,4CAA4CE,CAAI,KAAKC,CAAI,gBACjEJ,EAAYD,EAAU,SACxB,CACA,OAAAE,GAAQH,EAAO/B,EAAK,MAAMiC,CAAS,CAAC,EAC7BC,CACT,CAEA,SAASzB,GAAUtP,EAAO,CACxB,OAAI,OAAO,KAAQ,aAAe,OAAO,IAAI,QAAW,WAC/C,IAAI,OAAOA,CAAK,EAElB,OAAOA,CAAK,EAAE,QAAQ,SAAU,MAAM,CAC/C,CAEF,GAAA"}
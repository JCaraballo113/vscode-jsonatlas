(function(){"use strict";(function(){var Ot,Yt;const m=acquireVsCodeApi(),ne=document.getElementById("visualizer"),ge=document.getElementById("status"),R=document.getElementById("visualizerViewSelect"),ie=document.getElementById("layoutPresetSelect"),et=document.getElementById("visualizerSearchInput"),tt=document.getElementById("chatToggle"),He=document.getElementById("chatPanel"),nt=document.getElementById("chatClose"),it=document.getElementById("chatReset"),B=document.getElementById("chatMessages"),st=document.getElementById("chatForm"),F=document.getElementById("chatInput"),se=document.getElementById("chatStatus"),P=document.getElementById("chatModelSelect"),rt=document.getElementById("selectionLineForm"),_=document.getElementById("selectionStartInput"),D=document.getElementById("selectionEndInput"),ot=document.getElementById("selectionClearButton"),at=document.getElementById("controlDock"),ct=document.getElementById("controlDockPanel"),X=document.getElementById("controlDockToggle");if(!ne||!ge){m.postMessage({type:"ready"});return}const S=document.createElement("section");S.className="visualizer-view visualizer-graph-view",S.setAttribute("hidden","true"),ne.appendChild(S);const A=document.createElement("section");A.className="visualizer-view visualizer-tree-view",A.setAttribute("hidden","true"),ne.appendChild(A);const k=new Map,Ne=new Map,lt=new Map,ut=new Map;let O=new Set,W=new Set,x=typeof m.getState=="function"?(Ot=m.getState())!=null?Ot:{}:{},be=(Yt=x.nodePositions)!=null?Yt:{},ve=typeof x.layoutPresets=="object"&&x.layoutPresets?x.layoutPresets:{},$=new Map,p,Be=[],v,re,c,w,oe,C,ye=!1,K=null,_e={x:0,y:0},De={x:0,y:0},V=!1,E=x.viewMode==="tree"?"tree":"graph",dt=typeof x.viewMode=="string",$e=!0,ft=1,ae=1,G,we=new Map,Ve="",L,M;const ze=new Map;let q=!1,Ee=!1,U=!1,J=!1,z={},T=!!x.controlsCollapsed,j=!0,je="openai",ce="balanced",ht="balanced";const pt={compact:{gapX:210,gapY:70},balanced:{gapX:260,gapY:90},relaxed:{gapX:330,gapY:110}},Le=96,le=.4,mt=.02,gt=1.2,Ft=.9,Xt=.35,bt=2.5,H={object:"object",array:"array",string:"string",number:"number",boolean:"boolean",null:"null",link:"link",unknown:"unknown"},Wt=new Set(["string","number","boolean","null","link"]),Re=JSON.stringify([]),vt={object:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M9 5H7c-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2 1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2h2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 5h2c1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2h-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',array:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M5 7h14M5 12h14M5 17h14" stroke-width="2" stroke-linecap="round"/></svg>',string:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M9 7H7l-2 5 2 5h2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 7h2l2 5-2 5h-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',number:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M10 4v16M14 4v16M4 10h16M4 14h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',boolean:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><rect x="3" y="7" width="18" height="10" rx="5" ry="5" stroke-width="2"/><circle cx="9" cy="12" r="3.5" stroke-width="2"/></svg>',null:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="6" stroke-width="2"/><path d="M8.5 8.5 15.5 15.5" stroke-width="2" stroke-linecap="round"/></svg>',link:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M10 13a5 5 0 0 0 7.54.54l1.92-1.92a5 5 0 0 0-7.07-7.07l-1.09 1.09" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 11a5 5 0 0 0-7.54-.54l-1.92 1.92a5 5 0 0 0 7.07 7.07l1.09-1.09" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',unknown:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><circle cx="12" cy="17" r="1.5" stroke-width="2"/><path d="M12 13v-1.5a3.5 3.5 0 1 0-3.5-3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'};let ke=new Map;const f={x:0,y:0,scale:1};let Me=le;if(R instanceof HTMLSelectElement&&(R.value=E,R.addEventListener("change",e=>{const t=e.target.value==="tree"?"tree":"graph";Ce(t)})),ie instanceof HTMLSelectElement&&(ie.value=ce,ie.addEventListener("change",e=>{const t=e.target.value,n=Se(t);wt(n)})),et instanceof HTMLInputElement&&et.addEventListener("input",e=>{const t=e.target.value.trim();Pn(t)}),tt instanceof HTMLButtonElement&&tt.addEventListener("click",()=>{if(q){Ie(!1);return}if(Ie(!0),U){y("");return}Ee=!0,y(he()),m.postMessage({type:"chat:ensureKey"})}),nt instanceof HTMLButtonElement&&nt.addEventListener("click",()=>Ie(!1)),it instanceof HTMLButtonElement&&it.addEventListener("click",()=>{m.postMessage({type:"chat:reset"}),Rt()}),st instanceof HTMLFormElement&&F instanceof HTMLTextAreaElement){const e=()=>{const t=F.value.trim();if(t){if(!U){Ee=!0,y(he()),m.postMessage({type:"chat:ensureKey"});return}m.postMessage({type:"chat:send",payload:{text:t}}),F.value="",y("Waiting for response…")}};st.addEventListener("submit",t=>{t.preventDefault(),e()}),F.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),e())})}P instanceof HTMLSelectElement&&P.addEventListener("change",e=>{const t=e.target.value;t&&m.postMessage({type:"chat:setModel",payload:{modelId:t}})}),rt instanceof HTMLFormElement&&_ instanceof HTMLInputElement&&D instanceof HTMLInputElement&&rt.addEventListener("submit",e=>{e.preventDefault();const t=_t(_.value),n=_t(D.value);if(typeof t!="number"||typeof n!="number")return;const i=An(t,n);J=!0,z=i,Xe(),m.postMessage({type:"selection:applyLines",payload:{startLine:i.start,endLine:i.end}})}),ot instanceof HTMLButtonElement&&ot.addEventListener("click",()=>{_ instanceof HTMLInputElement&&(_.value=""),D instanceof HTMLInputElement&&(D.value=""),z={},J=!1,Xe(),m.postMessage({type:"selection:clear"})}),X instanceof HTMLButtonElement&&X.addEventListener("click",()=>{$t(!T)}),$t(T,{persist:!1}),ne.addEventListener("click",Jt),ne.addEventListener("keydown",Qt),window.addEventListener("message",e=>{var i,s,r;const{type:t,payload:n}=e.data||{};if(t==="render"){on(n);return}if(t==="invalid"){ln(n);return}if(t==="chat:history"){Bn(n);return}if(t==="chat:userMessage"){jt(),We(n==null?void 0:n.id,"user",(i=n==null?void 0:n.text)!=null?i:"");return}if(t==="chat:assistantStart"){jt(),We(n==null?void 0:n.id,"assistant","",{pending:!0}),y("AI is thinking...");return}if(t==="chat:assistantDelta"){_n(n==null?void 0:n.id,(s=n==null?void 0:n.text)!=null?s:"");return}if(t==="chat:assistantComplete"){Dn(n==null?void 0:n.id,(r=n==null?void 0:n.text)!=null?r:"",n==null?void 0:n.snippet);return}if(t==="chat:error"){y(n!=null?n:"AI error");return}if(t==="chat:status"){y((n==null?void 0:n.state)==="thinking"?"AI is thinking...":"");return}if(t==="chat:needsApiKey"&&y(`${he()} Use the command palette to configure it.`),t==="chat:ensureKeyResult"){U=!!(n!=null&&n.ready),U?(Ee=!1,y("")):Ee&&y(`${he()} Run “JSON Atlas: Set AI API Key”.`);return}if(t==="chat:aiStatus"){typeof(n==null?void 0:n.provider)=="string"&&(je=n.provider),U=!!(n!=null&&n.hasKey),q&&!U?y(he()):q&&y("");return}if(t==="chat:modelOptions"){Nn(n);return}if(t==="selection:update"){Vt(n);return}if(t==="visualizer:focusPath"){const o=typeof n=="string"?n:void 0;if(!o)return;if(M=o,E!=="graph"){Ce("graph");return}requestAnimationFrame(()=>{k.has(o)&&(pe(o),M=void 0)});return}if(t==="schema:pointers"){yt(n),xe();return}}),m.postMessage({type:"ready"});function yt(e){ke=new Map,!(!e||typeof e!="object")&&Object.entries(e).forEach(([t,n])=>{!n||typeof n.pointer!="string"||ke.set(t,{pointer:n.pointer,title:typeof n.title=="string"?n.title:void 0,description:typeof n.description=="string"?n.description:void 0})})}function Q(e={savePositions:!0}){e.savePositions!==!1&&p&&(be[p]=Cn($));const t=p!=null?p:"default";t&&(ve[t]=ce),x={...x,viewMode:E,nodePositions:be,controlsCollapsed:T,layoutPresets:ve},typeof m.setState=="function"&&m.setState(x)}function wt(e,t={}){const n=Se(e),i=n!==ce;if(ce=n,ie instanceof HTMLSelectElement&&(ie.value=n),t.persist!==!1){const r=p!=null?p:"default";r&&(ve[r]=n),Q({savePositions:!1})}i&&t.rerender!==!1&&(j=!0,M=Re,V=!1,xe(!0))}function Se(e){return e==="compact"||e==="relaxed"?e:"balanced"}function Kt(){var e;return(e=pt[ce])!=null?e:pt.balanced}function Gt(){const e=p!=null?p:"default",t=typeof e=="string"?ve[e]:void 0,n=Se(t!=null?t:ht);wt(n,{persist:!1,rerender:!1})}function qt(e){if(p===e)return;p&&(Q(),lt.set(p,new Set(O)),ut.set(p,new Set(W))),p=e;const t=be[e];$=new Map(t?Object.entries(t):[]);const n=lt.get(e);O=new Set(n instanceof Set?n:[]);const i=ut.get(e);W=new Set(i instanceof Set?i:[]),j=!0}function Ut(e){let t=!1;for(const n of Array.from($.keys()))e.has(n)||($.delete(n),t=!0);t&&Q()}function Jt(e){var l,h;const t=e.target;if(!(t instanceof HTMLElement))return;const n=t.closest('[data-action="open-schema"]');if(n instanceof HTMLElement){const d=n.getAttribute("data-path");if(!d)return;e.preventDefault(),e.stopPropagation(),m.postMessage({type:"schema:open",payload:{path:d}});return}const i=t.closest('[data-action="edit-value"]');if(i instanceof HTMLElement){const d=i.getAttribute("data-path"),u=i.getAttribute("data-literal"),g=(l=i.getAttribute("data-kind"))!=null?l:"string",b=i.getAttribute("data-href");if(!d||!u)return;if(b&&(e.metaKey||e.ctrlKey)){e.preventDefault(),m.postMessage({type:"openLink",payload:b});return}e.preventDefault(),e.stopPropagation(),kt(d,u,g);return}const s=t.closest('[data-open-link="true"]'),r=s instanceof HTMLAnchorElement?s.href:s==null?void 0:s.getAttribute("data-href");if(r){e.preventDefault(),m.postMessage({type:"openLink",payload:r});return}const o=t.closest('[data-action="rename"]');if(o instanceof HTMLElement){const d=o.getAttribute("data-path"),u=(h=o.getAttribute("data-key"))!=null?h:"";if(!d)return;e.preventDefault(),e.stopPropagation(),Lt(d,u);return}const a=t.closest('button[data-action="toggle"]');if(a){const d=a.getAttribute("data-path");if(!d)return;e.preventDefault(),Zt(d)}}function Qt(e){var n,i;const t=e.target;if(t instanceof HTMLElement){if((e.key==="Enter"||e.key===" ")&&t.hasAttribute("data-action")&&t.getAttribute("data-action")==="rename"){const s=t.getAttribute("data-path"),r=(n=t.getAttribute("data-key"))!=null?n:"";if(!s)return;e.preventDefault(),e.stopPropagation(),Lt(s,r);return}if((e.key==="Enter"||e.key===" ")&&t.hasAttribute("data-action")&&t.getAttribute("data-action")==="edit-value"){const s=t.getAttribute("data-path"),r=t.getAttribute("data-literal"),o=(i=t.getAttribute("data-kind"))!=null?i:"string";if(!s||!r)return;e.preventDefault(),e.stopPropagation(),kt(s,r,o)}}}function Zt(e){if(e){if(tn(e)){W.add(e),xe(!1),Dt(e);return}O.has(e)?(O.delete(e),W.add(e)):(O.add(e),W.delete(e)),xe(!1),Dt(e)}}function Et(e,t){Ne.set(e,t)}function en(){if(typeof G=="number"&&Number.isFinite(G)&&G>0)return G}function Oe(e,t){const n=en();return typeof n!="number"?!1:t>=n&&!W.has(e)}function tn(e){const t=Ne.get(e);return typeof t!="number"?!1:Oe(e,t)}function Lt(e,t){m.postMessage({type:"requestRename",payload:{path:e,currentName:t}})}function kt(e,t,n){m.postMessage({type:"requestEditValue",payload:{path:e,literal:t,kind:n}})}function nn(){c=document.createElement("div"),c.className="visualizer-viewport",w=document.createElement("div"),w.className="visualizer-canvas",C=document.createElementNS("http://www.w3.org/2000/svg","svg"),C.classList.add("visualizer-links"),C.setAttribute("xmlns","http://www.w3.org/2000/svg"),oe=document.createElement("div"),oe.className="visualizer-nodes",w.appendChild(C),w.appendChild(oe),c.appendChild(w),S.appendChild(c),sn()}function sn(){c.addEventListener("pointerdown",t=>{t.button===0&&(t.target instanceof HTMLElement&&t.target.closest(".visualizer-node")||(ye=!0,V=!0,K=t.pointerId,_e={x:t.clientX,y:t.clientY},De={x:f.x,y:f.y},c.setPointerCapture(K),c.classList.add("is-panning")))}),c.addEventListener("pointermove",t=>{if(!ye||t.pointerId!==K)return;const n=t.clientX-_e.x,i=t.clientY-_e.y;f.x=De.x+n,f.y=De.y+i,ue()});const e=t=>{if(!ye||t.pointerId!==void 0&&t.pointerId!==K)return;ye=!1;const n=K;if(K=null,c.classList.remove("is-panning"),typeof n=="number")try{c.releasePointerCapture(n)}catch{}};c.addEventListener("pointerup",e),c.addEventListener("pointercancel",e),c.addEventListener("wheel",t=>{t.preventDefault();const i=(t.deltaY<0?1:-1)>0?1.1:.9,s=de(f.scale*i,Me,bt);if(s===f.scale)return;V=!0;const r=c.getBoundingClientRect(),o=t.clientX-r.left,a=t.clientY-r.top,l=s/f.scale;f.x=o-(o-f.x)*l,f.y=a-(a-f.y)*l,f.scale=s,ue()},{passive:!1}),c.addEventListener("dblclick",()=>{Ae(!0)})}function ue(){w&&(w.style.transform=`translate(${f.x}px, ${f.y}px) scale(${f.scale})`)}function Ae(e,t){if(!w||!e&&V)return;const n=S,i=n.clientWidth||1,s=n.clientHeight||1,r=w.getBoundingClientRect(),o=Number.parseFloat(w.style.width)||r.width||i,a=Number.parseFloat(w.style.height)||r.height||s,l=typeof t=="number"?t:ae,h=typeof l=="number"?l:1;f.scale=de(h,Me,bt),f.x=(i-o)/2,f.y=Math.min(32,(s-a)/2),ue()}function rn(e){if($e&&typeof e=="number"&&e<le){Me=de(e,mt,le);return}Me=le}function xe(e){typeof re!="undefined"&&(e&&E==="graph"&&(Ae(!0,ae),V=!1),Ye(re))}function Ce(e){const t=e==="tree"?"tree":"graph";t!==E&&(E=t,dt=!0,R instanceof HTMLSelectElement&&(R.value=t),Q(),re&&Ye(re))}function on(e){const t=e&&typeof e=="object"&&"data"in e?e.data:e,n=e&&typeof e=="object"&&typeof e.documentId=="string"?e.documentId:void 0,i=e&&typeof e=="object"&&typeof e.defaultViewMode=="string"?e.defaultViewMode:void 0,s=e&&typeof e=="object"&&"selectionInfo"in e?e.selectionInfo:void 0;if(Vt(s),e&&typeof e=="object"&&"schemaPointers"in e&&yt(e.schemaPointers),e&&typeof e=="object"&&(e.focusRoot&&(E!=="graph"&&Ce("graph"),M=Re),e.resetLayout&&p&&($=new Map,be[p]={}),(e.resetView||e.focusRoot)&&(j=!0,V=!1,M=void 0,L=void 0),typeof e.graphAutoScale=="boolean"&&($e=e.graphAutoScale),typeof e.graphInitialScale=="number"&&(ft=Nt(e.graphInitialScale)),typeof e.graphMaxDepth=="number"?G=Number.isFinite(e.graphMaxDepth)&&e.graphMaxDepth>0?Math.floor(e.graphMaxDepth):void 0:e.graphMaxDepth===null&&(G=void 0),typeof e.graphLayoutPreset=="string"&&(ht=Se(e.graphLayoutPreset))),n?qt(n):p||(p="default",$=new Map,j=!0),Gt(),i){const r=i==="tree"?"tree":"graph";!dt&&E!==r&&(E=r,R instanceof HTMLSelectElement&&(R.value=r))}typeof t!="undefined"&&(re=t,Ye(t))}function Ye(e){un(),Ne.clear();const t=dn(e);In(t.nodes),E==="tree"?cn(e):an(t)}function an(e){S.removeAttribute("hidden"),A.setAttribute("hidden","true"),c||nn(),oe.innerHTML="",C.innerHTML="",k.clear(),w.style.width=`${e.size.width}px`,w.style.height=`${e.size.height}px`,C.setAttribute("width",String(e.size.width)),C.setAttribute("height",String(e.size.height)),C.setAttribute("viewBox",`0 0 ${e.size.width} ${e.size.height}`),e.nodes.forEach(n=>{const i=fn(n);oe.appendChild(i),k.set(n.id,{node:n,element:i})}),Be=e.edges,Ut(new Set(e.nodes.map(n=>n.id))),St(Be),ae=$e?Ln(e.size,e.nodes.length):Nt(ft),rn(ae),V?Ae(!1):(Ae(!0,ae),V=!1),ue(),Tn(),M?(pe(M),M=void 0,j=!1):L?(highlightGraphNode(L),j=!1):j&&(pe(Re),j=!1)}function cn(e){A.removeAttribute("hidden"),S.setAttribute("hidden","true"),A.innerHTML="";const t=document.createElement("ul");t.className="visualizer-tree",t.setAttribute("role","tree"),t.appendChild(Mt("JSON",e,[],0)),A.appendChild(t)}function Mt(e,t,n,i){const s=Tt(n),r=ke.get(s),o=At(t),a=o.length>0;Et(s,i);const l=Oe(s,i),h=a&&(O.has(s)||l),d=document.createElement("li");d.className="tree-branch",d.dataset.depth=String(i),a&&d.setAttribute("aria-expanded",String(!h)),h&&d.classList.add("is-collapsed");const u=document.createElement(a?"button":"div");u.className=`tree-node ${a?"tree-node--branch":"tree-node--leaf"}`,u.dataset.path=s,u.dataset.depth=String(i),a&&(u.type="button",u.dataset.action="toggle",u.setAttribute("aria-expanded",String(!h)));const g=document.createElement("span");g.className="tree-node__chevron",g.setAttribute("aria-hidden","true"),u.appendChild(g);const b=document.createElement("span"),N=typeof n[n.length-1]=="string";b.className=`tree-node__key${N?" tree-node__key--action":""}`,b.textContent=String(e),N&&(b.dataset.action="rename",b.dataset.path=s,b.dataset.key=String(e),b.setAttribute("role","button"),b.setAttribute("tabindex","0"),b.title="Rename key"),u.appendChild(b);const Z=document.createElement("span");Z.className="tree-node__connector",Z.setAttribute("aria-hidden","true"),u.appendChild(Z);const I=xt(t),Ue=It(I,"tree-node__value",{path:s,editable:Ct(I),schemaPointer:r});if(u.appendChild(Ue),d.appendChild(u),a&&!h){const Y=document.createElement("ul");Y.className="visualizer-tree-children",Y.setAttribute("role","group"),o.forEach(([ee,Je])=>{const Pe=n.concat([ee]),Qe=Bt(e,ee,t);Y.appendChild(Mt(Qe,Je,Pe,i+1))}),d.appendChild(Y)}return d}function ln(e){J=!1,zt(),S.setAttribute("hidden","true"),A.setAttribute("hidden","true"),ge.textContent=e||"The document contains syntax errors.",ge.removeAttribute("hidden")}function un(){ge.setAttribute("hidden","true")}function dn(e){const t=[],n=[];let i=0,s=0;const r=Kt(),o=r.gapX,a=r.gapY,l=(u,g,b,N,Z)=>{const I=Tt(b),Ue=ke.get(I);Et(I,N);const Y=At(g),ee=Y.length>0,Je=Oe(I,N),Pe=ee&&(O.has(I)||Je),Qe=b[b.length-1],te={id:I,key:String(u),descriptor:xt(g),depth:N,x:N*o,y:0,hasChildren:ee,isCollapsed:Pe,canRename:typeof Qe=="string",schemaPointer:Ue};if(t.push(te),i=Math.max(i,N),Z&&n.push({from:Z,to:I}),!ee||Pe)return te.y=s*a,s+=1,te.y;const Te=Y.map(([me,Ze])=>l(Bt(u,me,g),Ze,b.concat([me]),N+1,I));if(Te.length){const me=Te[0],Ze=Te[Te.length-1];te.y=me+(Ze-me)/2}else te.y=s*a,s+=1;return te.y};l("JSON",e,[],0,null);const h=(i+1)*o+Le*2,d=Math.max(s*a,a)+Le*2;return t.forEach(u=>{u.x+=Le,u.y+=Le;const g=$.get(u.id);g&&(u.x=g.x,u.y=g.y)}),{nodes:t,edges:n,size:{width:h,height:d}}}function fn(e){const t=document.createElement(e.hasChildren?"button":"div");t.className=`visualizer-node ${e.hasChildren?"visualizer-node--branch":"visualizer-node--leaf"}`,t.style.left=`${e.x}px`,t.style.top=`${e.y}px`,t.dataset.path=e.id,e.hasChildren&&(t.type="button",t.dataset.action="toggle",t.setAttribute("aria-expanded",String(!e.isCollapsed)),e.isCollapsed&&t.classList.add("is-collapsed"));const n=document.createElement("span");n.className="visualizer-node__chevron",n.setAttribute("aria-hidden","true"),t.appendChild(n);const i=document.createElement("span");i.className=`visualizer-node__key${e.canRename?" visualizer-node__key--action":""}`,i.textContent=e.key,e.canRename&&(i.dataset.action="rename",i.dataset.path=e.id,i.dataset.key=e.key,i.setAttribute("role","button"),i.setAttribute("tabindex","0"),i.title="Rename key"),t.appendChild(i);const s=document.createElement("span");s.className="visualizer-node__connector",s.setAttribute("aria-hidden","true"),t.appendChild(s);const r=It(e.descriptor,"visualizer-node__value",{path:e.id,editable:!e.hasChildren&&Ct(e.descriptor),schemaPointer:e.schemaPointer});return t.appendChild(r),hn(t,e),t}function hn(e,t){e.addEventListener("pointerdown",i=>{bn(i)&&(v={id:t.id,pointerId:i.pointerId,startX:i.clientX,startY:i.clientY,originX:t.x,originY:t.y,moved:!1},e.setPointerCapture(i.pointerId),i.preventDefault())}),e.addEventListener("pointermove",i=>{if(!v||v.id!==t.id||i.pointerId!==v.pointerId)return;const s=(i.clientX-v.startX)/f.scale,r=(i.clientY-v.startY)/f.scale,o=v.originX+s,a=v.originY+r;pn(t.id,o,a),v.moved=!0,i.preventDefault()});const n=i=>mn(i,t,e);e.addEventListener("pointerup",n),e.addEventListener("pointercancel",n),e.addEventListener("click",i=>{e.dataset.dragging==="true"&&(i.preventDefault(),i.stopPropagation(),e.dataset.dragging="")})}function St(e){C.innerHTML="",e.forEach(t=>{const n=k.get(t.from),i=k.get(t.to);if(!n||!i)return;const s=n.element.offsetWidth,r=n.element.offsetHeight,o=i.element.offsetHeight,a=n.node.x+s,l=n.node.y+r/2,h=i.node.x,d=i.node.y+o/2,u=Math.max(32,(h-a)/2),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",`M ${a} ${l} C ${a+u} ${l}, ${h-u} ${d}, ${h} ${d}`),g.setAttribute("class","visualizer-link"),C.appendChild(g)})}function pn(e,t,n){const i=k.get(e);i&&(i.node.x=t,i.node.y=n,i.element.style.left=`${t}px`,i.element.style.top=`${n}px`,St(Be))}function mn(e,t,n){if(!v||v.id!==t.id||e.pointerId!==void 0&&e.pointerId!==v.pointerId)return;try{n.releasePointerCapture(v.pointerId)}catch{}const i=v.moved;v=void 0,i&&(n.dataset.dragging="true",$.set(t.id,{x:t.x,y:t.y}),Q(),e.preventDefault(),e.stopPropagation())}function At(e){return Array.isArray(e)?e.map((t,n)=>[n,t]):wn(e)?Object.entries(e):[]}function xt(e){if(e===null)return{label:"null",kind:"null",icon:H.null,rawValue:null};if(Array.isArray(e))return{label:`[${e.length}]`,kind:"array",icon:H.array,rawValue:"[array]"};switch(typeof e){case"object":return{label:`{${Object.keys(e||{}).length}}`,kind:"object",icon:H.object,rawValue:"[object]"};case"string":{const t=e.trim();return En(t)?{label:Pt(t,42),kind:"link",href:t,title:t,icon:H.link,rawValue:t}:{label:`"${Pt(e)}"`,kind:"string",title:e,icon:H.string,rawValue:e}}case"number":return{label:String(e),kind:"number",icon:H.number,rawValue:e};case"boolean":return{label:String(e),kind:"boolean",icon:H.boolean,rawValue:e};default:return{label:"",kind:"unknown",icon:H.unknown,rawValue:""}}}function Ct(e){return e?Wt.has(e.kind):!1}function gn(e){if(typeof e=="undefined")return"null";try{return JSON.stringify(e)}catch{return"null"}}function bn(e){if(e.button!==0)return!1;const t=e.target;return t instanceof HTMLElement?!(t.closest('[data-action="rename"]')||t.closest('[data-action="edit-value"]')||t.closest('[data-open-link="true"]')):!0}function It(e,t,n={}){var o;const i=document.createElement("span");i.className=`${t} ${t}--${e.kind}`;const s=vn((o=e.icon)!=null?o:H.unknown);i.appendChild(s);const r=document.createElement("span");if(r.className=`${t}__text`,r.textContent=e.label,i.appendChild(r),e.href?(i.dataset.openLink="true",i.setAttribute("data-href",e.href),e.title?i.title=e.title:i.title=e.href):e.title&&(i.title=e.title),n.editable&&n.path){i.dataset.action="edit-value",i.dataset.path=n.path,i.dataset.kind=e.kind==="link"?"string":e.kind,i.dataset.literal=gn(e.rawValue),i.classList.add(`${t}--action`),i.setAttribute("role","button"),i.setAttribute("tabindex","0");const a=i.title,l=e.href?"Click to edit value. Cmd/Ctrl+Click to open link.":"Click to edit value.";i.title=a?`${a}
${l}`:l}return n.schemaPointer&&n.path&&i.appendChild(yn(n.schemaPointer,n.path)),i}function vn(e){var s;const t=document.createElement("span");t.className="value-icon";const n=(s=vt[e])!=null?s:vt.unknown;t.innerHTML=n;const i=t.querySelector("svg");return i&&(i.setAttribute("aria-hidden","true"),i.setAttribute("focusable","false")),t}function yn(e,t){const n=document.createElement("button");n.type="button",n.className="value-schema-button",n.dataset.action="open-schema",n.dataset.path=t,n.textContent="Schema";const i=[];e.title&&i.push(e.title),e.description&&i.push(e.description),i.push(e.pointer?`Pointer: ${e.pointer}`:"Go to schema definition"),n.title=i.join(`
`);const s=e.pointer||"schema";return n.setAttribute("aria-label",`Go to schema definition (${s})`),n}function Pt(e,t=28){return e.length<=t?e:`${e.slice(0,t-1)}…`}function wn(e){return typeof e=="object"&&e!==null}function En(e){return/^https?:\/\/[^\s]+$/i.test(e)}function Tt(e){return JSON.stringify(e)}function Ln(e,t){const n=Ht(Mn(t)),i=kn(e),s=typeof i=="number"?Math.min(i,n):n;return Ht(Math.max(s,Xt))}function kn(e){var a,l;if(!e)return;const t=(c==null?void 0:c.clientWidth)||S.clientWidth||window.innerWidth||1,n=(c==null?void 0:c.clientHeight)||S.clientHeight||window.innerHeight||1,i=(a=e==null?void 0:e.width)!=null?a:0,s=(l=e==null?void 0:e.height)!=null?l:0;if(i<=0||s<=0)return;const o=Math.min(t/i,n/s)*Ft;if(!(!Number.isFinite(o)||o<=0))return o}function Mn(e){return e>2e3?.35:e>1200?.45:e>800?.55:e>500?.65:e>300?.8:1}function Ht(e){const t=typeof e=="number"&&Number.isFinite(e)?e:1;return de(t,mt,gt)}function Nt(e){return de(typeof e=="number"?e:1,le,gt)}function de(e,t,n){return Math.min(Math.max(e,t),n)}function Bt(e,t,n){if(!Array.isArray(n))return String(t);const i=Sn(e),s=Number(t),r=Number.isInteger(s)?s+1:String(t);return`${i} ${r}`}function Sn(e){if(!e||e==="JSON")return"Item";const t=e.trim();if(!t)return"Item";const n=t.toLowerCase();return n.endsWith("ies")?fe(n.slice(0,-3)+"y"):n.endsWith("ses")?fe(n.slice(0,-2)):n.endsWith("s")?fe(n.slice(0,-1)):fe(n)}function _t(e){if(typeof e!="string")return;const t=e.trim();if(!t)return;const n=Number.parseInt(t,10);if(!(!Number.isFinite(n)||n<=0))return n}function An(e,t){return e>t?{start:t,end:e}:{start:e,end:t}}function fe(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function xn(e){switch(e){case"openai":return"OpenAI";case"anthropic":return"Anthropic";default:return fe(e)}}function he(){return`Set your ${xn(je)} API key to send messages.`}function Cn(e){const t={};return e.forEach((n,i)=>{t[i]=n}),t}function In(e){we=new Map,e.forEach(t=>{var r,o,a;const n=typeof((r=t.descriptor)==null?void 0:r.label)=="string"?t.descriptor.label:"",i=typeof((o=t.descriptor)==null?void 0:o.rawValue)=="string"?t.descriptor.rawValue:typeof((a=t.descriptor)==null?void 0:a.rawValue)!="undefined"?String(t.descriptor.rawValue):"",s=[t.key,n,i].filter(Boolean).join(" ").toLowerCase();we.set(t.id,{text:s})}),Ve&&(we.has(L!=null?L:"")||(L=void 0))}function Pn(e){if(Ve=e,!e){M=void 0,L=void 0,Fe();return}const t=e.toLowerCase();let n;for(const[i,s]of we)if(s.text.includes(t)){n=i;break}if(!n){Fe(),L=void 0;return}if(L=n,M=n,E!=="graph"){Ce("graph");return}pe(n)}function Fe(){k.forEach(({element:e})=>e.classList.remove("is-search-hit")),A.querySelectorAll(".tree-node.is-search-hit").forEach(e=>e.classList.remove("is-search-hit"))}function Tn(){Fe(),!(!Ve||E!=="graph")&&L&&k.has(L)&&k.get(L).element.classList.add("is-search-hit")}function pe(e){var a,l;const t=k.get(e);if(!t)return;k.forEach(({element:h})=>h.classList.remove("is-search-hit")),t.element.classList.add("is-search-hit");const n=(a=c==null?void 0:c.clientWidth)!=null?a:0,i=(l=c==null?void 0:c.clientHeight)!=null?l:0,s=t.element.offsetWidth||0,r=t.element.offsetHeight||0,o=f.scale||1;f.x=n/2-(t.node.x+s/2)*o,f.y=i/2-(t.node.y+r/2)*o,ue(),M=void 0}function Hn(e){e&&requestAnimationFrame(()=>{const t=`.tree-node[data-path="${$n(e)}"]`,n=A.querySelector(t);n instanceof HTMLElement&&(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add("is-search-hit"),typeof n.focus=="function"&&n.focus({preventScroll:!0}),setTimeout(()=>n.classList.remove("is-search-hit"),800))})}function Dt(e){e&&(E==="graph"?requestAnimationFrame(()=>pe(e)):Hn(e))}function $t(e,t={persist:!0}){T=!!e,at instanceof HTMLElement&&at.classList.toggle("is-collapsed",T),ct instanceof HTMLElement&&ct.setAttribute("aria-hidden",String(T)),X instanceof HTMLButtonElement&&(X.setAttribute("aria-expanded",String(!T)),X.title=T?"Show controls":"Hide controls",X.setAttribute("aria-label",T?"Show controls":"Hide controls")),t.persist!==!1&&Q()}function Ie(e){if(!(He instanceof HTMLElement))return;const t=typeof e=="boolean"?e:!q;q=t,t?(He.removeAttribute("hidden"),F instanceof HTMLTextAreaElement&&F.focus()):He.setAttribute("hidden","true")}function Vt(e){if(e&&typeof e=="object"){J=!!e.active;const t=typeof e.startLine=="number"?e.startLine+1:void 0,n=typeof e.endLine=="number"?e.endLine+1:void 0;z=J&&(typeof t=="number"&&typeof n=="number")?{start:t,end:n}:{}}else J=!1,z={};zt()}function zt(){Xe()}function Xe(){!(_ instanceof HTMLInputElement)||!(D instanceof HTMLInputElement)||(typeof z.start=="number"?_.value=String(z.start):_.matches(":focus")||(_.value=""),typeof z.end=="number"?D.value=String(z.end):D.matches(":focus")||(D.value=""))}function Nn(e){if(!(P instanceof HTMLSelectElement))return;const t=Array.isArray(e==null?void 0:e.options)?e.options:[],n=typeof(e==null?void 0:e.selectedId)=="string"?e.selectedId:"";if(typeof(e==null?void 0:e.selectedProvider)=="string"&&(je=e.selectedProvider),P.innerHTML="",!t.length){const i=document.createElement("option");i.value="",i.textContent="No models",P.appendChild(i),P.disabled=!0;return}t.forEach(i=>{var r,o,a;if(!i||typeof i!="object")return;const s=document.createElement("option");s.value=String((r=i.id)!=null?r:""),s.textContent=(a=(o=i.label)!=null?o:i.id)!=null?a:"Model",i.description&&(s.title=i.description),P.appendChild(s)}),P.disabled=!1,n&&(P.value=n)}function jt(){q||Ie(!0)}function Rt(){ze.clear(),B&&(B.innerHTML="")}function Bn(e){Rt(),Array.isArray(e)&&e.forEach(t=>{var n,i;return We(t==null?void 0:t.id,(n=t==null?void 0:t.role)!=null?n:"assistant",(i=t==null?void 0:t.text)!=null?i:"")})}function We(e,t,n,i={}){if(!e)return;const s=Ke(e,t);s.text=i.pending?"":n,s.element.classList.toggle("is-pending",!!i.pending),s.content.innerHTML=qe(s.text,i.pending),Ge(),y("")}function _n(e,t){if(!e||!t)return;const n=Ke(e,"assistant");n.element.classList.remove("is-pending");const s=typeof n.text=="string"&&n.text.trim().startsWith("AI is thinking")?"":n.text||"";n.text=s+t,n.content.innerHTML=qe(n.text),Ge(),y("")}function Dn(e,t,n){if(!e)return;const i=Ke(e,"assistant");i.text=t,i.element.classList.remove("is-pending"),i.content.innerHTML=qe(t);const s=i.element.querySelector(".chat-message__actions");if(s&&s.remove(),n){const r=document.createElement("div");r.className="chat-message__actions";const o=document.createElement("button");o.type="button",o.textContent="Apply snippet",o.addEventListener("click",()=>{m.postMessage({type:"chat:applySnippet",payload:{content:n}})}),r.appendChild(o),i.element.appendChild(r)}Ge()}function Ke(e,t){let n=ze.get(e);if(!n){const i=document.createElement("div");i.className=`chat-message chat-message--${t}`;const s=document.createElement("div");s.className="chat-message__content",i.appendChild(s),B==null||B.appendChild(i),n={element:i,content:s,text:""},ze.set(e,n)}return n}function Ge(){B&&requestAnimationFrame(()=>{B.scrollTop=B.scrollHeight})}function y(e){if(!(se instanceof HTMLElement))return;const t=typeof e=="string"?e.trim():"";if(t==="Thinking…"||t==="Thinking..."||t==="AI is thinking…"||t==="AI is thinking..."){se.innerHTML='AI is thinking<span class="chat-status__dots"><span>.</span><span>.</span><span>.</span></span>',se.classList.add("is-thinking");return}se.textContent=e||"",se.classList.remove("is-thinking")}function qe(e,t){var a,l;if(t)return'<span class="chat-pending-dots"><span></span><span></span><span></span></span>';const n=h=>h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=/```(\w+)?\s*([\s\S]*?)```/g;let s=0,r="",o;for(;(o=i.exec(e))!==null;){r+=n(e.slice(s,o.index));const h=(l=(a=o[1])==null?void 0:a.trim())!=null?l:"json",d=n(o[2].trim());r+=`<pre class="chat-code"><code class="lang-${h}">${d}</code></pre>`,s=i.lastIndex}return r+=n(e.slice(s)),r}function $n(e){return typeof CSS!="undefined"&&typeof CSS.escape=="function"?CSS.escape(e):String(e).replace(/["\\]/g,"\\$&")}})()})();
//# sourceMappingURL=visualizer.js.map

(function(){"use strict";(function(){var an,on;const m=acquireVsCodeApi(),se=document.getElementById("visualizer"),Ee=document.getElementById("status"),O=document.getElementById("visualizerViewSelect"),ae=document.getElementById("layoutPresetSelect"),F=document.getElementById("focusModeSelect"),oe=document.getElementById("focusModeNotice"),mt=document.getElementById("visualizerSearchInput"),bt=document.getElementById("chatToggle"),je=document.getElementById("chatPanel"),yt=document.getElementById("chatClose"),vt=document.getElementById("chatReset"),D=document.getElementById("chatMessages"),wt=document.getElementById("chatForm"),G=document.getElementById("chatInput"),ce=document.getElementById("chatStatus"),T=document.getElementById("chatModelSelect"),Et=document.getElementById("selectionLineForm"),_=document.getElementById("selectionStartInput"),$=document.getElementById("selectionEndInput"),St=document.getElementById("selectionClearButton"),Lt=document.getElementById("controlDock"),Mt=document.getElementById("controlDockPanel"),K=document.getElementById("controlDockToggle");if(!se||!Ee){m.postMessage({type:"ready"});return}const I=document.createElement("section");I.className="visualizer-view visualizer-graph-view",I.setAttribute("hidden","true"),se.appendChild(I);const S=document.createElement("section");S.className="visualizer-view visualizer-tree-view",S.setAttribute("hidden","true"),se.appendChild(S);const w=new Map,Re=new Map,At=new Map,kt=new Map;let Y=new Set,U=new Set,k=typeof m.getState=="function"?(an=m.getState())!=null?an:{}:{},Se=(on=k.nodePositions)!=null?on:{},Le=typeof k.layoutPresets=="object"&&k.layoutPresets?k.layoutPresets:{},z=new Map,p,Oe=[],v,le,c,L,ue,y,Me=!1,J=null,Fe={x:0,y:0},Ye={x:0,y:0},V=!1,M=k.viewMode==="tree"?"tree":"graph",xt=typeof k.viewMode=="string",qe=!0,Ct=1,de=1,Q,Ae=new Map,Xe="",A,x;const We=new Map;let Z=!1,ke=!1,ee=!1,te=!1,j={},H=!!k.controlsCollapsed,R=!0,Ge="openai",fe="balanced",It="balanced",P=et(typeof k.focusMode=="string"?k.focusMode:"all"),Ke=new Set,Ue=new Set,xe=new Map,Je=new Set;const Qe=new Map,Pt={compact:{gapX:210,gapY:70},balanced:{gapX:260,gapY:90},relaxed:{gapX:330,gapY:110}},Ce=96,he=.4,Tt=.02,Ht=1.2,cn=.9,ln=.35,Nt=2.5,N={object:"object",array:"array",string:"string",number:"number",boolean:"boolean",null:"null",link:"link",unknown:"unknown"},un=new Set(["string","number","boolean","null","link"]),Bt=25,Ze=JSON.stringify([]),Dt={object:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M9 5H7c-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2 1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2h2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 5h2c1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2h-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',array:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M5 7h14M5 12h14M5 17h14" stroke-width="2" stroke-linecap="round"/></svg>',string:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M9 7H7l-2 5 2 5h2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 7h2l2 5-2 5h-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',number:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M10 4v16M14 4v16M4 10h16M4 14h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',boolean:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><rect x="3" y="7" width="18" height="10" rx="5" ry="5" stroke-width="2"/><circle cx="9" cy="12" r="3.5" stroke-width="2"/></svg>',null:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="6" stroke-width="2"/><path d="M8.5 8.5 15.5 15.5" stroke-width="2" stroke-linecap="round"/></svg>',link:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M10 13a5 5 0 0 0 7.54.54l1.92-1.92a5 5 0 0 0-7.07-7.07l-1.09 1.09" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 11a5 5 0 0 0-7.54-.54l-1.92 1.92a5 5 0 0 0 7.07 7.07l1.09-1.09" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',unknown:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><circle cx="12" cy="17" r="1.5" stroke-width="2"/><path d="M12 13v-1.5a3.5 3.5 0 1 0-3.5-3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'};let Ie=new Map;const f={x:0,y:0,scale:1};let Pe=he;if(O instanceof HTMLSelectElement&&(O.value=M,O.addEventListener("change",e=>{const t=e.target.value==="tree"?"tree":"graph";_e(t)})),ae instanceof HTMLSelectElement&&(ae.value=fe,ae.addEventListener("change",e=>{const t=e.target.value,n=Ne(t);zt(n)})),F instanceof HTMLSelectElement&&(F.value=P,F.addEventListener("change",e=>{const t=et(e.target.value);fn(t)})),mt instanceof HTMLInputElement&&mt.addEventListener("input",e=>{const t=e.target.value.trim();ii(t)}),bt instanceof HTMLButtonElement&&bt.addEventListener("click",()=>{if(Z){$e(!1);return}if($e(!0),ee){E("");return}ke=!0,E(ye()),m.postMessage({type:"chat:ensureKey"})}),yt instanceof HTMLButtonElement&&yt.addEventListener("click",()=>$e(!1)),vt instanceof HTMLButtonElement&&vt.addEventListener("click",()=>{m.postMessage({type:"chat:reset"}),sn()}),wt instanceof HTMLFormElement&&G instanceof HTMLTextAreaElement){const e=()=>{const t=G.value.trim();if(t){if(!ee){ke=!0,E(ye()),m.postMessage({type:"chat:ensureKey"});return}m.postMessage({type:"chat:send",payload:{text:t}}),G.value="",E("Waiting for response…")}};wt.addEventListener("submit",t=>{t.preventDefault(),e()}),G.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),e())})}T instanceof HTMLSelectElement&&T.addEventListener("change",e=>{const t=e.target.value;t&&m.postMessage({type:"chat:setModel",payload:{modelId:t}})}),Et instanceof HTMLFormElement&&_ instanceof HTMLInputElement&&$ instanceof HTMLInputElement&&Et.addEventListener("submit",e=>{e.preventDefault();const t=Qt(_.value),n=Qt($.value);if(typeof t!="number"||typeof n!="number")return;const i=Zn(t,n);te=!0,j=i,ot(),m.postMessage({type:"selection:applyLines",payload:{startLine:i.start,endLine:i.end}})}),St instanceof HTMLButtonElement&&St.addEventListener("click",()=>{_ instanceof HTMLInputElement&&(_.value=""),$ instanceof HTMLInputElement&&($.value=""),j={},te=!1,ot(),m.postMessage({type:"selection:clear"})}),K instanceof HTMLButtonElement&&K.addEventListener("click",()=>{en(!H)}),en(H,{persist:!1}),se.addEventListener("click",Ln),se.addEventListener("keydown",Mn),window.addEventListener("message",e=>{var i,r,s;const{type:t,payload:n}=e.data||{};if(t==="render"){Tn(n);return}if(t==="invalid"){Bn(n);return}if(t==="chat:history"){oi(n);return}if(t==="chat:userMessage"){rn(),ct(n==null?void 0:n.id,"user",(i=n==null?void 0:n.text)!=null?i:"");return}if(t==="chat:assistantStart"){rn(),ct(n==null?void 0:n.id,"assistant","",{pending:!0}),E("AI is thinking...");return}if(t==="chat:assistantDelta"){ci(n==null?void 0:n.id,(r=n==null?void 0:n.text)!=null?r:"");return}if(t==="chat:assistantComplete"){li(n==null?void 0:n.id,(s=n==null?void 0:n.text)!=null?s:"",n==null?void 0:n.snippet);return}if(t==="chat:error"){E(n!=null?n:"AI error");return}if(t==="chat:status"){E((n==null?void 0:n.state)==="thinking"?"AI is thinking...":"");return}if(t==="chat:needsApiKey"&&E(`${ye()} Use the command palette to configure it.`),t==="chat:ensureKeyResult"){ee=!!(n!=null&&n.ready),ee?(ke=!1,E("")):ke&&E(`${ye()} Run “JSON Atlas: Set AI API Key”.`);return}if(t==="chat:aiStatus"){typeof(n==null?void 0:n.provider)=="string"&&(Ge=n.provider),ee=!!(n!=null&&n.hasKey),Z&&!ee?E(ye()):Z&&E("");return}if(t==="chat:modelOptions"){ai(n);return}if(t==="selection:update"){tn(n);return}if(t==="visualizer:focusPath"){const a=typeof n=="string"?n:void 0;if(!a)return;if(x=a,M!=="graph"){_e("graph");return}requestAnimationFrame(()=>{w.has(a)&&(ve(a),x=void 0)});return}if(t==="schema:pointers"){_t(n),De();return}if(t==="schema:insights"){dn(n);return}}),m.postMessage({type:"ready"});function _t(e){if(Ie=new Map,Ke=new Set,!e||typeof e!="object"){q();return}Object.entries(e).forEach(([t,n])=>{if(!n||typeof n.pointer!="string")return;const i={pointer:n.pointer,title:typeof n.title=="string"?n.title:void 0,description:typeof n.description=="string"?n.description:void 0,required:n.required===!0,deprecated:n.deprecated===!0,readOnly:n.readOnly===!0,writeOnly:n.writeOnly===!0};Ie.set(t,i),i.required&&Ke.add(t)}),pe(),q()}function dn(e){if(xe=new Map,Ue=new Set,!Array.isArray(e)){pe(),q();return}e.forEach(t=>{if(!t||typeof t!="object")return;const n=typeof t.pathKey=="string"?t.pathKey:void 0;if(!n)return;const i=t.severity==="error"?"error":"warning";xe.set(n,i),Ue.add(n)}),pe(),q()}function fn(e){const t=et(e);P!==t&&(P=t,F instanceof HTMLSelectElement&&(F.value=t),X({savePositions:!1}),q())}function et(e){return e==="required"||e==="warnings"||e==="arrays"?e:"all"}function hn(){if(P==="required")return Ke;if(P==="warnings")return Ue;if(P==="arrays")return Je}function q(){F instanceof HTMLSelectElement&&(F.value=P);const e=hn();if(P==="all"){$t(),He("");return}if(!(e&&e.size>0)){$t(),He(bn(P));return}const n=Array.from(e);He(""),w.forEach(({element:i})=>{const r=i.dataset.path,s=Te(r,e,n);i.classList.toggle("is-filter-hidden",!s)}),S.querySelectorAll(".tree-branch").forEach(i=>{const r=i.getAttribute("data-path"),s=Te(r,e,n);i.classList.toggle("is-filter-hidden",!s)}),y==null||y.querySelectorAll(".visualizer-link").forEach(i=>{const r=i.getAttribute("data-from"),s=i.getAttribute("data-to"),a=Te(r,e,n)&&Te(s,e,n);i.classList.toggle("is-filter-hidden",!a)})}function $t(){w.forEach(({element:e})=>e.classList.remove("is-filter-hidden")),S.querySelectorAll(".tree-branch").forEach(e=>e.classList.remove("is-filter-hidden")),y==null||y.querySelectorAll(".visualizer-link").forEach(e=>e.classList.remove("is-filter-hidden"))}function Te(e,t,n){return!e||t.has(e)||pn(e,t)?!0:gn(e,n)}function pn(e,t){const n=tt(e);for(;n.length;){n.pop();const i=st(n);if(t.has(i))return!0}return!1}function gn(e,t){if(!t.length)return!1;for(const n of t)if(mn(e,n))return!0;return!1}function mn(e,t){const n=tt(e),i=tt(t);if(n.length>=i.length)return!1;for(let r=0;r<n.length;r+=1)if(n[r]!==i[r])return!1;return n.length>0||e==="[]"}function tt(e){if(!e)return[];const t=Qe.get(e);if(t)return t.slice();try{const n=JSON.parse(e);if(Array.isArray(n))return Qe.set(e,n),n.slice()}catch{}return[]}function He(e){if(oe instanceof HTMLElement){if(!e){oe.textContent="",oe.setAttribute("hidden","true");return}oe.textContent=e,oe.removeAttribute("hidden")}}function bn(e){switch(e){case"required":return"No required properties detected.";case"warnings":return"No schema warnings detected.";case"arrays":return`No arrays with ≥ ${Bt} items detected.`;default:return""}}function pe(){w.forEach(({element:e})=>{const t=e.dataset.path,n=t?xe.get(t):void 0;yn(e,n)}),S.querySelectorAll(".tree-node").forEach(e=>{const t=e.getAttribute("data-path"),n=t?xe.get(t):void 0;n?(e.classList.add("has-schema-warning"),e.setAttribute("data-schema-severity",n)):(e.classList.remove("has-schema-warning"),e.removeAttribute("data-schema-severity"))})}function yn(e,t){if(e){if(!t){e.classList.remove("has-schema-warning"),e.removeAttribute("data-schema-severity");return}e.classList.add("has-schema-warning"),e.setAttribute("data-schema-severity",t)}}function X(e={savePositions:!0}){e.savePositions!==!1&&p&&(Se[p]=ti(z));const t=p!=null?p:"default";t&&(Le[t]=fe),k={...k,viewMode:M,nodePositions:Se,controlsCollapsed:H,layoutPresets:Le,focusMode:P},typeof m.setState=="function"&&m.setState(k)}function zt(e,t={}){const n=Ne(e),i=n!==fe;if(fe=n,ae instanceof HTMLSelectElement&&(ae.value=n),t.persist!==!1){const s=p!=null?p:"default";s&&(Le[s]=n),X({savePositions:!1})}i&&t.rerender!==!1&&(R=!0,x=Ze,V=!1,De(!0))}function Ne(e){return e==="compact"||e==="relaxed"?e:"balanced"}function vn(){var e;return(e=Pt[fe])!=null?e:Pt.balanced}function wn(){const e=p!=null?p:"default",t=typeof e=="string"?Le[e]:void 0,n=Ne(t!=null?t:It);zt(n,{persist:!1,rerender:!1})}function En(e){if(p===e)return;Qe.clear(),p&&(X(),At.set(p,new Set(Y)),kt.set(p,new Set(U))),p=e;const t=Se[e];z=new Map(t?Object.entries(t):[]);const n=At.get(e);Y=new Set(n instanceof Set?n:[]);const i=kt.get(e);U=new Set(i instanceof Set?i:[]),R=!0}function Sn(e){let t=!1;for(const n of Array.from(z.keys()))e.has(n)||(z.delete(n),t=!0);t&&X()}function Ln(e){var l,h;const t=e.target;if(!(t instanceof HTMLElement))return;const n=t.closest('[data-action="open-schema"]');if(n instanceof HTMLElement){const d=n.getAttribute("data-path");if(!d)return;e.preventDefault(),e.stopPropagation(),m.postMessage({type:"schema:open",payload:{path:d}});return}const i=t.closest('[data-action="edit-value"]');if(i instanceof HTMLElement){const d=i.getAttribute("data-path"),u=i.getAttribute("data-literal"),g=(l=i.getAttribute("data-kind"))!=null?l:"string",b=i.getAttribute("data-href");if(!d||!u)return;if(b&&(e.metaKey||e.ctrlKey)){e.preventDefault(),m.postMessage({type:"openLink",payload:b});return}e.preventDefault(),e.stopPropagation(),Rt(d,u,g);return}const r=t.closest('[data-open-link="true"]'),s=r instanceof HTMLAnchorElement?r.href:r==null?void 0:r.getAttribute("data-href");if(s){e.preventDefault(),m.postMessage({type:"openLink",payload:s});return}const a=t.closest('[data-action="rename"]');if(a instanceof HTMLElement){const d=a.getAttribute("data-path"),u=(h=a.getAttribute("data-key"))!=null?h:"";if(!d)return;e.preventDefault(),e.stopPropagation(),jt(d,u);return}const o=t.closest('button[data-action="toggle"]');if(o){const d=o.getAttribute("data-path");if(!d)return;e.preventDefault(),An(d)}}function Mn(e){var n,i;const t=e.target;if(t instanceof HTMLElement){if((e.key==="Enter"||e.key===" ")&&t.hasAttribute("data-action")&&t.getAttribute("data-action")==="rename"){const r=t.getAttribute("data-path"),s=(n=t.getAttribute("data-key"))!=null?n:"";if(!r)return;e.preventDefault(),e.stopPropagation(),jt(r,s);return}if((e.key==="Enter"||e.key===" ")&&t.hasAttribute("data-action")&&t.getAttribute("data-action")==="edit-value"){const r=t.getAttribute("data-path"),s=t.getAttribute("data-literal"),a=(i=t.getAttribute("data-kind"))!=null?i:"string";if(!r||!s)return;e.preventDefault(),e.stopPropagation(),Rt(r,s,a)}}}function An(e){if(e){if(xn(e)){U.add(e),De(!1),Zt(e);return}Y.has(e)?(Y.delete(e),U.add(e)):(Y.add(e),U.delete(e)),De(!1),Zt(e)}}function Vt(e,t){Re.set(e,t)}function kn(){if(typeof Q=="number"&&Number.isFinite(Q)&&Q>0)return Q}function nt(e,t){const n=kn();return typeof n!="number"?!1:t>=n&&!U.has(e)}function xn(e){const t=Re.get(e);return typeof t!="number"?!1:nt(e,t)}function jt(e,t){m.postMessage({type:"requestRename",payload:{path:e,currentName:t}})}function Rt(e,t,n){m.postMessage({type:"requestEditValue",payload:{path:e,literal:t,kind:n}})}function Cn(){c=document.createElement("div"),c.className="visualizer-viewport",L=document.createElement("div"),L.className="visualizer-canvas",y=document.createElementNS("http://www.w3.org/2000/svg","svg"),y.classList.add("visualizer-links"),y.setAttribute("xmlns","http://www.w3.org/2000/svg"),ue=document.createElement("div"),ue.className="visualizer-nodes",L.appendChild(y),L.appendChild(ue),c.appendChild(L),I.appendChild(c),In()}function In(){c.addEventListener("pointerdown",t=>{t.button===0&&(t.target instanceof HTMLElement&&t.target.closest(".visualizer-node")||(Me=!0,V=!0,J=t.pointerId,Fe={x:t.clientX,y:t.clientY},Ye={x:f.x,y:f.y},c.setPointerCapture(J),c.classList.add("is-panning")))}),c.addEventListener("pointermove",t=>{if(!Me||t.pointerId!==J)return;const n=t.clientX-Fe.x,i=t.clientY-Fe.y;f.x=Ye.x+n,f.y=Ye.y+i,ge()});const e=t=>{if(!Me||t.pointerId!==void 0&&t.pointerId!==J)return;Me=!1;const n=J;if(J=null,c.classList.remove("is-panning"),typeof n=="number")try{c.releasePointerCapture(n)}catch{}};c.addEventListener("pointerup",e),c.addEventListener("pointercancel",e),c.addEventListener("wheel",t=>{t.preventDefault();const i=(t.deltaY<0?1:-1)>0?1.1:.9,r=me(f.scale*i,Pe,Nt);if(r===f.scale)return;V=!0;const s=c.getBoundingClientRect(),a=t.clientX-s.left,o=t.clientY-s.top,l=r/f.scale;f.x=a-(a-f.x)*l,f.y=o-(o-f.y)*l,f.scale=r,ge()},{passive:!1}),c.addEventListener("dblclick",()=>{Be(!0)})}function ge(){L&&(L.style.transform=`translate(${f.x}px, ${f.y}px) scale(${f.scale})`)}function Be(e,t){if(!L||!e&&V)return;const n=I,i=n.clientWidth||1,r=n.clientHeight||1,s=L.getBoundingClientRect(),a=Number.parseFloat(L.style.width)||s.width||i,o=Number.parseFloat(L.style.height)||s.height||r,l=typeof t=="number"?t:de,h=typeof l=="number"?l:1;f.scale=me(h,Pe,Nt),f.x=(i-a)/2,f.y=Math.min(32,(r-o)/2),ge()}function Pn(e){if(qe&&typeof e=="number"&&e<he){Pe=me(e,Tt,he);return}Pe=he}function De(e){typeof le!="undefined"&&(e&&M==="graph"&&(Be(!0,de),V=!1),it(le))}function _e(e){const t=e==="tree"?"tree":"graph";t!==M&&(M=t,xt=!0,O instanceof HTMLSelectElement&&(O.value=t),X(),le&&it(le))}function Tn(e){const t=e&&typeof e=="object"&&"data"in e?e.data:e,n=e&&typeof e=="object"&&typeof e.documentId=="string"?e.documentId:void 0,i=e&&typeof e=="object"&&typeof e.defaultViewMode=="string"?e.defaultViewMode:void 0,r=e&&typeof e=="object"&&"selectionInfo"in e?e.selectionInfo:void 0;if(tn(r),e&&typeof e=="object"&&"schemaPointers"in e&&_t(e.schemaPointers),e&&typeof e=="object"&&(e.focusRoot&&(M!=="graph"&&_e("graph"),x=Ze),e.resetLayout&&p&&(z=new Map,Se[p]={}),(e.resetView||e.focusRoot)&&(R=!0,V=!1,x=void 0,A=void 0),typeof e.graphAutoScale=="boolean"&&(qe=e.graphAutoScale),typeof e.graphInitialScale=="number"&&(Ct=Ut(e.graphInitialScale)),typeof e.graphMaxDepth=="number"?Q=Number.isFinite(e.graphMaxDepth)&&e.graphMaxDepth>0?Math.floor(e.graphMaxDepth):void 0:e.graphMaxDepth===null&&(Q=void 0),typeof e.graphLayoutPreset=="string"&&(It=Ne(e.graphLayoutPreset))),n?En(n):p||(p="default",z=new Map,R=!0),wn(),i){const s=i==="tree"?"tree":"graph";!xt&&M!==s&&(M=s,O instanceof HTMLSelectElement&&(O.value=s))}typeof t!="undefined"&&(le=t,it(t))}function it(e){Dn(),Re.clear(),Je=new Set;const t=_n(e);ni(t.nodes),M==="tree"?Nn(e):Hn(t)}function Hn(e){I.removeAttribute("hidden"),S.setAttribute("hidden","true"),c||Cn(),ue.innerHTML="",y.innerHTML="",w.clear(),L.style.width=`${e.size.width}px`,L.style.height=`${e.size.height}px`,y.setAttribute("width",String(e.size.width)),y.setAttribute("height",String(e.size.height)),y.setAttribute("viewBox",`0 0 ${e.size.width} ${e.size.height}`),e.nodes.forEach(n=>{const i=$n(n);ue.appendChild(i),w.set(n.id,{node:n,element:i})}),Oe=e.edges,Sn(new Set(e.nodes.map(n=>n.id))),Ft(Oe),de=qe?Kn(e.size,e.nodes.length):Ut(Ct),Pn(de),V?Be(!1):(Be(!0,de),V=!1),ge(),ri(),x?(ve(x),x=void 0,R=!1):A?(highlightGraphNode(A),R=!1):R&&(ve(Ze),R=!1),pe(),q()}function Nn(e){S.removeAttribute("hidden"),I.setAttribute("hidden","true"),S.innerHTML="";const t=document.createElement("ul");t.className="visualizer-tree",t.setAttribute("role","tree"),t.appendChild(Ot("JSON",e,[],0)),S.appendChild(t),pe(),q()}function Ot(e,t,n,i){const r=st(n),s=Ie.get(r),a=Yt(t),o=a.length>0;Vt(r,i);const l=nt(r,i),h=o&&(Y.has(r)||l),d=document.createElement("li");d.className="tree-branch",d.dataset.path=r,d.dataset.depth=String(i),o&&d.setAttribute("aria-expanded",String(!h)),h&&d.classList.add("is-collapsed");const u=document.createElement(o?"button":"div");u.className=`tree-node ${o?"tree-node--branch":"tree-node--leaf"}`,u.dataset.path=r,u.dataset.depth=String(i),o&&(u.type="button",u.dataset.action="toggle",u.setAttribute("aria-expanded",String(!h)));const g=document.createElement("span");g.className="tree-node__chevron",g.setAttribute("aria-hidden","true"),u.appendChild(g);const b=document.createElement("span"),B=typeof n[n.length-1]=="string";b.className=`tree-node__key${B?" tree-node__key--action":""}`,b.textContent=String(e),B&&(b.dataset.action="rename",b.dataset.path=r,b.dataset.key=String(e),b.setAttribute("role","button"),b.setAttribute("tabindex","0"),b.title="Rename key"),u.appendChild(b);const ne=document.createElement("span");ne.className="tree-node__connector",ne.setAttribute("aria-hidden","true"),u.appendChild(ne);const C=qt(t),ft=Wt(C,"tree-node__value",{path:r,editable:Xt(C),schemaPointer:s});if(u.appendChild(ft),d.appendChild(u),o&&!h){const W=document.createElement("ul");W.className="visualizer-tree-children",W.setAttribute("role","group"),a.forEach(([ie,ht])=>{const ze=n.concat([ie]),pt=Jt(e,ie,t);W.appendChild(Ot(pt,ht,ze,i+1))}),d.appendChild(W)}return d}function Bn(e){te=!1,nn(),I.setAttribute("hidden","true"),S.setAttribute("hidden","true"),Ee.textContent=e||"The document contains syntax errors.",Ee.removeAttribute("hidden"),He("")}function Dn(){Ee.setAttribute("hidden","true")}function _n(e){const t=[],n=[];let i=0,r=0;const s=vn(),a=s.gapX,o=s.gapY,l=(u,g,b,B,ne)=>{const C=st(b),ft=Ie.get(C);Vt(C,B);const W=Yt(g),ie=W.length>0,ht=nt(C,B),ze=ie&&(Y.has(C)||ht),pt=b[b.length-1],re={id:C,key:String(u),descriptor:qt(g),depth:B,x:B*a,y:0,hasChildren:ie,isCollapsed:ze,canRename:typeof pt=="string",schemaPointer:ft};if(Rn(C,g),t.push(re),i=Math.max(i,B),ne&&n.push({from:ne,to:C}),!ie||ze)return re.y=r*o,r+=1,re.y;const Ve=W.map(([we,gt])=>l(Jt(u,we,g),gt,b.concat([we]),B+1,C));if(Ve.length){const we=Ve[0],gt=Ve[Ve.length-1];re.y=we+(gt-we)/2}else re.y=r*o,r+=1;return re.y};l("JSON",e,[],0,null);const h=(i+1)*a+Ce*2,d=Math.max(r*o,o)+Ce*2;return t.forEach(u=>{u.x+=Ce,u.y+=Ce;const g=z.get(u.id);g&&(u.x=g.x,u.y=g.y)}),{nodes:t,edges:n,size:{width:h,height:d}}}function $n(e){const t=document.createElement(e.hasChildren?"button":"div");t.className=`visualizer-node ${e.hasChildren?"visualizer-node--branch":"visualizer-node--leaf"}`,t.style.left=`${e.x}px`,t.style.top=`${e.y}px`,t.dataset.path=e.id,e.hasChildren&&(t.type="button",t.dataset.action="toggle",t.setAttribute("aria-expanded",String(!e.isCollapsed)),e.isCollapsed&&t.classList.add("is-collapsed"));const n=document.createElement("span");n.className="visualizer-node__chevron",n.setAttribute("aria-hidden","true"),t.appendChild(n);const i=document.createElement("span");i.className=`visualizer-node__key${e.canRename?" visualizer-node__key--action":""}`,i.textContent=e.key,e.canRename&&(i.dataset.action="rename",i.dataset.path=e.id,i.dataset.key=e.key,i.setAttribute("role","button"),i.setAttribute("tabindex","0"),i.title="Rename key"),t.appendChild(i);const r=document.createElement("span");r.className="visualizer-node__connector",r.setAttribute("aria-hidden","true"),t.appendChild(r);const s=Wt(e.descriptor,"visualizer-node__value",{path:e.id,editable:!e.hasChildren&&Xt(e.descriptor),schemaPointer:e.schemaPointer});return t.appendChild(s),zn(t,e),t}function zn(e,t){e.addEventListener("pointerdown",i=>{Fn(i)&&(v={id:t.id,pointerId:i.pointerId,startX:i.clientX,startY:i.clientY,originX:t.x,originY:t.y,moved:!1},e.setPointerCapture(i.pointerId),i.preventDefault())}),e.addEventListener("pointermove",i=>{if(!v||v.id!==t.id||i.pointerId!==v.pointerId)return;const r=(i.clientX-v.startX)/f.scale,s=(i.clientY-v.startY)/f.scale,a=v.originX+r,o=v.originY+s;Vn(t.id,a,o),v.moved=!0,i.preventDefault()});const n=i=>jn(i,t,e);e.addEventListener("pointerup",n),e.addEventListener("pointercancel",n),e.addEventListener("click",i=>{e.dataset.dragging==="true"&&(i.preventDefault(),i.stopPropagation(),e.dataset.dragging="")})}function Ft(e){y.innerHTML="",e.forEach(t=>{const n=w.get(t.from),i=w.get(t.to);if(!n||!i)return;const r=n.element.offsetWidth,s=n.element.offsetHeight,a=i.element.offsetHeight,o=n.node.x+r,l=n.node.y+s/2,h=i.node.x,d=i.node.y+a/2,u=Math.max(32,(h-o)/2),g=document.createElementNS("http://www.w3.org/2000/svg","path");g.setAttribute("d",`M ${o} ${l} C ${o+u} ${l}, ${h-u} ${d}, ${h} ${d}`),g.setAttribute("class","visualizer-link"),g.dataset.from=t.from,g.dataset.to=t.to,y.appendChild(g)})}function Vn(e,t,n){const i=w.get(e);i&&(i.node.x=t,i.node.y=n,i.element.style.left=`${t}px`,i.element.style.top=`${n}px`,Ft(Oe))}function jn(e,t,n){if(!v||v.id!==t.id||e.pointerId!==void 0&&e.pointerId!==v.pointerId)return;try{n.releasePointerCapture(v.pointerId)}catch{}const i=v.moved;v=void 0,i&&(n.dataset.dragging="true",z.set(t.id,{x:t.x,y:t.y}),X(),e.preventDefault(),e.stopPropagation())}function Yt(e){return Array.isArray(e)?e.map((t,n)=>[n,t]):Wn(e)?Object.entries(e):[]}function Rn(e,t){Array.isArray(t)&&t.length>=Bt&&Je.add(e)}function qt(e){if(e===null)return{label:"null",kind:"null",icon:N.null,rawValue:null};if(Array.isArray(e))return{label:`[${e.length}]`,kind:"array",icon:N.array,rawValue:"[array]"};switch(typeof e){case"object":return{label:`{${Object.keys(e||{}).length}}`,kind:"object",icon:N.object,rawValue:"[object]"};case"string":{const t=e.trim();return Gn(t)?{label:Gt(t,42),kind:"link",href:t,title:t,icon:N.link,rawValue:t}:{label:`"${Gt(e)}"`,kind:"string",title:e,icon:N.string,rawValue:e}}case"number":return{label:String(e),kind:"number",icon:N.number,rawValue:e};case"boolean":return{label:String(e),kind:"boolean",icon:N.boolean,rawValue:e};default:return{label:"",kind:"unknown",icon:N.unknown,rawValue:""}}}function Xt(e){return e?un.has(e.kind):!1}function On(e){if(typeof e=="undefined")return"null";try{return JSON.stringify(e)}catch{return"null"}}function Fn(e){if(e.button!==0)return!1;const t=e.target;return t instanceof HTMLElement?!(t.closest('[data-action="rename"]')||t.closest('[data-action="edit-value"]')||t.closest('[data-open-link="true"]')):!0}function Wt(e,t,n={}){var a;const i=document.createElement("span");i.className=`${t} ${t}--${e.kind}`;const r=Yn((a=e.icon)!=null?a:N.unknown);i.appendChild(r);const s=document.createElement("span");if(s.className=`${t}__text`,s.textContent=e.label,i.appendChild(s),e.href?(i.dataset.openLink="true",i.setAttribute("data-href",e.href),e.title?i.title=e.title:i.title=e.href):e.title&&(i.title=e.title),n.editable&&n.path){i.dataset.action="edit-value",i.dataset.path=n.path,i.dataset.kind=e.kind==="link"?"string":e.kind,i.dataset.literal=On(e.rawValue),i.classList.add(`${t}--action`),i.setAttribute("role","button"),i.setAttribute("tabindex","0");const o=i.title,l=e.href?"Click to edit value. Cmd/Ctrl+Click to open link.":"Click to edit value.";i.title=o?`${o}
${l}`:l}return n.schemaPointer&&Xn(i,n.schemaPointer),n.schemaPointer&&n.path&&i.appendChild(qn(n.schemaPointer,n.path)),i}function Yn(e){var r;const t=document.createElement("span");t.className="value-icon";const n=(r=Dt[e])!=null?r:Dt.unknown;t.innerHTML=n;const i=t.querySelector("svg");return i&&(i.setAttribute("aria-hidden","true"),i.setAttribute("focusable","false")),t}function qn(e,t){const n=document.createElement("button");n.type="button",n.className="value-schema-button",n.dataset.action="open-schema",n.dataset.path=t,n.textContent="Schema";const i=[];e.title&&i.push(e.title),e.description&&i.push(e.description),i.push(e.pointer?`Pointer: ${e.pointer}`:"Go to schema definition"),n.title=i.join(`
`);const r=e.pointer||"schema";return n.setAttribute("aria-label",`Go to schema definition (${r})`),n}function Xn(e,t){t&&(t.deprecated&&(e.classList.add("value--deprecated"),e.appendChild(rt("Deprecated","deprecated"))),t.readOnly&&(e.classList.add("value--readonly"),e.appendChild(rt("Read-only","readonly"))),t.writeOnly&&(e.classList.add("value--writeonly"),e.appendChild(rt("Write-only","writeonly"))))}function rt(e,t){const n=document.createElement("span");return n.className=`value-badge value-badge--${t}`,n.textContent=e,n}function Gt(e,t=28){return e.length<=t?e:`${e.slice(0,t-1)}…`}function Wn(e){return typeof e=="object"&&e!==null}function Gn(e){return/^https?:\/\/[^\s]+$/i.test(e)}function st(e){return JSON.stringify(e)}function Kn(e,t){const n=Kt(Jn(t)),i=Un(e),r=typeof i=="number"?Math.min(i,n):n;return Kt(Math.max(r,ln))}function Un(e){var o,l;if(!e)return;const t=(c==null?void 0:c.clientWidth)||I.clientWidth||window.innerWidth||1,n=(c==null?void 0:c.clientHeight)||I.clientHeight||window.innerHeight||1,i=(o=e==null?void 0:e.width)!=null?o:0,r=(l=e==null?void 0:e.height)!=null?l:0;if(i<=0||r<=0)return;const a=Math.min(t/i,n/r)*cn;if(!(!Number.isFinite(a)||a<=0))return a}function Jn(e){return e>2e3?.35:e>1200?.45:e>800?.55:e>500?.65:e>300?.8:1}function Kt(e){const t=typeof e=="number"&&Number.isFinite(e)?e:1;return me(t,Tt,Ht)}function Ut(e){return me(typeof e=="number"?e:1,he,Ht)}function me(e,t,n){return Math.min(Math.max(e,t),n)}function Jt(e,t,n){if(!Array.isArray(n))return String(t);const i=Qn(e),r=Number(t),s=Number.isInteger(r)?r+1:String(t);return`${i} ${s}`}function Qn(e){if(!e||e==="JSON")return"Item";const t=e.trim();if(!t)return"Item";const n=t.toLowerCase();return n.endsWith("ies")?be(n.slice(0,-3)+"y"):n.endsWith("ses")?be(n.slice(0,-2)):n.endsWith("s")?be(n.slice(0,-1)):be(n)}function Qt(e){if(typeof e!="string")return;const t=e.trim();if(!t)return;const n=Number.parseInt(t,10);if(!(!Number.isFinite(n)||n<=0))return n}function Zn(e,t){return e>t?{start:t,end:e}:{start:e,end:t}}function be(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function ei(e){switch(e){case"openai":return"OpenAI";case"anthropic":return"Anthropic";default:return be(e)}}function ye(){return`Set your ${ei(Ge)} API key to send messages.`}function ti(e){const t={};return e.forEach((n,i)=>{t[i]=n}),t}function ni(e){Ae=new Map,e.forEach(t=>{var s,a,o;const n=typeof((s=t.descriptor)==null?void 0:s.label)=="string"?t.descriptor.label:"",i=typeof((a=t.descriptor)==null?void 0:a.rawValue)=="string"?t.descriptor.rawValue:typeof((o=t.descriptor)==null?void 0:o.rawValue)!="undefined"?String(t.descriptor.rawValue):"",r=[t.key,n,i].filter(Boolean).join(" ").toLowerCase();Ae.set(t.id,{text:r})}),Xe&&(Ae.has(A!=null?A:"")||(A=void 0))}function ii(e){if(Xe=e,!e){x=void 0,A=void 0,at();return}const t=e.toLowerCase();let n;for(const[i,r]of Ae)if(r.text.includes(t)){n=i;break}if(!n){at(),A=void 0;return}if(A=n,x=n,M!=="graph"){_e("graph");return}ve(n)}function at(){w.forEach(({element:e})=>e.classList.remove("is-search-hit")),S.querySelectorAll(".tree-node.is-search-hit").forEach(e=>e.classList.remove("is-search-hit"))}function ri(){at(),!(!Xe||M!=="graph")&&A&&w.has(A)&&w.get(A).element.classList.add("is-search-hit")}function ve(e){var o,l;const t=w.get(e);if(!t)return;w.forEach(({element:h})=>h.classList.remove("is-search-hit")),t.element.classList.add("is-search-hit");const n=(o=c==null?void 0:c.clientWidth)!=null?o:0,i=(l=c==null?void 0:c.clientHeight)!=null?l:0,r=t.element.offsetWidth||0,s=t.element.offsetHeight||0,a=f.scale||1;f.x=n/2-(t.node.x+r/2)*a,f.y=i/2-(t.node.y+s/2)*a,ge(),x=void 0}function si(e){e&&requestAnimationFrame(()=>{const t=`.tree-node[data-path="${ui(e)}"]`,n=S.querySelector(t);n instanceof HTMLElement&&(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add("is-search-hit"),typeof n.focus=="function"&&n.focus({preventScroll:!0}),setTimeout(()=>n.classList.remove("is-search-hit"),800))})}function Zt(e){e&&(M==="graph"?requestAnimationFrame(()=>ve(e)):si(e))}function en(e,t={persist:!0}){H=!!e,Lt instanceof HTMLElement&&Lt.classList.toggle("is-collapsed",H),Mt instanceof HTMLElement&&Mt.setAttribute("aria-hidden",String(H)),K instanceof HTMLButtonElement&&(K.setAttribute("aria-expanded",String(!H)),K.title=H?"Show controls":"Hide controls",K.setAttribute("aria-label",H?"Show controls":"Hide controls")),t.persist!==!1&&X()}function $e(e){if(!(je instanceof HTMLElement))return;const t=typeof e=="boolean"?e:!Z;Z=t,t?(je.removeAttribute("hidden"),G instanceof HTMLTextAreaElement&&G.focus()):je.setAttribute("hidden","true")}function tn(e){if(e&&typeof e=="object"){te=!!e.active;const t=typeof e.startLine=="number"?e.startLine+1:void 0,n=typeof e.endLine=="number"?e.endLine+1:void 0;j=te&&(typeof t=="number"&&typeof n=="number")?{start:t,end:n}:{}}else te=!1,j={};nn()}function nn(){ot()}function ot(){!(_ instanceof HTMLInputElement)||!($ instanceof HTMLInputElement)||(typeof j.start=="number"?_.value=String(j.start):_.matches(":focus")||(_.value=""),typeof j.end=="number"?$.value=String(j.end):$.matches(":focus")||($.value=""))}function ai(e){if(!(T instanceof HTMLSelectElement))return;const t=Array.isArray(e==null?void 0:e.options)?e.options:[],n=typeof(e==null?void 0:e.selectedId)=="string"?e.selectedId:"";if(typeof(e==null?void 0:e.selectedProvider)=="string"&&(Ge=e.selectedProvider),T.innerHTML="",!t.length){const i=document.createElement("option");i.value="",i.textContent="No models",T.appendChild(i),T.disabled=!0;return}t.forEach(i=>{var s,a,o;if(!i||typeof i!="object")return;const r=document.createElement("option");r.value=String((s=i.id)!=null?s:""),r.textContent=(o=(a=i.label)!=null?a:i.id)!=null?o:"Model",i.description&&(r.title=i.description),T.appendChild(r)}),T.disabled=!1,n&&(T.value=n)}function rn(){Z||$e(!0)}function sn(){We.clear(),D&&(D.innerHTML="")}function oi(e){sn(),Array.isArray(e)&&e.forEach(t=>{var n,i;return ct(t==null?void 0:t.id,(n=t==null?void 0:t.role)!=null?n:"assistant",(i=t==null?void 0:t.text)!=null?i:"")})}function ct(e,t,n,i={}){if(!e)return;const r=lt(e,t);r.text=i.pending?"":n,r.element.classList.toggle("is-pending",!!i.pending),r.content.innerHTML=dt(r.text,i.pending),ut(),E("")}function ci(e,t){if(!e||!t)return;const n=lt(e,"assistant");n.element.classList.remove("is-pending");const r=typeof n.text=="string"&&n.text.trim().startsWith("AI is thinking")?"":n.text||"";n.text=r+t,n.content.innerHTML=dt(n.text),ut(),E("")}function li(e,t,n){if(!e)return;const i=lt(e,"assistant");i.text=t,i.element.classList.remove("is-pending"),i.content.innerHTML=dt(t);const r=i.element.querySelector(".chat-message__actions");if(r&&r.remove(),n){const s=document.createElement("div");s.className="chat-message__actions";const a=document.createElement("button");a.type="button",a.textContent="Apply snippet",a.addEventListener("click",()=>{m.postMessage({type:"chat:applySnippet",payload:{content:n}})}),s.appendChild(a),i.element.appendChild(s)}ut()}function lt(e,t){let n=We.get(e);if(!n){const i=document.createElement("div");i.className=`chat-message chat-message--${t}`;const r=document.createElement("div");r.className="chat-message__content",i.appendChild(r),D==null||D.appendChild(i),n={element:i,content:r,text:""},We.set(e,n)}return n}function ut(){D&&requestAnimationFrame(()=>{D.scrollTop=D.scrollHeight})}function E(e){if(!(ce instanceof HTMLElement))return;const t=typeof e=="string"?e.trim():"";if(t==="Thinking…"||t==="Thinking..."||t==="AI is thinking…"||t==="AI is thinking..."){ce.innerHTML='AI is thinking<span class="chat-status__dots"><span>.</span><span>.</span><span>.</span></span>',ce.classList.add("is-thinking");return}ce.textContent=e||"",ce.classList.remove("is-thinking")}function dt(e,t){var o,l;if(t)return'<span class="chat-pending-dots"><span></span><span></span><span></span></span>';const n=h=>h.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=/```(\w+)?\s*([\s\S]*?)```/g;let r=0,s="",a;for(;(a=i.exec(e))!==null;){s+=n(e.slice(r,a.index));const h=(l=(o=a[1])==null?void 0:o.trim())!=null?l:"json",d=n(a[2].trim());s+=`<pre class="chat-code"><code class="lang-${h}">${d}</code></pre>`,r=i.lastIndex}return s+=n(e.slice(r)),s}function ui(e){return typeof CSS!="undefined"&&typeof CSS.escape=="function"?CSS.escape(e):String(e).replace(/["\\]/g,"\\$&")}})()})();
//# sourceMappingURL=visualizer.js.map

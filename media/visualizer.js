(function(){"use strict";(function(){var Ht,Nt;const p=acquireVsCodeApi(),te=document.getElementById("visualizer"),fe=document.getElementById("status"),$=document.getElementById("visualizerViewSelect"),We=document.getElementById("visualizerSearchInput"),Xe=document.getElementById("chatToggle"),Me=document.getElementById("chatPanel"),Ye=document.getElementById("chatClose"),Ge=document.getElementById("chatReset"),H=document.getElementById("chatMessages"),Ke=document.getElementById("chatForm"),F=document.getElementById("chatInput"),ne=document.getElementById("chatStatus"),x=document.getElementById("chatModelSelect"),qe=document.getElementById("selectionLineForm"),N=document.getElementById("selectionStartInput"),P=document.getElementById("selectionEndInput"),Ue=document.getElementById("selectionClearButton"),Je=document.getElementById("controlDock"),Qe=document.getElementById("controlDockPanel"),W=document.getElementById("controlDockToggle");if(!te||!fe){p.postMessage({type:"ready"});return}const L=document.createElement("section");L.className="visualizer-view visualizer-graph-view",L.setAttribute("hidden","true"),te.appendChild(L);const M=document.createElement("section");M.className="visualizer-view visualizer-tree-view",M.setAttribute("hidden","true"),te.appendChild(M);const y=new Map,Ae=new Map,Ze=new Map,et=new Map;let V=new Set,X=new Set,z=typeof p.getState=="function"?(Ht=p.getState())!=null?Ht:{}:{},he=(Nt=z.nodePositions)!=null?Nt:{},D=new Map,k,Se=[],m,ie,u,w,re,A,pe=!1,Y=null,xe={x:0,y:0},Ce={x:0,y:0},G=!1,E=z.viewMode==="tree"?"tree":"graph",tt=typeof z.viewMode=="string",Ie=!0,nt=1,me=1,K,ge=new Map,Te="",v,S;const He=new Map;let q=!1,be=!1,U=!1,J=!1,_={},C=!!z.controlsCollapsed,j=!0,Ne="openai";const it=260,we=90,ve=96,se=.4,rt=.02,st=1.2,Pt=.9,Dt=.35,ot=2.5,I={object:"object",array:"array",string:"string",number:"number",boolean:"boolean",null:"null",link:"link",unknown:"unknown"},_t=new Set(["string","number","boolean","null","link"]),at=JSON.stringify([]),ct={object:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M9 5H7c-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2 1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2h2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 5h2c1.105 0 2 .895 2 2v3c0 1.105.895 2 2 2-1.105 0-2 .895-2 2v3c0 1.105-.895 2-2 2h-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',array:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M5 7h14M5 12h14M5 17h14" stroke-width="2" stroke-linecap="round"/></svg>',string:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M9 7H7l-2 5 2 5h2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M15 7h2l2 5-2 5h-2" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',number:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M10 4v16M14 4v16M4 10h16M4 14h16" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',boolean:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><rect x="3" y="7" width="18" height="10" rx="5" ry="5" stroke-width="2"/><circle cx="9" cy="12" r="3.5" stroke-width="2"/></svg>',null:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><circle cx="12" cy="12" r="6" stroke-width="2"/><path d="M8.5 8.5 15.5 15.5" stroke-width="2" stroke-linecap="round"/></svg>',link:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><path d="M10 13a5 5 0 0 0 7.54.54l1.92-1.92a5 5 0 0 0-7.07-7.07l-1.09 1.09" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M14 11a5 5 0 0 0-7.54-.54l-1.92 1.92a5 5 0 0 0 7.07 7.07l1.09-1.09" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>',unknown:'<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor"><circle cx="12" cy="17" r="1.5" stroke-width="2"/><path d="M12 13v-1.5a3.5 3.5 0 1 0-3.5-3.5" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>'},f={x:0,y:0,scale:1};let Ee=se;if($ instanceof HTMLSelectElement&&($.value=E,$.addEventListener("change",e=>{const t=e.target.value==="tree"?"tree":"graph";ye(t)})),We instanceof HTMLInputElement&&We.addEventListener("input",e=>{const t=e.target.value.trim();gn(t)}),Xe instanceof HTMLButtonElement&&Xe.addEventListener("click",()=>{if(q){ke(!1);return}if(ke(!0),U){b("");return}be=!0,b(ue()),p.postMessage({type:"chat:ensureKey"})}),Ye instanceof HTMLButtonElement&&Ye.addEventListener("click",()=>ke(!1)),Ge instanceof HTMLButtonElement&&Ge.addEventListener("click",()=>{p.postMessage({type:"chat:reset"}),Tt()}),Ke instanceof HTMLFormElement&&F instanceof HTMLTextAreaElement){const e=()=>{const t=F.value.trim();if(t){if(!U){be=!0,b(ue()),p.postMessage({type:"chat:ensureKey"});return}p.postMessage({type:"chat:send",payload:{text:t}}),F.value="",b("Waiting for response…")}};Ke.addEventListener("submit",t=>{t.preventDefault(),e()}),F.addEventListener("keydown",t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),e())})}x instanceof HTMLSelectElement&&x.addEventListener("change",e=>{const t=e.target.value;t&&p.postMessage({type:"chat:setModel",payload:{modelId:t}})}),qe instanceof HTMLFormElement&&N instanceof HTMLInputElement&&P instanceof HTMLInputElement&&qe.addEventListener("submit",e=>{e.preventDefault();const t=Mt(N.value),n=Mt(P.value);if(typeof t!="number"||typeof n!="number")return;const i=fn(t,n);J=!0,_=i,$e(),p.postMessage({type:"selection:applyLines",payload:{startLine:i.start,endLine:i.end}})}),Ue instanceof HTMLButtonElement&&Ue.addEventListener("click",()=>{N instanceof HTMLInputElement&&(N.value=""),P instanceof HTMLInputElement&&(P.value=""),_={},J=!1,$e(),p.postMessage({type:"selection:clear"})}),W instanceof HTMLButtonElement&&W.addEventListener("click",()=>{St(!C)}),St(C,{persist:!1}),te.addEventListener("click",Vt),te.addEventListener("keydown",zt),window.addEventListener("message",e=>{var i,r,s;const{type:t,payload:n}=e.data||{};if(t==="render"){Yt(n);return}if(t==="invalid"){qt(n);return}if(t==="chat:history"){En(n);return}if(t==="chat:userMessage"){It(),Ve(n==null?void 0:n.id,"user",(i=n==null?void 0:n.text)!=null?i:"");return}if(t==="chat:assistantStart"){It(),Ve(n==null?void 0:n.id,"assistant","",{pending:!0}),b("AI is thinking...");return}if(t==="chat:assistantDelta"){yn(n==null?void 0:n.id,(r=n==null?void 0:n.text)!=null?r:"");return}if(t==="chat:assistantComplete"){kn(n==null?void 0:n.id,(s=n==null?void 0:n.text)!=null?s:"",n==null?void 0:n.snippet);return}if(t==="chat:error"){b(n!=null?n:"AI error");return}if(t==="chat:status"){b((n==null?void 0:n.state)==="thinking"?"AI is thinking...":"");return}if(t==="chat:needsApiKey"&&b(`${ue()} Use the command palette to configure it.`),t==="chat:ensureKeyResult"){U=!!(n!=null&&n.ready),U?(be=!1,b("")):be&&b(`${ue()} Run “JSON Atlas: Set AI API Key”.`);return}if(t==="chat:aiStatus"){typeof(n==null?void 0:n.provider)=="string"&&(Ne=n.provider),U=!!(n!=null&&n.hasKey),q&&!U?b(ue()):q&&b("");return}if(t==="chat:modelOptions"){vn(n);return}if(t==="selection:update"){xt(n);return}if(t==="visualizer:focusPath"){const o=typeof n=="string"?n:void 0;if(!o)return;if(S=o,E!=="graph"){ye("graph");return}requestAnimationFrame(()=>{y.has(o)&&(de(o),S=void 0)});return}}),p.postMessage({type:"ready"});function oe(e={savePositions:!0}){e.savePositions!==!1&&k&&(he[k]=pn(D)),z={...z,viewMode:E,nodePositions:he,controlsCollapsed:C},typeof p.setState=="function"&&p.setState(z)}function Bt(e){if(k===e)return;k&&(oe(),Ze.set(k,new Set(V)),et.set(k,new Set(X))),k=e;const t=he[e];D=new Map(t?Object.entries(t):[]);const n=Ze.get(e);V=new Set(n instanceof Set?n:[]);const i=et.get(e);X=new Set(i instanceof Set?i:[]),j=!0}function $t(e){let t=!1;for(const n of Array.from(D.keys()))e.has(n)||(D.delete(n),t=!0);t&&oe()}function Vt(e){var l,a;const t=e.target;if(!(t instanceof HTMLElement))return;const n=t.closest('[data-action="edit-value"]');if(n instanceof HTMLElement){const c=n.getAttribute("data-path"),d=n.getAttribute("data-literal"),g=(l=n.getAttribute("data-kind"))!=null?l:"string",h=n.getAttribute("data-href");if(!c||!d)return;if(h&&(e.metaKey||e.ctrlKey)){e.preventDefault(),p.postMessage({type:"openLink",payload:h});return}e.preventDefault(),e.stopPropagation(),dt(c,d,g);return}const i=t.closest('[data-open-link="true"]'),r=i instanceof HTMLAnchorElement?i.href:i==null?void 0:i.getAttribute("data-href");if(r){e.preventDefault(),p.postMessage({type:"openLink",payload:r});return}const s=t.closest('[data-action="rename"]');if(s instanceof HTMLElement){const c=s.getAttribute("data-path"),d=(a=s.getAttribute("data-key"))!=null?a:"";if(!c)return;e.preventDefault(),e.stopPropagation(),ut(c,d);return}const o=t.closest('button[data-action="toggle"]');if(o){const c=o.getAttribute("data-path");if(!c)return;e.preventDefault(),jt(c)}}function zt(e){var n,i;const t=e.target;if(t instanceof HTMLElement){if((e.key==="Enter"||e.key===" ")&&t.hasAttribute("data-action")&&t.getAttribute("data-action")==="rename"){const r=t.getAttribute("data-path"),s=(n=t.getAttribute("data-key"))!=null?n:"";if(!r)return;e.preventDefault(),e.stopPropagation(),ut(r,s);return}if((e.key==="Enter"||e.key===" ")&&t.hasAttribute("data-action")&&t.getAttribute("data-action")==="edit-value"){const r=t.getAttribute("data-path"),s=t.getAttribute("data-literal"),o=(i=t.getAttribute("data-kind"))!=null?i:"string";if(!r||!s)return;e.preventDefault(),e.stopPropagation(),dt(r,s,o)}}}function jt(e){if(e){if(Ot(e)){X.add(e),ft(),At(e);return}V.has(e)?(V.delete(e),X.add(e)):(V.add(e),X.delete(e)),ft(),At(e)}}function lt(e,t){Ae.set(e,t)}function Rt(){if(typeof K=="number"&&Number.isFinite(K)&&K>0)return K}function Pe(e,t){const n=Rt();return typeof n!="number"?!1:t>=n&&!X.has(e)}function Ot(e){const t=Ae.get(e);return typeof t!="number"?!1:Pe(e,t)}function ut(e,t){p.postMessage({type:"requestRename",payload:{path:e,currentName:t}})}function dt(e,t,n){p.postMessage({type:"requestEditValue",payload:{path:e,literal:t,kind:n}})}function Ft(){u=document.createElement("div"),u.className="visualizer-viewport",w=document.createElement("div"),w.className="visualizer-canvas",A=document.createElementNS("http://www.w3.org/2000/svg","svg"),A.classList.add("visualizer-links"),A.setAttribute("xmlns","http://www.w3.org/2000/svg"),re=document.createElement("div"),re.className="visualizer-nodes",w.appendChild(A),w.appendChild(re),u.appendChild(w),L.appendChild(u),Wt()}function Wt(){u.addEventListener("pointerdown",t=>{t.button===0&&(t.target instanceof HTMLElement&&t.target.closest(".visualizer-node")||(pe=!0,G=!0,Y=t.pointerId,xe={x:t.clientX,y:t.clientY},Ce={x:f.x,y:f.y},u.setPointerCapture(Y),u.classList.add("is-panning")))}),u.addEventListener("pointermove",t=>{if(!pe||t.pointerId!==Y)return;const n=t.clientX-xe.x,i=t.clientY-xe.y;f.x=Ce.x+n,f.y=Ce.y+i,ae()});const e=t=>{if(!pe||t.pointerId!==void 0&&t.pointerId!==Y)return;pe=!1;const n=Y;if(Y=null,u.classList.remove("is-panning"),typeof n=="number")try{u.releasePointerCapture(n)}catch{}};u.addEventListener("pointerup",e),u.addEventListener("pointercancel",e),u.addEventListener("wheel",t=>{t.preventDefault();const i=(t.deltaY<0?1:-1)>0?1.1:.9,r=ce(f.scale*i,Ee,ot);if(r===f.scale)return;G=!0;const s=u.getBoundingClientRect(),o=t.clientX-s.left,l=t.clientY-s.top,a=r/f.scale;f.x=o-(o-f.x)*a,f.y=l-(l-f.y)*a,f.scale=r,ae()},{passive:!1}),u.addEventListener("dblclick",()=>{De(!0)})}function ae(){w&&(w.style.transform=`translate(${f.x}px, ${f.y}px) scale(${f.scale})`)}function De(e,t){if(!w||!e&&G)return;const n=L,i=n.clientWidth||1,r=n.clientHeight||1,s=w.getBoundingClientRect(),o=Number.parseFloat(w.style.width)||s.width||i,l=Number.parseFloat(w.style.height)||s.height||r,a=typeof t=="number"?t:me,c=typeof a=="number"?a:1;f.scale=ce(c,Ee,ot),f.x=(i-o)/2,f.y=Math.min(32,(r-l)/2),ae()}function Xt(e){if(Ie&&typeof e=="number"&&e<se){Ee=ce(e,rt,se);return}Ee=se}function ft(e){typeof ie!="undefined"&&_e(ie)}function ye(e){const t=e==="tree"?"tree":"graph";t!==E&&(E=t,tt=!0,$ instanceof HTMLSelectElement&&($.value=t),oe(),ie&&_e(ie))}function Yt(e){const t=e&&typeof e=="object"&&"data"in e?e.data:e,n=e&&typeof e=="object"&&typeof e.documentId=="string"?e.documentId:void 0,i=e&&typeof e=="object"&&typeof e.defaultViewMode=="string"?e.defaultViewMode:void 0,r=e&&typeof e=="object"&&"selectionInfo"in e?e.selectionInfo:void 0;if(xt(r),e&&typeof e=="object"&&(e.focusRoot&&(E!=="graph"&&ye("graph"),S=at),e.resetLayout&&k&&(D=new Map,he[k]={}),(e.resetView||e.focusRoot)&&(j=!0,G=!1,S=void 0,v=void 0),typeof e.graphAutoScale=="boolean"&&(Ie=e.graphAutoScale),typeof e.graphInitialScale=="number"&&(nt=kt(e.graphInitialScale)),typeof e.graphMaxDepth=="number"?K=Number.isFinite(e.graphMaxDepth)&&e.graphMaxDepth>0?Math.floor(e.graphMaxDepth):void 0:e.graphMaxDepth===null&&(K=void 0)),n?Bt(n):k||(k="default",D=new Map,j=!0),i){const s=i==="tree"?"tree":"graph";!tt&&E!==s&&(E=s,$ instanceof HTMLSelectElement&&($.value=s))}typeof t!="undefined"&&(ie=t,_e(t))}function _e(e){Ut(),Ae.clear();const t=Jt(e);mn(t.nodes),E==="tree"?Kt(e):Gt(t)}function Gt(e){L.removeAttribute("hidden"),M.setAttribute("hidden","true"),u||Ft(),re.innerHTML="",A.innerHTML="",y.clear(),w.style.width=`${e.size.width}px`,w.style.height=`${e.size.height}px`,A.setAttribute("width",String(e.size.width)),A.setAttribute("height",String(e.size.height)),A.setAttribute("viewBox",`0 0 ${e.size.width} ${e.size.height}`),e.nodes.forEach(n=>{const i=Qt(n);re.appendChild(i),y.set(n.id,{node:n,element:i})}),Se=e.edges,$t(new Set(e.nodes.map(n=>n.id))),pt(Se),me=Ie?cn(e.size,e.nodes.length):kt(nt),Xt(me),G?De(!1):(De(!0,me),G=!1),ae(),bn(),S?(de(S),S=void 0,j=!1):v?(highlightGraphNode(v),j=!1):j&&(de(at),j=!1)}function Kt(e){M.removeAttribute("hidden"),L.setAttribute("hidden","true"),M.innerHTML="";const t=document.createElement("ul");t.className="visualizer-tree",t.setAttribute("role","tree"),t.appendChild(ht("JSON",e,[],0)),M.appendChild(t)}function ht(e,t,n,i){const r=Et(n),s=mt(t),o=s.length>0;lt(r,i);const l=Pe(r,i),a=o&&(V.has(r)||l),c=document.createElement("li");c.className="tree-branch",c.dataset.depth=String(i),o&&c.setAttribute("aria-expanded",String(!a)),a&&c.classList.add("is-collapsed");const d=document.createElement(o?"button":"div");d.className=`tree-node ${o?"tree-node--branch":"tree-node--leaf"}`,d.dataset.path=r,d.dataset.depth=String(i),o&&(d.type="button",d.dataset.action="toggle",d.setAttribute("aria-expanded",String(!a)));const g=document.createElement("span");g.className="tree-node__chevron",g.setAttribute("aria-hidden","true"),d.appendChild(g);const h=document.createElement("span"),T=typeof n[n.length-1]=="string";h.className=`tree-node__key${T?" tree-node__key--action":""}`,h.textContent=String(e),T&&(h.dataset.action="rename",h.dataset.path=r,h.dataset.key=String(e),h.setAttribute("role","button"),h.setAttribute("tabindex","0"),h.title="Rename key"),d.appendChild(h);const Q=document.createElement("span");Q.className="tree-node__connector",Q.setAttribute("aria-hidden","true"),d.appendChild(Q);const Z=gt(t),Oe=wt(Z,"tree-node__value",{path:r,editable:bt(Z)});if(d.appendChild(Oe),c.appendChild(d),o&&!a){const R=document.createElement("ul");R.className="visualizer-tree-children",R.setAttribute("role","group"),s.forEach(([Le,B])=>{const ee=n.concat([Le]),O=Lt(e,Le,t);R.appendChild(ht(O,B,ee,i+1))}),c.appendChild(R)}return c}function qt(e){J=!1,Ct(),L.setAttribute("hidden","true"),M.setAttribute("hidden","true"),fe.textContent=e||"The document contains syntax errors.",fe.removeAttribute("hidden")}function Ut(){fe.setAttribute("hidden","true")}function Jt(e){const t=[],n=[];let i=0,r=0;const s=(a,c,d,g,h)=>{const T=Et(d);lt(T,g);const Q=mt(c),Z=Q.length>0,Oe=Pe(T,g),R=Z&&(V.has(T)||Oe),Le=d[d.length-1],B={id:T,key:String(a),descriptor:gt(c),depth:g,x:g*it,y:0,hasChildren:Z,isCollapsed:R,canRename:typeof Le=="string"};if(t.push(B),i=Math.max(i,g),h&&n.push({from:h,to:T}),!Z||R)return B.y=r*we,r+=1,B.y;const ee=Q.map(([O,Fe])=>s(Lt(a,O,c),Fe,d.concat([O]),g+1,T));if(ee.length){const O=ee[0],Fe=ee[ee.length-1];B.y=O+(Fe-O)/2}else B.y=r*we,r+=1;return B.y};s("JSON",e,[],0,null);const o=(i+1)*it+ve*2,l=Math.max(r*we,we)+ve*2;return t.forEach(a=>{a.x+=ve,a.y+=ve;const c=D.get(a.id);c&&(a.x=c.x,a.y=c.y)}),{nodes:t,edges:n,size:{width:o,height:l}}}function Qt(e){const t=document.createElement(e.hasChildren?"button":"div");t.className=`visualizer-node ${e.hasChildren?"visualizer-node--branch":"visualizer-node--leaf"}`,t.style.left=`${e.x}px`,t.style.top=`${e.y}px`,t.dataset.path=e.id,e.hasChildren&&(t.type="button",t.dataset.action="toggle",t.setAttribute("aria-expanded",String(!e.isCollapsed)),e.isCollapsed&&t.classList.add("is-collapsed"));const n=document.createElement("span");n.className="visualizer-node__chevron",n.setAttribute("aria-hidden","true"),t.appendChild(n);const i=document.createElement("span");i.className=`visualizer-node__key${e.canRename?" visualizer-node__key--action":""}`,i.textContent=e.key,e.canRename&&(i.dataset.action="rename",i.dataset.path=e.id,i.dataset.key=e.key,i.setAttribute("role","button"),i.setAttribute("tabindex","0"),i.title="Rename key"),t.appendChild(i);const r=document.createElement("span");r.className="visualizer-node__connector",r.setAttribute("aria-hidden","true"),t.appendChild(r);const s=wt(e.descriptor,"visualizer-node__value",{path:e.id,editable:!e.hasChildren&&bt(e.descriptor)});return t.appendChild(s),Zt(t,e),t}function Zt(e,t){e.addEventListener("pointerdown",i=>{rn(i)&&(m={id:t.id,pointerId:i.pointerId,startX:i.clientX,startY:i.clientY,originX:t.x,originY:t.y,moved:!1},e.setPointerCapture(i.pointerId),i.preventDefault())}),e.addEventListener("pointermove",i=>{if(!m||m.id!==t.id||i.pointerId!==m.pointerId)return;const r=(i.clientX-m.startX)/f.scale,s=(i.clientY-m.startY)/f.scale,o=m.originX+r,l=m.originY+s;en(t.id,o,l),m.moved=!0,i.preventDefault()});const n=i=>tn(i,t,e);e.addEventListener("pointerup",n),e.addEventListener("pointercancel",n),e.addEventListener("click",i=>{e.dataset.dragging==="true"&&(i.preventDefault(),i.stopPropagation(),e.dataset.dragging="")})}function pt(e){A.innerHTML="",e.forEach(t=>{const n=y.get(t.from),i=y.get(t.to);if(!n||!i)return;const r=n.element.offsetWidth,s=n.element.offsetHeight,o=i.element.offsetHeight,l=n.node.x+r,a=n.node.y+s/2,c=i.node.x,d=i.node.y+o/2,g=Math.max(32,(c-l)/2),h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",`M ${l} ${a} C ${l+g} ${a}, ${c-g} ${d}, ${c} ${d}`),h.setAttribute("class","visualizer-link"),A.appendChild(h)})}function en(e,t,n){const i=y.get(e);i&&(i.node.x=t,i.node.y=n,i.element.style.left=`${t}px`,i.element.style.top=`${n}px`,pt(Se))}function tn(e,t,n){if(!m||m.id!==t.id||e.pointerId!==void 0&&e.pointerId!==m.pointerId)return;try{n.releasePointerCapture(m.pointerId)}catch{}const i=m.moved;m=void 0,i&&(n.dataset.dragging="true",D.set(t.id,{x:t.x,y:t.y}),oe(),e.preventDefault(),e.stopPropagation())}function mt(e){return Array.isArray(e)?e.map((t,n)=>[n,t]):on(e)?Object.entries(e):[]}function gt(e){if(e===null)return{label:"null",kind:"null",icon:I.null,rawValue:null};if(Array.isArray(e))return{label:`[${e.length}]`,kind:"array",icon:I.array,rawValue:"[array]"};switch(typeof e){case"object":return{label:`{${Object.keys(e||{}).length}}`,kind:"object",icon:I.object,rawValue:"[object]"};case"string":{const t=e.trim();return an(t)?{label:vt(t,42),kind:"link",href:t,title:t,icon:I.link,rawValue:t}:{label:`"${vt(e)}"`,kind:"string",title:e,icon:I.string,rawValue:e}}case"number":return{label:String(e),kind:"number",icon:I.number,rawValue:e};case"boolean":return{label:String(e),kind:"boolean",icon:I.boolean,rawValue:e};default:return{label:"",kind:"unknown",icon:I.unknown,rawValue:""}}}function bt(e){return e?_t.has(e.kind):!1}function nn(e){if(typeof e=="undefined")return"null";try{return JSON.stringify(e)}catch{return"null"}}function rn(e){if(e.button!==0)return!1;const t=e.target;return t instanceof HTMLElement?!(t.closest('[data-action="rename"]')||t.closest('[data-action="edit-value"]')||t.closest('[data-open-link="true"]')):!0}function wt(e,t,n={}){var o;const i=document.createElement("span");i.className=`${t} ${t}--${e.kind}`;const r=sn((o=e.icon)!=null?o:I.unknown);i.appendChild(r);const s=document.createElement("span");if(s.className=`${t}__text`,s.textContent=e.label,i.appendChild(s),e.href?(i.dataset.openLink="true",i.setAttribute("data-href",e.href),e.title?i.title=e.title:i.title=e.href):e.title&&(i.title=e.title),n.editable&&n.path){i.dataset.action="edit-value",i.dataset.path=n.path,i.dataset.kind=e.kind==="link"?"string":e.kind,i.dataset.literal=nn(e.rawValue),i.classList.add(`${t}--action`),i.setAttribute("role","button"),i.setAttribute("tabindex","0");const l=i.title,a=e.href?"Click to edit value. Cmd/Ctrl+Click to open link.":"Click to edit value.";i.title=l?`${l}
${a}`:a}return i}function sn(e){var r;const t=document.createElement("span");t.className="value-icon";const n=(r=ct[e])!=null?r:ct.unknown;t.innerHTML=n;const i=t.querySelector("svg");return i&&(i.setAttribute("aria-hidden","true"),i.setAttribute("focusable","false")),t}function vt(e,t=28){return e.length<=t?e:`${e.slice(0,t-1)}…`}function on(e){return typeof e=="object"&&e!==null}function an(e){return/^https?:\/\/[^\s]+$/i.test(e)}function Et(e){return JSON.stringify(e)}function cn(e,t){const n=yt(un(t)),i=ln(e),r=typeof i=="number"?Math.min(i,n):n;return yt(Math.max(r,Dt))}function ln(e){var l,a;if(!e)return;const t=(u==null?void 0:u.clientWidth)||L.clientWidth||window.innerWidth||1,n=(u==null?void 0:u.clientHeight)||L.clientHeight||window.innerHeight||1,i=(l=e==null?void 0:e.width)!=null?l:0,r=(a=e==null?void 0:e.height)!=null?a:0;if(i<=0||r<=0)return;const o=Math.min(t/i,n/r)*Pt;if(!(!Number.isFinite(o)||o<=0))return o}function un(e){return e>2e3?.35:e>1200?.45:e>800?.55:e>500?.65:e>300?.8:1}function yt(e){const t=typeof e=="number"&&Number.isFinite(e)?e:1;return ce(t,rt,st)}function kt(e){return ce(typeof e=="number"?e:1,se,st)}function ce(e,t,n){return Math.min(Math.max(e,t),n)}function Lt(e,t,n){if(!Array.isArray(n))return String(t);const i=dn(e),r=Number(t),s=Number.isInteger(r)?r+1:String(t);return`${i} ${s}`}function dn(e){if(!e||e==="JSON")return"Item";const t=e.trim();if(!t)return"Item";const n=t.toLowerCase();return n.endsWith("ies")?le(n.slice(0,-3)+"y"):n.endsWith("ses")?le(n.slice(0,-2)):n.endsWith("s")?le(n.slice(0,-1)):le(n)}function Mt(e){if(typeof e!="string")return;const t=e.trim();if(!t)return;const n=Number.parseInt(t,10);if(!(!Number.isFinite(n)||n<=0))return n}function fn(e,t){return e>t?{start:t,end:e}:{start:e,end:t}}function le(e){return e?e.charAt(0).toUpperCase()+e.slice(1):""}function hn(e){switch(e){case"openai":return"OpenAI";case"anthropic":return"Anthropic";default:return le(e)}}function ue(){return`Set your ${hn(Ne)} API key to send messages.`}function pn(e){const t={};return e.forEach((n,i)=>{t[i]=n}),t}function mn(e){ge=new Map,e.forEach(t=>{var s,o,l;const n=typeof((s=t.descriptor)==null?void 0:s.label)=="string"?t.descriptor.label:"",i=typeof((o=t.descriptor)==null?void 0:o.rawValue)=="string"?t.descriptor.rawValue:typeof((l=t.descriptor)==null?void 0:l.rawValue)!="undefined"?String(t.descriptor.rawValue):"",r=[t.key,n,i].filter(Boolean).join(" ").toLowerCase();ge.set(t.id,{text:r})}),Te&&(ge.has(v!=null?v:"")||(v=void 0))}function gn(e){if(Te=e,!e){S=void 0,v=void 0,Be();return}const t=e.toLowerCase();let n;for(const[i,r]of ge)if(r.text.includes(t)){n=i;break}if(!n){Be(),v=void 0;return}if(v=n,S=n,E!=="graph"){ye("graph");return}de(n)}function Be(){y.forEach(({element:e})=>e.classList.remove("is-search-hit")),M.querySelectorAll(".tree-node.is-search-hit").forEach(e=>e.classList.remove("is-search-hit"))}function bn(){Be(),!(!Te||E!=="graph")&&v&&y.has(v)&&y.get(v).element.classList.add("is-search-hit")}function de(e){var l,a;const t=y.get(e);if(!t)return;y.forEach(({element:c})=>c.classList.remove("is-search-hit")),t.element.classList.add("is-search-hit");const n=(l=u==null?void 0:u.clientWidth)!=null?l:0,i=(a=u==null?void 0:u.clientHeight)!=null?a:0,r=t.element.offsetWidth||0,s=t.element.offsetHeight||0,o=f.scale||1;f.x=n/2-(t.node.x+r/2)*o,f.y=i/2-(t.node.y+s/2)*o,ae(),S=void 0}function wn(e){e&&requestAnimationFrame(()=>{const t=`.tree-node[data-path="${Ln(e)}"]`,n=M.querySelector(t);n instanceof HTMLElement&&(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add("is-search-hit"),typeof n.focus=="function"&&n.focus({preventScroll:!0}),setTimeout(()=>n.classList.remove("is-search-hit"),800))})}function At(e){e&&(E==="graph"?requestAnimationFrame(()=>de(e)):wn(e))}function St(e,t={persist:!0}){C=!!e,Je instanceof HTMLElement&&Je.classList.toggle("is-collapsed",C),Qe instanceof HTMLElement&&Qe.setAttribute("aria-hidden",String(C)),W instanceof HTMLButtonElement&&(W.setAttribute("aria-expanded",String(!C)),W.title=C?"Show controls":"Hide controls",W.setAttribute("aria-label",C?"Show controls":"Hide controls")),t.persist!==!1&&oe()}function ke(e){if(!(Me instanceof HTMLElement))return;const t=typeof e=="boolean"?e:!q;q=t,t?(Me.removeAttribute("hidden"),F instanceof HTMLTextAreaElement&&F.focus()):Me.setAttribute("hidden","true")}function xt(e){if(e&&typeof e=="object"){J=!!e.active;const t=typeof e.startLine=="number"?e.startLine+1:void 0,n=typeof e.endLine=="number"?e.endLine+1:void 0;_=J&&(typeof t=="number"&&typeof n=="number")?{start:t,end:n}:{}}else J=!1,_={};Ct()}function Ct(){$e()}function $e(){!(N instanceof HTMLInputElement)||!(P instanceof HTMLInputElement)||(typeof _.start=="number"?N.value=String(_.start):N.matches(":focus")||(N.value=""),typeof _.end=="number"?P.value=String(_.end):P.matches(":focus")||(P.value=""))}function vn(e){if(!(x instanceof HTMLSelectElement))return;const t=Array.isArray(e==null?void 0:e.options)?e.options:[],n=typeof(e==null?void 0:e.selectedId)=="string"?e.selectedId:"";if(typeof(e==null?void 0:e.selectedProvider)=="string"&&(Ne=e.selectedProvider),x.innerHTML="",!t.length){const i=document.createElement("option");i.value="",i.textContent="No models",x.appendChild(i),x.disabled=!0;return}t.forEach(i=>{var s,o,l;if(!i||typeof i!="object")return;const r=document.createElement("option");r.value=String((s=i.id)!=null?s:""),r.textContent=(l=(o=i.label)!=null?o:i.id)!=null?l:"Model",i.description&&(r.title=i.description),x.appendChild(r)}),x.disabled=!1,n&&(x.value=n)}function It(){q||ke(!0)}function Tt(){He.clear(),H&&(H.innerHTML="")}function En(e){Tt(),Array.isArray(e)&&e.forEach(t=>{var n,i;return Ve(t==null?void 0:t.id,(n=t==null?void 0:t.role)!=null?n:"assistant",(i=t==null?void 0:t.text)!=null?i:"")})}function Ve(e,t,n,i={}){if(!e)return;const r=ze(e,t);r.text=i.pending?"":n,r.element.classList.toggle("is-pending",!!i.pending),r.content.innerHTML=Re(r.text,i.pending),je(),b("")}function yn(e,t){if(!e||!t)return;const n=ze(e,"assistant");n.element.classList.remove("is-pending");const r=typeof n.text=="string"&&n.text.trim().startsWith("AI is thinking")?"":n.text||"";n.text=r+t,n.content.innerHTML=Re(n.text),je(),b("")}function kn(e,t,n){if(!e)return;const i=ze(e,"assistant");i.text=t,i.element.classList.remove("is-pending"),i.content.innerHTML=Re(t);const r=i.element.querySelector(".chat-message__actions");if(r&&r.remove(),n){const s=document.createElement("div");s.className="chat-message__actions";const o=document.createElement("button");o.type="button",o.textContent="Apply snippet",o.addEventListener("click",()=>{p.postMessage({type:"chat:applySnippet",payload:{content:n}})}),s.appendChild(o),i.element.appendChild(s)}je()}function ze(e,t){let n=He.get(e);if(!n){const i=document.createElement("div");i.className=`chat-message chat-message--${t}`;const r=document.createElement("div");r.className="chat-message__content",i.appendChild(r),H==null||H.appendChild(i),n={element:i,content:r,text:""},He.set(e,n)}return n}function je(){H&&requestAnimationFrame(()=>{H.scrollTop=H.scrollHeight})}function b(e){if(!(ne instanceof HTMLElement))return;const t=typeof e=="string"?e.trim():"";if(t==="Thinking…"||t==="Thinking..."||t==="AI is thinking…"||t==="AI is thinking..."){ne.innerHTML='AI is thinking<span class="chat-status__dots"><span>.</span><span>.</span><span>.</span></span>',ne.classList.add("is-thinking");return}ne.textContent=e||"",ne.classList.remove("is-thinking")}function Re(e,t){var l,a;if(t)return'<span class="chat-pending-dots"><span></span><span></span><span></span></span>';const n=c=>c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=/```(\w+)?\s*([\s\S]*?)```/g;let r=0,s="",o;for(;(o=i.exec(e))!==null;){s+=n(e.slice(r,o.index));const c=(a=(l=o[1])==null?void 0:l.trim())!=null?a:"json",d=n(o[2].trim());s+=`<pre class="chat-code"><code class="lang-${c}">${d}</code></pre>`,r=i.lastIndex}return s+=n(e.slice(r)),s}function Ln(e){return typeof CSS!="undefined"&&typeof CSS.escape=="function"?CSS.escape(e):String(e).replace(/["\\]/g,"\\$&")}})()})();
//# sourceMappingURL=visualizer.js.map
